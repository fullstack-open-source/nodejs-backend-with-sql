{
	"info": {
		"_postman_id": "11918d16-52fa-486e-ab9d-9fa5f9e8be25",
		"name": "NodeJs - Backend",
		"description": "# ğŸš€ Node.js Backend API\n\n[![Node.js](https://img.shields.io/badge/Node.js-18%2B-green.svg)](https://nodejs.org)\n[![Express](https://img.shields.io/badge/Express-4.18%2B-blue.svg)](https://expressjs.com)\n[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16%2B-blue.svg)](https://postgresql.org)\n[![Prisma](https://img.shields.io/badge/Prisma-7.0%2B-purple.svg)](https://prisma.io)\n[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)\n[![Status](https://img.shields.io/badge/Status-Production%20Ready-brightgreen.svg)]()\n[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)](https://docker.com)\n\n> **Enterprise-Grade Node.js Backend API with Advanced Features**\n\nNode.js Backend is a comprehensive, production-ready RESTful API built with Express.js, featuring JWT authentication with Instagram-style multi-token pattern, role-based access control, real-time activity logging, advanced security middleware, and comprehensive monitoring capabilities.\n\n**Repository**: [https://github.com/fullstack-open-source/nodejs-backend-with-sql](https://github.com/fullstack-open-source/nodejs-backend-with-sql)\n\n## ğŸ“‹ Table of Contents\n\n- [ğŸš€ Features](#-features)\n- [ğŸ—ï¸ Architecture](#ï¸-architecture)\n  - [System Architecture](#system-architecture)\n  - [Authentication Architecture](#authentication-architecture)\n  - [Request Flow](#request-flow)\n  - [Middleware Stack](#middleware-stack)\n  - [Database Architecture](#database-architecture)\n  - [Module Structure](#module-structure)\n- [ğŸ“š API Documentation](#-api-documentation)\n- [ğŸ“¦ Installation & Setup](#-installation--setup)\n  - [Prerequisites](#prerequisites)\n  - [Quick Start](#quick-start)\n  - [Development Setup](#development-setup)\n  - [Production Setup](#production-setup)\n  - [Docker Setup](#docker-setup)\n- [ğŸ”„ Complete Project Workflow](#-complete-project-workflow)\n  - [Service Connection Architecture](#service-connection-architecture)\n  - [Service Startup Order](#service-startup-order)\n  - [Connection Flow](#connection-flow)\n\n## ğŸš€ Features\n\n### ğŸ¯ Core Capabilities\n\n- **RESTful API**: Comprehensive REST API with Express.js framework\n- **JWT Authentication**: Instagram-style multi-token authentication system (Access, Session, Refresh tokens)\n- **Role-Based Access Control**: Flexible permission system with groups and permissions\n- **Activity Logging**: Comprehensive audit trail with detailed metadata\n- **File Upload**: Google Cloud Storage integration for media files\n- **Email & SMS**: Twilio and Nodemailer integration for notifications and OTP\n- **Error Tracking**: Sentry integration for production monitoring and error tracking\n- **API Documentation**: Auto-generated Swagger/OpenAPI documentation\n- **Multilingual Support**: Multi-language API responses with automatic translation\n- **Rate Limiting**: Request throttling and rate limiting for traffic management\n- **Worker Pool**: CPU-intensive task processing with worker threads\n- **Docker Ready**: Production-ready containerization with multi-stage builds\n- **PM2 Support**: Process management with cluster mode for high availability\n\n### ğŸ”§ Technical Features\n\n- **Express.js 4.18+**: Modern web framework for building APIs\n- **PostgreSQL 16+**: Robust relational database with advanced features\n- **Prisma ORM**: Type-safe database access with connection pooling\n- **Redis**: Caching and session management for improved performance\n- **JWT**: Secure token-based authentication and authorization\n- **Winston**: Professional logging system with file rotation\n- **Helmet**: Security headers for protection against common vulnerabilities\n- **Rate Limiting**: Request throttling to prevent abuse\n- **Compression**: Response compression for optimized bandwidth usage\n- **CORS**: Cross-origin resource sharing with whitelist validation\n- **Swagger**: Interactive API documentation with Swagger UI\n- **Nginx Reverse Proxy**: Production-ready reverse proxy configuration\n- **Multilingual**: Multi-language support for API responses (English, Arabic, and more)\n\n### ğŸ” Authentication Features\n\n- **Multi-Token System**: Access token (1 hour), Session token (7 days), Refresh token (30 days)\n- **Token Blacklisting**: Redis-based token invalidation for secure logout\n- **OTP Verification**: Email, SMS, and WhatsApp OTP support\n- **Password Management**: Set, change, and reset password functionality\n- **Email/Phone Verification**: Two-step verification for contact changes\n- **Session Management**: Stateless session management with unique session IDs\n- **Token Rotation**: Automatic token rotation on refresh for enhanced security\n\n### ğŸ—„ï¸ Database Support & Flexibility\n\nThis project uses **Prisma ORM**, which provides exceptional database flexibility and support for multiple database systems. While the project is configured for **PostgreSQL** by default, Prisma allows you to easily switch between different databases without changing your application code.\n\n#### Currently Configured Database\n\n- **PostgreSQL 16+**: The default database for this project, providing robust relational database features, JSON support, and advanced querying capabilities.\n\n#### Prisma Supported Databases\n\nPrisma ORM supports **10+ database systems**, giving you the flexibility to choose the best database for your needs:\n\n**Self-hosted Databases:**\n- âœ… **PostgreSQL** (9.6 - 17) - Currently configured\n- âœ… **MySQL** (5.6, 5.7, 8.0, 8.4)\n- âœ… **MariaDB** (10.0+)\n- âœ… **SQLite** (All versions)\n- âœ… **Microsoft SQL Server** (2017, 2019, 2022)\n- âœ… **MongoDB** (4.2+)\n- âœ… **CockroachDB** (21.2.4+)\n\n**Managed/Cloud Databases:**\n- âœ… **AWS Aurora** (All versions)\n- âœ… **AWS Aurora Serverless** (All versions)\n- âœ… **Azure SQL** (All versions)\n- âœ… **CockroachDB-as-a-Service** (All versions)\n- âœ… **MongoDB Atlas** (All versions)\n- âœ… **Neon Serverless Postgres** (All versions)\n- âœ… **PlanetScale** (All versions)\n- âœ… **Cloudflare D1** (Preview)\n- âœ… **Aiven** (MySQL & Postgres)\n\n#### Advantages of Using Prisma\n\n1. **Database Agnostic**: Switch between databases by simply changing the `provider` in `schema.prisma`\n2. **Type Safety**: Auto-generated TypeScript types based on your database schema\n3. **Migration Management**: Built-in migration system for schema versioning\n4. **Connection Pooling**: Automatic connection pool management for optimal performance\n5. **Query Optimization**: Intelligent query builder that generates optimized SQL\n6. **Developer Experience**: Intuitive API with excellent IDE autocomplete support\n7. **Multi-Database Support**: Use different databases for different environments (e.g., SQLite for development, PostgreSQL for production)\n\n#### Switching Databases\n\nTo switch to a different database, simply update the `datasource` provider in `api/prisma/schema.prisma`:\n\n```prisma\n// For PostgreSQL (current)\ndatasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\n// For MySQL\ndatasource db {\n  provider = \"mysql\"\n  url      = env(\"DATABASE_URL\")\n}\n\n// For SQLite\ndatasource db {\n  provider = \"sqlite\"\n  url      = \"file:./dev.db\"\n}\n\n// For MongoDB\ndatasource db {\n  provider = \"mongodb\"\n  url      = env(\"DATABASE_URL\")\n}\n```\n\nThen run:\n```bash\n# ------------------------------\n# Prisma Client & Schema\n# ------------------------------\n\n# Regenerate Prisma Client after schema changes\nnpm run prisma:generate\n\n# Pull the current database schema into Prisma (update schema.prisma)\nnpm run prisma:pull\n\n# Push the Prisma schema to the database (without migration)\nnpm run prisma:push\n\n# Open Prisma Studio (GUI to view/edit database)\nnpm run prisma:studio\n\n# Format Prisma schema file\nnpm run prisma:format\n\n# Validate Prisma schema for errors\nnpm run prisma:validate\n\n# ------------------------------\n# Database seeding & syncing\n# ------------------------------\n\n# Pull data (custom seed script)\nnpm run db:pull\n\n# Push data (custom seed script)\nnpm run db:push\n\n# Sync data (custom seed script)\nnpm run db:sync\n\n# Seed the database with initial data\nnpm run db:seed\n\n# ------------------------------\n# Migrations\n# ------------------------------\n\n# Create and apply migrations (development)\nnpm run migrate:dev\n\n# Apply migrations in production\nnpm run migrate:deploy\n\n# Drop database and reapply all migrations (destructive)\nnpm run migrate:reset\n\n```\n\n**Note**: Some schema features may vary between databases. Refer to [Prisma Database Documentation](https://www.prisma.io/docs/orm/reference/supported-databases) for database-specific considerations.\n\n## ğŸ—ï¸ Architecture\n\n### System Architecture\n\nThe system follows a layered architecture with clear separation of concerns:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                        External Proxy                         â”‚\nâ”‚                    (api.example.com)                          â”‚\nâ”‚                    SSL/TLS Termination                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Internal Nginx Proxy                        â”‚\nâ”‚                    (Port 9080:80)                              â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Security Layer:                                         â”‚  â”‚\nâ”‚  â”‚  - Rate Limiting (200 req/min per IP)                    â”‚  â”‚\nâ”‚  â”‚  - Request Size Validation (15MB max)                    â”‚  â”‚\nâ”‚  â”‚  - Attack Pattern Detection                              â”‚  â”‚\nâ”‚  â”‚  - Content Security Policy                               â”‚  â”‚\nâ”‚  â”‚  - DDoS Protection                                       â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Express.js Application                      â”‚\nâ”‚                    (Port 3000)                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Middleware Stack:                                       â”‚  â”‚\nâ”‚  â”‚  1. Sentry Request Handler                               â”‚  â”‚\nâ”‚  â”‚  2. Helmet (Security Headers)                            â”‚  â”‚\nâ”‚  â”‚  3. CORS (Cross-Origin)                                  â”‚  â”‚\nâ”‚  â”‚  4. Body Parser (JSON/URL-encoded)                       â”‚  â”‚\nâ”‚  â”‚  5. Compression                                          â”‚  â”‚\nâ”‚  â”‚  6. Morgan (Request Logging)                             â”‚  â”‚\nâ”‚  â”‚  7. Request Logger (Custom)                              â”‚  â”‚\nâ”‚  â”‚  8. Rate Limiter                                         â”‚  â”‚\nâ”‚  â”‚  9. Security Middleware (Custom)                         â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Application Modules:                                    â”‚  â”‚\nâ”‚  â”‚  - Authentication (JWT, OTP, Login)                      â”‚  â”‚\nâ”‚  â”‚  - Profile Management                                    â”‚  â”‚\nâ”‚  â”‚  - Permissions (Groups, Permissions)                     â”‚  â”‚\nâ”‚  â”‚  - Dashboard (Analytics)                                 â”‚  â”‚\nâ”‚  â”‚  - Activity Logging                                      â”‚  â”‚\nâ”‚  â”‚  - File Upload (GCS)                                     â”‚  â”‚\nâ”‚  â”‚  - Health Monitoring                                     â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â–¼                          â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   PostgreSQL Database    â”‚   â”‚   Redis Cache            â”‚\nâ”‚   (Prisma ORM)           â”‚   â”‚   (Sessions, Cache)      â”‚\nâ”‚   - User Data            â”‚   â”‚   - Session Storage      â”‚\nâ”‚   - Permissions          â”‚   â”‚   - OTP Cache            â”‚\nâ”‚   - Activity Logs        â”‚   â”‚   - Token Blacklist      â”‚\nâ”‚   - Groups               â”‚   â”‚   - Rate Limiting        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚\n                â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Google Cloud Storage   â”‚\nâ”‚   (Media & Static Files) â”‚\nâ”‚   - User Uploads         â”‚\nâ”‚   - Generated Content    â”‚\nâ”‚   - Static Assets        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Authentication Architecture\n\nThe authentication system implements a **stateless, multi-token architecture** similar to Instagram:\n\n**Key Features:**\n- **Multi-Token System**: Access token (1 hour), Session token (7 days), Refresh token (30 days)\n- **Token Blacklisting**: Redis-based cache for token invalidation\n- **Session Management**: Unique session_id links all tokens together\n- **Token Rotation**: Refresh tokens rotate on each refresh for security\n- **Origin Validation**: Domain-specific token validation\n\n**Complete Documentation**: See [Authentication Router](./api/router/authenticate/authenticate.md)\n\n### Request Flow\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º External Proxy (api.example.com)\n   â”‚\n   â”œâ”€â–º Internal Nginx (Port 9080)\n   â”‚   â”œâ”€â–º Security Checks (Rate Limiting, Attack Detection)\n   â”‚   â”œâ”€â–º Request Size Validation\n   â”‚   â”œâ”€â–º Content Security Policy Headers\n   â”‚   â””â”€â–º Proxy to Express (http://api:3000)\n   â”‚\n   â”œâ”€â–º Express Middleware Stack\n   â”‚   â”œâ”€â–º Sentry Request Handler\n   â”‚   â”‚   â””â”€â–º Request Context Capture\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Helmet\n   â”‚   â”‚   â””â”€â–º Security Headers\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º CORS\n   â”‚   â”‚   â””â”€â–º Origin Validation\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Body Parser\n   â”‚   â”‚   â”œâ”€â–º JSON Parsing (15MB limit)\n   â”‚   â”‚   â””â”€â–º URL-encoded Parsing\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Compression\n   â”‚   â”‚   â””â”€â–º Response Compression\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Morgan + Request Logger\n   â”‚   â”‚   â””â”€â–º Request Logging\n   â”‚   â”‚\n   â”‚   â”œâ”€â–º Rate Limiter\n   â”‚   â”‚   â””â”€â–º Request Throttling (200/min)\n   â”‚   â”‚\n   â”‚   â””â”€â–º Security Middleware\n   â”‚       â”œâ”€â–º Input Sanitization\n   â”‚       â”œâ”€â–º SQL Injection Detection\n   â”‚       â”œâ”€â–º XSS Detection\n   â”‚       â””â”€â–º Command Injection Detection\n   â”‚\n   â”œâ”€â–º Route Handler\n   â”‚   â”œâ”€â–º JWT Authentication (if required)\n   â”‚   â”œâ”€â–º Permission Check (if required)\n   â”‚   â”œâ”€â–º Request Validation\n   â”‚   â”œâ”€â–º Business Logic\n   â”‚   â”œâ”€â–º Database Operations (Prisma)\n   â”‚   â””â”€â–º Response Formatting\n   â”‚\n   â”œâ”€â–º Activity Logging\n   â”‚   â””â”€â–º Log to Database\n   â”‚\n   â””â”€â–º Response\n       â”œâ”€â–º Error Handling (if any)\n       â”œâ”€â–º Sentry Error Capture (if error)\n       â”œâ”€â–º Security Headers\n       â””â”€â–º Client Response\n```\n\n### Middleware Stack\n\nThe middleware stack processes requests in a specific order to ensure security, performance, and reliability:\n\n1. **Sentry Request Handler** - Captures request context for error tracking and performance monitoring\n2. **Helmet** - Sets security headers including X-Content-Type-Options, X-Frame-Options, and X-XSS-Protection\n3. **CORS** - Handles cross-origin requests with whitelist validation for allowed origins\n4. **Body Parser** - Parses JSON and URL-encoded request bodies with 15MB size limit\n5. **Compression** - Compresses responses using gzip algorithm for bandwidth optimization\n6. **Morgan + Request Logger** - Logs HTTP requests with detailed metadata including IP, method, path, and response time\n7. **Rate Limiter** - Throttles requests to 200 requests per minute per IP address\n8. **Security Middleware** - Sanitizes input data and detects attack patterns including SQL injection, XSS, and command injection\n9. **Route Handlers** - Application-specific logic execution\n10. **Error Handler** - Catches and formats errors with appropriate status codes\n11. **Sentry Error Handler** - Captures errors for monitoring and alerting\n\n### Database Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    PostgreSQL Database                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  User Model                                          â”‚   â”‚\nâ”‚  â”‚  - user_id (UUID, Primary Key)                       â”‚   â”‚\nâ”‚  â”‚  - email, phone_number, user_name                    â”‚   â”‚\nâ”‚  â”‚  - password, auth_type                               â”‚   â”‚\nâ”‚  â”‚  - is_email_verified, is_phone_verified              â”‚   â”‚\nâ”‚  â”‚  - status, is_active, is_verified                    â”‚   â”‚\nâ”‚  â”‚  - profile_picture_url, bio                          â”‚   â”‚\nâ”‚  â”‚  - Relationships: UserGroup[], ActivityLog[]         â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Permission Model                                    â”‚   â”‚\nâ”‚  â”‚  - permission_id (UUID, Primary Key)                 â”‚   â”‚\nâ”‚  â”‚  - name, codename (unique)                           â”‚   â”‚\nâ”‚  â”‚  - description, category                             â”‚   â”‚\nâ”‚  â”‚  - Relationships: GroupPermission[]                  â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Group Model                                         â”‚   â”‚\nâ”‚  â”‚  - group_id (UUID, Primary Key)                      â”‚   â”‚\nâ”‚  â”‚  - name, codename (unique)                           â”‚   â”‚\nâ”‚  â”‚  - description, is_system, is_active                 â”‚   â”‚\nâ”‚  â”‚  - Relationships: GroupPermission[], UserGroup[]     â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  GroupPermission Model (Many-to-Many)                â”‚   â”‚\nâ”‚  â”‚  - id (UUID, Primary Key)                            â”‚   â”‚\nâ”‚  â”‚  - group_id (FK â†’ Group)                             â”‚   â”‚\nâ”‚  â”‚  - permission_id (FK â†’ Permission)                   â”‚   â”‚\nâ”‚  â”‚  - Unique constraint: (group_id, permission_id)      â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  UserGroup Model (Many-to-Many)                      â”‚   â”‚\nâ”‚  â”‚  - id (UUID, Primary Key)                            â”‚   â”‚\nâ”‚  â”‚  - user_id (FK â†’ User)                               â”‚   â”‚\nâ”‚  â”‚  - group_id (FK â†’ Group)                             â”‚   â”‚\nâ”‚  â”‚  - assigned_at, assigned_by_user_id                  â”‚   â”‚\nâ”‚  â”‚  - Unique constraint: (user_id, group_id)            â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚                                                             â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  ActivityLog Model                                   â”‚   â”‚\nâ”‚  â”‚  - log_id (UUID, Primary Key)                        â”‚   â”‚\nâ”‚  â”‚  - user_id (FK â†’ User, nullable)                     â”‚   â”‚\nâ”‚  â”‚  - level, message, action, module                    â”‚   â”‚\nâ”‚  â”‚  - ip_address, user_agent, device, browser, os       â”‚   â”‚\nâ”‚  â”‚  - endpoint, method, status_code                     â”‚   â”‚\nâ”‚  â”‚  - request_id, session_id                            â”‚   â”‚\nâ”‚  â”‚  - metadata, error_details (JSONB)                   â”‚   â”‚\nâ”‚  â”‚  - duration_ms, created_at                           â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Module Structure\n\n```\nNodeJs Backend API\nâ”œâ”€â”€ ğŸ“ api/                              # Main application directory\nâ”‚   â”œâ”€â”€ ğŸ“„ server.js                     # Express server entry point\nâ”‚   â”œâ”€â”€ ğŸ“„ Dockerfile                    # Multi-stage Docker build\nâ”‚   â”œâ”€â”€ ğŸ“„ ecosystem.config.js           # PM2 configuration\nâ”‚   â”œâ”€â”€ ğŸ“„ package.json                  # Dependencies and scripts\nâ”‚   â”œâ”€â”€ ğŸ“„ start.sh                      # Container startup script\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ router/                       # API route handlers\nâ”‚   â”‚   â”œâ”€â”€ ğŸ” authenticate/              # Authentication routes\nâ”‚   â”‚   â”‚   â”œâ”€â”€ authenticate.js          # Login, OTP, token management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ profile.js               # User profile management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ models.js                # Request validation schemas\nâ”‚   â”‚   â”‚   â”œâ”€â”€ query.js                 # Database queries\nâ”‚   â”‚   â”‚   â””â”€â”€ utils.js                 # Helper functions\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“Š dashboard/                # Dashboard routes\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Analytics and statistics\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ”‘ permissions/              # Permission management\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Groups, permissions, users\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“ activity/                 # Activity logging\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Activity log endpoints\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“¤ upload/                   # File upload\nâ”‚   â”‚   â”‚   â””â”€â”€ api.js                   # Media upload endpoints\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â””â”€â”€ â¤ï¸ health/                   # Health monitoring\nâ”‚   â”‚       â”œâ”€â”€ api.js                   # Health check endpoints\nâ”‚   â”‚       â””â”€â”€ test-sentry.js           # Sentry test endpoint\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ src/                          # Source code modules\nâ”‚   â”‚   â”œâ”€â”€ ğŸ” authenticate/             # Authentication logic\nâ”‚   â”‚   â”‚   â”œâ”€â”€ authenticate.js          # JWT validation\nâ”‚   â”‚   â”‚   â”œâ”€â”€ checkpoint.js            # User authentication\nâ”‚   â”‚   â”‚   â”œâ”€â”€ models.js                # User models\nâ”‚   â”‚   â”‚   â””â”€â”€ otp_cache.js             # OTP management\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“Š activity/                 # Activity logging\nâ”‚   â”‚   â”‚   â””â”€â”€ activityLog.js          # Activity log service\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ’¾ cache/                    # Caching layer\nâ”‚   â”‚   â”‚   â””â”€â”€ cache.js                # Redis cache utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ âš™ï¸ config/                   # Configuration\nâ”‚   â”‚   â”‚   â””â”€â”€ swagger.js               # Swagger/OpenAPI config\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ—„ï¸ db/                       # Database layer\nâ”‚   â”‚   â”‚   â”œâ”€â”€ prisma.js                # Prisma client setup\nâ”‚   â”‚   â”‚   â”œâ”€â”€ index.js                 # Database utilities\nâ”‚   â”‚   â”‚   â””â”€â”€ postgres/                # PostgreSQL utilities\nâ”‚   â”‚   â”‚       â”œâ”€â”€ postgres.js          # Connection pool\nâ”‚   â”‚   â”‚       â””â”€â”€ initTriggers.js      # Database triggers\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“§ email/                    # Email service\nâ”‚   â”‚   â”‚   â”œâ”€â”€ email.js                 # Email sending\nâ”‚   â”‚   â”‚   â””â”€â”€ template.js              # Email templates\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“‹ enum/                     # Enumerations\nâ”‚   â”‚   â”‚   â””â”€â”€ enum.js                  # Application enums\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“ logger/                   # Logging system\nâ”‚   â”‚   â”‚   â””â”€â”€ logger.js                # Winston logger\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ›¡ï¸ middleware/               # Express middleware\nâ”‚   â”‚   â”‚   â”œâ”€â”€ errorHandler.js          # Global error handler\nâ”‚   â”‚   â”‚   â”œâ”€â”€ permissionMiddleware.js   # Permission checking\nâ”‚   â”‚   â”‚   â”œâ”€â”€ requestLogger.js         # Request logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ requestQueue.js          # Request queuing\nâ”‚   â”‚   â”‚   â””â”€â”€ securityMiddleware.js    # Security checks\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ”‘ permissions/               # Permission system\nâ”‚   â”‚   â”‚   â””â”€â”€ permissions.js            # Permission utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“¤ response/                  # Response handlers\nâ”‚   â”‚   â”‚   â”œâ”€â”€ success.js               # Success responses\nâ”‚   â”‚   â”‚   â”œâ”€â”€ error.js                 # Error responses\nâ”‚   â”‚   â”‚   â””â”€â”€ map.js                   # Response mapping\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ› sentry/                    # Error tracking\nâ”‚   â”‚   â”‚   â””â”€â”€ sentry.js                # Sentry configuration\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ“± sms/                       # SMS service\nâ”‚   â”‚   â”‚   â””â”€â”€ sms.js                   # Twilio integration\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ’¾ storage/                   # File storage\nâ”‚   â”‚   â”‚   â””â”€â”€ storage.js               # Google Cloud Storage\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸ› ï¸ utils/                     # Utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.js                 # Debug utilities\nâ”‚   â”‚   â”‚   â””â”€â”€ workerUtils.js           # Worker pool utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â”œâ”€â”€ ğŸŒ multilingual/              # Multilingual support\nâ”‚   â”‚   â”‚   â””â”€â”€ multilingual.js          # Language utilities\nâ”‚   â”‚   â”‚\nâ”‚   â”‚   â””â”€â”€ ğŸ‘· workers/                   # Worker threads\nâ”‚   â”‚       â”œâ”€â”€ workerPool.js            # Worker pool manager\nâ”‚   â”‚       â””â”€â”€ cpuTaskWorker.js         # CPU task worker\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ prisma/                        # Prisma ORM\nâ”‚   â”‚   â”œâ”€â”€ schema.prisma                # Database schema\nâ”‚   â”‚   â”œâ”€â”€ seed.js                      # Database seeding\nâ”‚   â”‚   â””â”€â”€ seed-defaults.js             # Default seed data\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ credentials/                   # Service credentials\nâ”‚   â”‚   â””â”€â”€ google-backend-master.json   # GCS credentials\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ ğŸ“ logs/                          # Application logs\nâ”‚   â”‚   â”œâ”€â”€ errors-server.log            # Error logs\nâ”‚   â”‚   â””â”€â”€ success-server.log           # Success logs\nâ”‚   â”‚\nâ”‚   â””â”€â”€ ğŸ“ scripts/                       # Utility scripts\nâ”‚       â”œâ”€â”€ kill-port.sh                 # Port cleanup\nâ”‚       â””â”€â”€ db-sync.sh                   # Database sync\nâ”‚\nâ”œâ”€â”€ ğŸ“ nginx/                             # Nginx configuration\nâ”‚   â”œâ”€â”€ nginx.conf                        # Main nginx config\nâ”‚   â”œâ”€â”€ proxy.conf                        # Proxy settings\nâ”‚   â”œâ”€â”€ security.conf                    # Security headers\nâ”‚   â””â”€â”€ conf.d/                          # Additional configs\nâ”‚       â”œâ”€â”€ default.conf                 # Default server config\nâ”‚       â””â”€â”€ security.conf                # Security rules\nâ”‚\nâ”œâ”€â”€ ğŸ“„ docker-compose.yaml                # Docker Compose config\nâ”œâ”€â”€ ğŸ“„ reload.sh                          # Deployment script\nâ””â”€â”€ ğŸ“„ README.md                          # This file\n```\n\n## ğŸ“š API Documentation\n\n### Authentication & User Management\n\n**Complete Documentation**: [Authentication Router](./api/router/authenticate/authenticate.md)\n\n**Endpoints:**\n- `POST /{MODE}/auth/login-with-password` - Login with email/phone and password\n- `POST /{MODE}/auth/login-with-otp` - Login with OTP\n- `POST /{MODE}/auth/send-one-time-password` - Send OTP via email/SMS/WhatsApp\n- `POST /{MODE}/auth/verify-one-time-password` - Verify OTP\n- `POST /{MODE}/auth/verify` - Signup/Register with OTP\n- `POST /{MODE}/auth/set-password` - Set password for authenticated user\n- `POST /{MODE}/auth/change-password` - Change user password\n- `POST /{MODE}/auth/forget-password` - Reset password with OTP\n- `POST /{MODE}/auth/refresh-token` - Refresh access tokens\n- `POST /{MODE}/auth/logout` - Logout and revoke tokens\n- `POST /{MODE}/auth/token-info` - Get token information\n- `POST /{MODE}/auth/check-user-availability` - Check email/phone availability\n- `POST /{MODE}/auth/verify-email-and-phone` - Verify email/phone with OTP\n\n**Profile Management**: [Profile Router](./api/router/authenticate/profile.md)\n\n**Endpoints:**\n- `GET /{MODE}/settings/profile` - Get user profile\n- `GET /{MODE}/settings/profile/{user_id}` - Get profile by ID\n- `POST /{MODE}/settings/profile-picture` - Update profile picture\n- `PUT /{MODE}/settings/profile` - Update user profile\n- `POST /{MODE}/settings/change-email` - Change email with OTP verification\n- `POST /{MODE}/settings/change-phone` - Change phone with OTP verification\n- `POST /{MODE}/settings/profile-accessibility` - Update profile accessibility\n- `POST /{MODE}/settings/profile-language` - Update profile language\n- `POST /{MODE}/settings/update-theme` - Update theme preference\n- `POST /{MODE}/settings/update-timezone` - Update timezone\n- `GET /{MODE}/settings` - Get user settings\n- `POST /{MODE}/settings/deactivate-account` - Deactivate account\n- `POST /{MODE}/settings/delete-account` - Delete account\n\n### Permissions & Groups\n\n**Complete Documentation**: [Permissions Router](./api/router/permissions/permissions.md)\n\n**Endpoints:**\n- `GET /{MODE}/permissions` - Get all permissions\n- `GET /{MODE}/permissions/{permission_id}` - Get permission by ID\n- `POST /{MODE}/permissions` - Create new permission\n- `PUT /{MODE}/permissions/{permission_id}` - Update permission\n- `DELETE /{MODE}/permissions/{permission_id}` - Delete permission\n- `GET /{MODE}/groups` - Get all groups\n- `GET /{MODE}/groups/{group_id}` - Get group by ID\n- `POST /{MODE}/groups` - Create new group\n- `PUT /{MODE}/groups/{group_id}` - Update group\n- `DELETE /{MODE}/groups/{group_id}` - Delete group\n- `POST /{MODE}/groups/{group_id}/permissions` - Assign permissions to group\n- `GET /{MODE}/users/{user_id}/groups` - Get user groups\n- `GET /{MODE}/users/{user_id}/permissions` - Get user permissions\n- `POST /{MODE}/users/{user_id}/groups` - Assign groups to user\n- `GET /{MODE}/users/me/groups` - Get current user groups\n- `GET /{MODE}/users/me/permissions` - Get current user permissions\n\n### Dashboard & Analytics\n\n**Complete Documentation**: [Dashboard Router](./api/router/dashboard/dashboard.md)\n\n**Endpoints:**\n- `GET /{MODE}/dashboard/overview` - Get dashboard overview statistics\n- `GET /{MODE}/dashboard/users-by-status` - Get users grouped by status\n- `GET /{MODE}/dashboard/users-by-type` - Get users grouped by type\n- `GET /{MODE}/dashboard/users-by-auth-type` - Get users grouped by auth type\n- `GET /{MODE}/dashboard/users-by-country` - Get users grouped by country\n- `GET /{MODE}/dashboard/users-by-language` - Get users grouped by language\n- `GET /{MODE}/dashboard/user-growth` - Get user growth statistics\n- `GET /{MODE}/dashboard/role-statistics` - Get role/group statistics\n- `GET /{MODE}/dashboard/recent-sign-ins` - Get recent sign-in activity\n- `GET /{MODE}/dashboard/all-statistics` - Get all statistics\n\n### File Upload\n\n**Complete Documentation**: [Upload Router](./api/router/upload/upload.md)\n\n**Endpoints:**\n- `POST /{MODE}/upload/media` - Upload media file (direct upload or URL)\n- `DELETE /{MODE}/upload/media/{file_id}` - Delete uploaded media\n\n**Features:**\n- Direct file upload with multipart/form-data\n- URL-based upload (downloads and stores file from URL)\n- Google Cloud Storage integration\n- Automatic file validation and processing\n- Support for images, videos, and documents\n\n### Activity Logging\n\n**Complete Documentation**: [Activity Router](./api/router/activity/activity.md)\n\n**Endpoints:**\n- `GET /{MODE}/activity` - Get activity logs with filtering\n- `GET /{MODE}/activity/{log_id}` - Get specific activity log\n- `POST /{MODE}/activity` - Create activity log entry\n\n**Features:**\n- Comprehensive audit trail\n- User action tracking\n- Request/response logging\n- Error logging with details\n- Metadata storage (JSONB)\n\n### Health Monitoring\n\n**Complete Documentation**: [Health Router](./api/router/health/health.md)\n\n**Endpoints:**\n- `GET /health` - Basic health check (no prefix)\n- `GET /{MODE}/health` - Detailed health check\n- `GET /{MODE}/health/system` - System health with metrics\n- `GET /{MODE}/health/database` - Database connection health\n- `GET /{MODE}/health/storage` - Storage (GCS) health check\n- `GET /{MODE}/health/test-sentry` - Test Sentry integration\n\n## ğŸ“¦ Installation & Setup\n\n### Prerequisites\n\n**System Requirements:**\n- **OS**: Linux (Ubuntu 20.04+), macOS, or Windows with WSL2\n- **Node.js**: 18.0 or higher\n- **npm**: 9.0 or higher\n- **PostgreSQL**: 12+ (for production)\n- **Redis**: 6+ (optional, for caching)\n- **Docker**: 20.10+ (for containerized deployment)\n- **Docker Compose**: 2.0+ (for multi-container orchestration)\n- **Google Cloud Storage**: Account and bucket (for media files)\n\n**Development Tools:**\n- Git 2.30+\n- Code editor (VS Code recommended)\n- Postman or similar API testing tool\n\n### Quick Start\n\n#### Step 1: Clone Repository\n\n```bash\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend-with-sql\n```\n\n#### Step 2: Setup Environment\n\n```bash\n# Copy example environment file\ncp example.env .env\n\n# Edit .env file with your configuration\nnano .env\n```\n\n#### Step 2.5: Setup Google Cloud Storage Credentials (Optional)\n\nIf you plan to use file upload features, you need to configure Google Cloud Storage credentials:\n\n```bash\n# Navigate to credentials directory\ncd api/credentials\n\n# Copy the template credential file\ncp \"google-backend-master copy.json\" google-backend-master.json\n\n# Edit the credential file with your Google Cloud Service Account credentials\nnano google-backend-master.json\n```\n\n**How to get Google Cloud Service Account credentials:**\n\n1. Go to [Google Cloud Console](https://console.cloud.google.com/)\n2. Select or create a project\n3. Navigate to **IAM & Admin** â†’ **Service Accounts**\n4. Create a new service account or select an existing one\n5. Click on the service account â†’ **Keys** tab\n6. Click **Add Key** â†’ **Create new key** â†’ Choose **JSON** format\n7. Download the JSON file\n8. Copy the contents of the downloaded JSON file into `api/credentials/google-backend-master.json`\n\n**Important Notes:**\n- The template file `google-backend-master copy.json` is provided as a reference\n- Your actual credentials file `google-backend-master.json` is ignored by git (for security)\n- Make sure your service account has the necessary permissions for Google Cloud Storage\n- Update `GOOGLE_STORAGE_BUCKET_NAME` in your `.env` file with your bucket name\n\n#### Step 3: Start Services with Docker Compose\n\n```bash\n# Create Docker network (if not exists)\ndocker network create nodejs_backend_with_postgresql_network\n\n# Start all services\ndocker compose up -d\n\n# Check service status\ndocker compose ps\n\n# View logs\ndocker compose logs -f api\n```\n\n#### Step 4: Setup Database Schema\n\n```bash\n# Generate Prisma Client\ndocker compose exec api npm run prisma:generate\n\n# Push schema to database\ndocker compose exec api npm run db:push\n\n# Seed database (optional)\ndocker compose exec api npm run db:seed\n\n# Apply migrations\ndocker compose exec api npm run migrate:dev    \n\n# Inspect DB with Prisma Studio\ndocker compose exec api npm run prisma:studio    \n```\n\n#### Step 5: Access Services\n\n- **API Base**: http://localhost:9080\n- **API Docs**: http://localhost:9080/api-docs\n- **Health Check**: http://localhost:9080/health (no prefix) or http://localhost:9080/{MODE}/health\n- **API Routes**: http://localhost:9080/{MODE}/* (e.g., /prod/v1/authenticate, /dev/v1/token)\n- **pgAdmin**: http://localhost:5050 (if enabled)\n\n**Note:** Replace `{MODE}` with your configured MODE value (e.g., `prod/v1` or `dev/v1`)\n\n### API Route Prefix (MODE)\n\nAll API routes are prefixed with the `MODE` environment variable. This allows you to version your API and separate environments.\n\n**Configuration in `.env`:**\n```bash\nMODE=prod/v1    # For production API version 1\n# or\nMODE=dev/v1     # For development API version 1\n```\n\n**API Route Examples:**\n\nIf `MODE=prod/v1`, all routes will be prefixed with `/prod/v1/`:\n- Health Check: `http://localhost:9080/prod/v1/health`\n- Authentication: `http://localhost:9080/prod/v1/authenticate`\n- Login: `http://localhost:9080/prod/v1/token`\n- Profile: `http://localhost:9080/prod/v1/settings`\n- Dashboard: `http://localhost:9080/prod/v1/dashboard`\n- Permissions: `http://localhost:9080/prod/v1/permissions`\n- Activity: `http://localhost:9080/prod/v1/activity`\n\nIf `MODE=dev/v1`, all routes will be prefixed with `/dev/v1/`:\n- Health Check: `http://localhost:9080/dev/v1/health`\n- Authentication: `http://localhost:9080/dev/v1/authenticate`\n- Login: `http://localhost:9080/dev/v1/token`\n- Profile: `http://localhost:9080/dev/v1/settings`\n- Dashboard: `http://localhost:9080/dev/v1/dashboard`\n- Permissions: `http://localhost:9080/dev/v1/permissions`\n- Activity: `http://localhost:9080/dev/v1/activity`\n\n**Note:** The `/health` endpoint is available without the MODE prefix for health checks:\n- Direct Health Check: `http://localhost:9080/health` (no prefix)\n\n### Development Setup\n\n#### Step 1: System Preparation\n\n```bash\n# Update system packages\nsudo apt update && sudo apt upgrade -y\n\n# Install Node.js 18+\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n\n# Install Docker (optional, for containerized development)\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n```\n\n#### Step 2: Project Setup\n\n```bash\n# Clone repository\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend-with-sql/api\n\n# Install dependencies\nnpm install\n```\n\n#### Step 3: Environment Configuration\n\n```bash\n# Copy example environment file\ncp ../example.env ../.env\n\n# Edit .env file with your settings\nnano ../.env\n```\n\n#### Step 3.5: Setup Google Cloud Storage Credentials (Optional)\n\nIf you plan to use file upload features, configure Google Cloud Storage credentials:\n\n```bash\n# Navigate to credentials directory\ncd credentials\n\n# Copy the template credential file\ncp \"google-backend-master copy.json\" google-backend-master.json\n\n# Edit the credential file with your Google Cloud Service Account credentials\nnano google-backend-master.json\n```\n\n**How to get Google Cloud Service Account credentials:**\n\n1. Go to [Google Cloud Console](https://console.cloud.google.com/)\n2. Select or create a project\n3. Navigate to **IAM & Admin** â†’ **Service Accounts**\n4. Create a new service account or select an existing one\n5. Click on the service account â†’ **Keys** tab\n6. Click **Add Key** â†’ **Create new key** â†’ Choose **JSON** format\n7. Download the JSON file\n8. Copy the contents of the downloaded JSON file into `api/credentials/google-backend-master.json`\n\n**Important Notes:**\n- The template file `google-backend-master copy.json` is provided as a reference\n- Your actual credentials file `google-backend-master.json` is ignored by git (for security)\n- Make sure your service account has the necessary permissions for Google Cloud Storage\n- Update `GOOGLE_STORAGE_BUCKET_NAME` in your `.env` file with your bucket name\n\n#### Step 4: Database Setup (Local PostgreSQL)\n\n```bash\n# Install PostgreSQL\nsudo apt install postgresql postgresql-contrib -y\n\n# Create database and user\nsudo -u postgres psql << EOF\nCREATE DATABASE nodejs_backend;\nCREATE USER nodejs_user WITH PASSWORD 'your_password';\nGRANT ALL PRIVILEGES ON DATABASE nodejs_backend TO nodejs_user;\n\\q\nEOF\n\n# Update .env with local database connection\n# DATABASE_URL=postgresql://nodejs_user:your_password@localhost:5432/nodejs_backend\n```\n\n#### Step 5: Prisma Setup\n\n```bash\n# ------------------------------\n# Prisma Client & Schema\n# ------------------------------\n\n# Regenerate Prisma Client after schema changes\nnpm run prisma:generate\n\n# Pull the current database schema into Prisma (update schema.prisma)\nnpm run prisma:pull\n\n# Push the Prisma schema to the database (without migration)\nnpm run prisma:push\n\n# Open Prisma Studio (GUI to view/edit database)\nnpm run prisma:studio\n\n# Format Prisma schema file\nnpm run prisma:format\n\n# Validate Prisma schema for errors\nnpm run prisma:validate\n\n# ------------------------------\n# Database seeding & syncing\n# ------------------------------\n\n# Pull data (custom seed script)\nnpm run db:pull\n\n# Push data (custom seed script)\nnpm run db:push\n\n# Sync data (custom seed script)\nnpm run db:sync\n\n# Seed the database with initial data\nnpm run db:seed\n\n# ------------------------------\n# Migrations\n# ------------------------------\n\n# Create and apply migrations (development)\nnpm run migrate:dev\n\n# Apply migrations in production\nnpm run migrate:deploy\n\n# Drop database and reapply all migrations (destructive)\nnpm run migrate:reset\n```\n\n#### Step 6: Seed Database (Optional)\n\n```bash\n# Seed with default data\nnpm run db:seed\n```\n\n#### Step 7: Start Development Server\n\n```bash\n# Development mode with auto-reload\nnpm run dev\n\n# Or start directly\nnpm start\n```\n\n#### Step 8: Access Application\n\n- **API Base**: http://localhost:3000\n- **API Docs**: http://localhost:3000/api-docs\n- **Health Check**: http://localhost:3000/health (no prefix) or http://localhost:3000/{MODE}/health\n- **API Routes**: http://localhost:3000/{MODE}/* (e.g., /prod/v1/authenticate, /dev/v1/token)\n- **Prisma Studio**: http://localhost:5555 (if running)\n\n**Note:** Replace `{MODE}` with your configured MODE value (e.g., `prod/v1` or `dev/v1`)\n\n### Production Setup\n\n#### Step 1: Server Preparation\n\n```bash\n# Update system\nsudo apt update && sudo apt upgrade -y\n\n# Install Node.js 18+\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\n\n# Install PM2\nnpm install -g pm2\n\n# Install Docker\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n```\n\n#### Step 2: Clone and Setup Project\n\n```bash\n# Clone repository\ngit clone https://github.com/fullstack-open-source/nodejs-backend-with-sql.git\ncd nodejs-backend-with-sql\n\n# Create production .env file\ncp example.env .env\n\n# Edit .env file with production settings\nnano .env\n```\n\n**Important**: Update `.env` file with production values:\n- Set `NODE_ENV=production`\n- Set `API_MODE=production`\n- Set `DEBUG_MODE=false`\n- Configure production database credentials\n- Set strong JWT secret (generate with: `openssl rand -base64 32`)\n- Configure production Redis, Sentry, and other services\n- Set `GOOGLE_STORAGE_BUCKET_NAME` with your production bucket name\n\n#### Step 2.5: Setup Google Cloud Storage Credentials (Required for File Upload)\n\nFor production file uploads, configure Google Cloud Storage credentials:\n\n```bash\n# Navigate to credentials directory\ncd api/credentials\n\n# Copy the template credential file\ncp \"google-backend-master copy.json\" google-backend-master.json\n\n# Edit the credential file with your production Google Cloud Service Account credentials\nnano google-backend-master.json\n```\n\n**How to get Google Cloud Service Account credentials:**\n\n1. Go to [Google Cloud Console](https://console.cloud.google.com/)\n2. Select or create a project\n3. Navigate to **IAM & Admin** â†’ **Service Accounts**\n4. Create a new service account or select an existing one\n5. Click on the service account â†’ **Keys** tab\n6. Click **Add Key** â†’ **Create new key** â†’ Choose **JSON** format\n7. Download the JSON file\n8. Copy the contents of the downloaded JSON file into `api/credentials/google-backend-master.json`\n\n**Production Security Notes:**\n- The template file `google-backend-master copy.json` is provided as a reference\n- Your actual credentials file `google-backend-master.json` is ignored by git (for security)\n- Use a dedicated service account with minimal required permissions\n- Enable Cloud Storage API in your Google Cloud project\n- Ensure your service account has **Storage Object Admin** or **Storage Admin** role\n- Never commit your actual credentials file to version control\n\n#### Step 3: Deploy with Docker (Recommended)\n\n```bash\n# Build and start services\ndocker compose build\ndocker compose up -d\n\n# Check status\ndocker compose ps\n\n# View logs\ndocker compose logs -f api\n\n# Run migrations\ndocker compose exec api npm run db:push\n```\n\n#### Step 4: Or Deploy with PM2\n\n```bash\ncd api\n\n# Generate Prisma Client\nnpm run prisma:generate\n\n# Start with PM2\nnpm run pm2:start\n\n# Check status\npm2 status\n\n# View logs\npm2 logs\n\n# Monitor\npm2 monit\n```\n\n#### Step 5: Configure External Proxy (Nginx)\n\n```bash\n# Install Nginx\nsudo apt install nginx -y\n\n# Create Nginx config\nsudo nano /etc/nginx/sites-available/api.example.com\n```\n\nAdd configuration:\n\n```nginx\nserver {\n    listen 80;\n    server_name api.example.com;\n\n    location / {\n        proxy_pass http://localhost:9080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\n```bash\n# Enable site\nsudo ln -s /etc/nginx/sites-available/api.example.com /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n```\n\n### Docker Setup\n\n#### Step 1: Prerequisites\n\n```bash\n# Check Docker version\ndocker --version\ndocker compose version\n\n# Install Docker if needed\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo apt install docker-compose-plugin -y\n```\n\n#### Step 2: Docker Compose Services\n\nThe `docker-compose.yaml` includes:\n- **api**: Node.js application (Express server)\n- **db**: PostgreSQL database\n- **redis**: Redis cache and session store\n- **nginx**: Internal reverse proxy\n- **pgadmin**: PostgreSQL admin interface\n\n#### Step 3: Build and Start Services\n\n```bash\n# Create Docker network\ndocker network create nodejs_backend_with_postgresql_network\n\n# Build images\ndocker compose build\n\n# Start all services\ndocker compose up -d\n\n# View all logs\ndocker compose logs -f\n\n# View specific service logs\ndocker compose logs -f api\ndocker compose logs -f nginx\n```\n\n#### Step 4: Service Management\n\n```bash\n# Stop services\ndocker compose stop\n\n# Start services\ndocker compose start\n\n# Restart services\ndocker compose restart\n\n# Restart specific service\ndocker compose restart api\n\n# Stop and remove containers\ndocker compose down\n\n# Stop, remove containers, and volumes\ndocker compose down -v\n```\n\n#### Step 5: Execute Commands in Containers\n\n```bash\n# Run Prisma migrations\ndocker compose exec api npm run db:push\n\n# Generate Prisma Client\ndocker compose exec api npm run prisma:generate\n\n# Access container shell\ndocker compose exec api sh\n\n# Run database seed\ndocker compose exec api npm run db:seed\n\n# Access PostgreSQL\ndocker compose exec db psql -U postgres -d postgres\n```\n\n#### Step 6: Health Checks\n\n```bash\n# Check service health\ndocker compose ps\n\n# Test API health endpoint\ncurl http://localhost:8900/health\n\n# Test Nginx health endpoint\ncurl http://localhost:9080/health\n\n# Check database connection\ndocker compose exec api npm run prisma:studio\n```\n\n#### Step 7: Network Configuration\n\n```bash\n# Create network (if not exists)\ndocker network create nodejs_backend_with_postgresql_network\n\n# Verify network\ndocker network ls\n\n# Inspect network\ndocker network inspect nodejs_backend_with_postgresql_network\n```\n\n## ğŸ”„ Complete Project Workflow\n\n### Service Connection Architecture\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Docker Network                               â”‚\nâ”‚              (nodejs_backend_with_postgresql_network)           â”‚\nâ”‚                                                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚\nâ”‚  â”‚   Client     â”‚                                               â”‚\nâ”‚  â”‚  (Browser)   â”‚                                               â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚\nâ”‚         â”‚                                                       â”‚\nâ”‚         â”‚ HTTP/HTTPS (Port 9080)                                â”‚\nâ”‚         â–¼                                                       â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  Nginx Service                                           â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-nginx                         â”‚   â”‚\nâ”‚  â”‚  Port: 9080:80 (host:container)                          â”‚   â”‚\nâ”‚  â”‚  Config: ./nginx/nginx.conf                              â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚         â”‚                                                       â”‚\nâ”‚         â”‚ Proxy to http://api:3000                              â”‚\nâ”‚         â–¼                                                       â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  API Service (Node.js/Express)                           â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend                               â”‚   â”‚\nâ”‚  â”‚  Port: 3000 (internal only)                              â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚\nâ”‚  â”‚  â”‚  Prisma Client                                     â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Reads schema.prisma                             â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Generates type-safe queries                     â”‚  â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚            â”‚ PostgreSQL Connection                              â”‚\nâ”‚            â”‚ (postgresql://postgres:postgres@                   â”‚\nâ”‚            â”‚  nodejs-backend-db:5432/postgres)                  â”‚\nâ”‚            â–¼                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  PostgreSQL Service                                      â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-db                            â”‚   â”‚\nâ”‚  â”‚  Port: 5432 (internal only)                              â”‚   â”‚\nâ”‚  â”‚  Volume: postgres_data (persistent)                      â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚\nâ”‚  â”‚  â”‚  Database: postgres                                â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - User table                                      â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Permission table                                â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Group table                                     â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - ActivityLog table                               â”‚  â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ”‚            â–²                                                    â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚            â”‚ Redis Connection                                   â”‚\nâ”‚            â”‚ (redis://nodejs-backend-redis:6379)                â”‚\nâ”‚            â”‚                                                    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚\nâ”‚  â”‚  Redis Service                                         â”‚     â”‚\nâ”‚  â”‚  Container: nodejs-backend-redis                       â”‚     â”‚\nâ”‚  â”‚  Port: 6379 (internal only)                            â”‚     â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚\nâ”‚  â”‚  â”‚  Cache Storage                                   â”‚  â”‚     â”‚\nâ”‚  â”‚  â”‚  - OTP cache                                     â”‚  â”‚     â”‚\nâ”‚  â”‚  â”‚  - Session storage                               â”‚  â”‚     â”‚\nâ”‚  â”‚  â”‚  - Token blacklist                               â”‚  â”‚     â”‚\nâ”‚  â”‚  â”‚  - Rate limiting data                            â”‚  â”‚     â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚\nâ”‚                                                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚\nâ”‚  â”‚  pgAdmin Service (Optional)                              â”‚   â”‚\nâ”‚  â”‚  Container: nodejs-backend-pgadmin                       â”‚   â”‚\nâ”‚  â”‚  Port: 5050:80 (host:container)                          â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚\nâ”‚  â”‚  â”‚  Web Interface                                     â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Database management                             â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Query execution                                 â”‚  â”‚   â”‚\nâ”‚  â”‚  â”‚  - Schema visualization                            â”‚  â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚\nâ”‚  â”‚         â”‚                                                â”‚   â”‚\nâ”‚  â”‚         â”‚ PostgreSQL Connection                          â”‚   â”‚\nâ”‚  â”‚         â”‚ (nodejs-backend-db:5432)                       â”‚   â”‚\nâ”‚  â”‚         â–¼                                                â”‚   â”‚\nâ”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚\nâ”‚  â”‚  â”‚  Connects to PostgreSQL Service                  â”‚    â”‚   â”‚\nâ”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Service Startup Order\n\n```\n1. Docker Network\n   â””â”€â–º nodejs_backend_with_postgresql_network\n\n2. Database Services (Start First)\n   â”œâ”€â–º PostgreSQL (nodejs-backend-db:5432)\n   â””â”€â–º Redis (nodejs-backend-redis:6379)\n\n3. API Service (Waits for Database Health Checks)\n   â”œâ”€â–º Connects to PostgreSQL via Prisma\n   â””â”€â–º Connects to Redis for Cache\n\n4. Nginx Service (Waits for API Health Check)\n   â””â”€â–º Proxies to API (http://api:3000)\n\n5. pgAdmin Service (Optional, Waits for Database)\n   â””â”€â–º Connects to PostgreSQL\n```\n\n### Connection Flow\n\n```\nClient Request\n    â”‚\n    â–¼\nPort 9080 (Host) â”€â”€â–º Nginx â”€â”€â–º Port 3000 â”€â”€â–º API Service\n                                         â”‚\n                                         â”œâ”€â–º PostgreSQL (Port 5432)\n                                         â””â”€â–º Redis (Port 6379)\n```\n\n## ğŸ” Authentication System\n\n### Multi-Token Architecture\n\nThe authentication system uses a **three-token approach** similar to Instagram:\n\n1. **Access Token** (1 hour)\n   - Lightweight token for API authentication\n   - Minimal payload for fast validation\n   - Includes JTI (JWT ID) for efficient blacklisting\n\n2. **Session Token** (7 days) - **Recommended**\n   - Contains full user profile and permissions\n   - Fastest validation (no database lookup needed)\n   - Preferred for frontend API calls\n\n3. **Refresh Token** (30 days)\n   - Used to obtain new tokens when they expire\n   - Cannot be used for API authentication\n   - Rotates on each refresh for security\n\n**Complete Documentation**: [Authentication Router](./api/router/authenticate/authenticate.md)\n\n### Token Usage\n\n**Recommended Approach (Session Token):**\n```javascript\n// Store tokens after login\n{\n    \"access_token\": \"...\",\n    \"session_token\": \"...\",  // RECOMMENDED for API calls\n    \"refresh_token\": \"...\",\n    \"session_id\": \"...\"\n}\n\n// Use session_token for API calls (fastest validation)\nheaders = {\n    \"X-Session-Token\": session_token  // Preferred\n    // OR\n    \"Authorization\": `Bearer ${session_token}`  // Also works\n}\n```\n\n---\n\n## ğŸ“„ License & Open Source\n\nThis project is **open source** and **free to use** for all purposes with **no restrictions**.\n\n### ğŸ¯ Open Source License\n\nThis project is released under the **[MIT License](LICENSE)**, which means:\n\n- âœ… **Free to use** for any purpose (commercial or personal)\n- âœ… **No restrictions** on usage, modification, or distribution\n- âœ… **No warranty** provided\n- âœ… **Attribution** is appreciated but not required\n\n**ğŸ“„ Full License Text**: See [LICENSE](LICENSE) file for complete license terms and conditions.\n\n### ğŸ™ Technologies & Acknowledgments\n\nThis project is built with amazing open-source technologies. Special thanks to:\n\n#### Core Framework & Runtime\n- **[Node.js](https://nodejs.org/)** - JavaScript runtime built on Chrome's V8 engine\n- **[Express.js](https://expressjs.com/)** - Fast, unopinionated web framework for Node.js\n\n#### Database & ORM\n- **[PostgreSQL](https://www.postgresql.org/)** - Advanced open-source relational database\n- **[Prisma](https://www.prisma.io/)** - Next-generation ORM for Node.js and TypeScript\n- **[Redis](https://redis.io/)** - In-memory data structure store\n\n#### Security & Authentication\n- **[JWT (jsonwebtoken)](https://github.com/auth0/node-jsonwebtoken)** - JSON Web Token implementation\n- **[bcryptjs](https://github.com/dcodeIO/bcrypt.js)** - Password hashing library\n- **[Helmet](https://helmetjs.github.io/)** - Security middleware for Express\n\n#### Monitoring & Logging\n- **[Winston](https://github.com/winstonjs/winston)** - Logging library for Node.js\n- **[Sentry](https://sentry.io/)** - Error tracking and performance monitoring\n- **[Morgan](https://github.com/expressjs/morgan)** - HTTP request logger middleware\n\n#### API Documentation\n- **[Swagger](https://swagger.io/)** - API documentation and testing tools\n- **[swagger-jsdoc](https://github.com/Swaagie/swagger-jsdoc)** - Swagger specification generator\n- **[swagger-ui-express](https://github.com/scottie1984/swagger-ui-express)** - Swagger UI for Express\n\n#### Utilities & Middleware\n- **[CORS](https://github.com/expressjs/cors)** - Cross-Origin Resource Sharing middleware\n- **[compression](https://github.com/expressjs/compression)** - Response compression middleware\n- **[express-rate-limit](https://github.com/expressjs/express-rate-limit)** - Rate limiting middleware\n- **[express-validator](https://express-validator.github.io/)** - Request validation middleware\n- **[Joi](https://joi.dev/)** - Schema validation library\n\n#### Communication Services\n- **[Nodemailer](https://nodemailer.com/)** - Email sending library\n- **[Twilio](https://www.twilio.com/)** - Cloud communications platform\n\n#### Storage\n- **[Google Cloud Storage](https://cloud.google.com/storage)** - Object storage service\n- **[Multer](https://github.com/expressjs/multer)** - File upload middleware\n\n#### Process Management\n- **[PM2](https://pm2.keymetrics.io/)** - Production process manager for Node.js\n\n#### Containerization\n- **[Docker](https://www.docker.com/)** - Containerization platform\n- **[Docker Compose](https://docs.docker.com/compose/)** - Multi-container Docker application tool\n\n#### Web Server\n- **[Nginx](https://www.nginx.com/)** - High-performance web server and reverse proxy\n\n### ğŸŒŸ Contributing\n\nContributions are welcome! This is an open-source project, and we encourage:\n\n- ğŸ› Bug reports\n- ğŸ’¡ Feature requests\n- ğŸ“ Documentation improvements\n- ğŸ”§ Code contributions\n- â­ Starring the repository\n\n### ğŸ“ Support\n\nFor issues, questions, or contributions, please visit:\n- **Repository**: [https://github.com/fullstack-open-source/nodejs-backend-with-sql](https://github.com/fullstack-open-source/nodejs-backend-with-sql)\n- **Issues**: Open an issue on GitHub\n\n---\n\n**Made with â¤ï¸ using open-source technologies**\n\n*This project is free to use, modify, and distribute for any purpose without restrictions.*\n\n---\n\n## ğŸ“œ License\n\nCopyright (c) 2025 Full Stack Open Source\n\nThis project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.\n",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "50285861",
		"_collection_link": "https://mrdasdeveloper-8273774.postman.co/workspace/Mrdas-Developer's-Workspace~c3439a6d-6548-421b-8c58-c3ae9bcb8cd2/collection/50285861-11918d16-52fa-486e-ab9d-9fa5f9e8be25?action=share&source=collection_link&creator=50285861"
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "login-with-password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"username\": \"mrdasdeveloper2@gmail.com\",\n  \"password\": \"Admin@404!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"login-with-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "username",
											"value": "admin@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Admin@404!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "+96555139166",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Mrdasdeveloper@2021!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "mrdas4321@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Qwer4321!",
											"type": "text"
										},
										{
											"key": "username",
											"value": "+96598379785",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"login-with-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:43:28 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "1882"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"f39942d1-3fd8-4c7f-a910-589c46cfa15b\",\n    \"message\": \"Login successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxYTFhMTcyOC05MTkwLTQ1YWUtODUyZC00ZDVmYWNiMDY2MGUiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg1IiwiZmlyc3RfbmFtZSI6ImFhIiwibGFzdF9uYW1lIjoiYWEiLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE5ODA4LCJpYXQiOjE3NjMwMTYyMDgsImp0aSI6ImU2Yzg3ZGNjLTA5NzYtNGE0Yi05MTk0LTdiZTM3Njg4OGEyYiIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjFhMWExNzI4LTkxOTAtNDVhZS04NTJkLTRkNWZhY2IwNjYwZSIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjoiYWEiLCJsYXN0X25hbWUiOiJhYSIsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg1IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg1In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOiIyMDI1LTExLTEzVDA2OjIzOjI5LjI3MzE3NyswMDowMCIsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMzoyNi4zODk4NDcrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIzOjU1LjA3Mzg4NyswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.K2Sm0FUHg8Tj2mYaa0i1Ak9lRt2sd07ZHcrh1b30MfU\",\n        \"token_type\": \"bearer\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:43:28.980740Z\"\n}"
						}
					]
				},
				{
					"name": "login-with-otp",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdasdeveloper2@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/login-with-otp",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"login-with-otp"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "username",
											"value": "admin@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Admin@404!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "+96555139166",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Mrdasdeveloper@2021!!",
											"type": "text",
											"disabled": true
										},
										{
											"key": "username",
											"value": "mrdas4321@gmail.com",
											"type": "text",
											"disabled": true
										},
										{
											"key": "password",
											"value": "Qwer4321!",
											"type": "text"
										},
										{
											"key": "username",
											"value": "+96598379785",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/login-with-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"login-with-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:43:28 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "1882"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"f39942d1-3fd8-4c7f-a910-589c46cfa15b\",\n    \"message\": \"Login successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxYTFhMTcyOC05MTkwLTQ1YWUtODUyZC00ZDVmYWNiMDY2MGUiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg1IiwiZmlyc3RfbmFtZSI6ImFhIiwibGFzdF9uYW1lIjoiYWEiLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE5ODA4LCJpYXQiOjE3NjMwMTYyMDgsImp0aSI6ImU2Yzg3ZGNjLTA5NzYtNGE0Yi05MTk0LTdiZTM3Njg4OGEyYiIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjFhMWExNzI4LTkxOTAtNDVhZS04NTJkLTRkNWZhY2IwNjYwZSIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjoiYWEiLCJsYXN0X25hbWUiOiJhYSIsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg1IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg1In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOiIyMDI1LTExLTEzVDA2OjIzOjI5LjI3MzE3NyswMDowMCIsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMzoyNi4zODk4NDcrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIzOjU1LjA3Mzg4NyswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.K2Sm0FUHg8Tj2mYaa0i1Ak9lRt2sd07ZHcrh1b30MfU\",\n        \"token_type\": \"bearer\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:43:28.980740Z\"\n}"
						}
					]
				},
				{
					"name": "refresh-token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    // Access Token",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    // Refresh Token",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"",
									"    // Session ID",
									"    if (response.data.session_id) {",
									"        pm.environment.set(\"session_id\", response.data.session_id);",
									"        console.log(\"Session ID updated:\", response.data.session_id);",
									"    }",
									"",
									"    // Session Token",
									"    if (response.data.session_token) {",
									"        pm.environment.set(\"session_token\", response.data.session_token);",
									"        console.log(\"Session token updated:\", response.data.session_token);",
									"    }",
									"",
									"    // Token Type",
									"    if (response.data.token_type) {",
									"        pm.environment.set(\"token_type\", response.data.token_type);",
									"        console.log(\"Token type updated:\", response.data.token_type);",
									"    }",
									"",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/refresh-token",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"refresh-token"
							]
						}
					},
					"response": []
				},
				{
					"name": "check-user-availability",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"admin@gmail.com\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/check-user-availability",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"check-user-availability"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379785\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/check-user-availability",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"check-user-availability"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Tue, 18 Nov 2025 05:44:58 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "221"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"ae60ef2a-af4a-4eb0-bc25-fffc1ce08d10\",\n    \"message\": \"User is not available\",\n    \"data\": {\n        \"available\": false,\n        \"first_name\": null,\n        \"last_name\": null\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-18T05:44:58.600406Z\"\n}"
						}
					]
				},
				{
					"name": "send-one-time-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdasdeveloper@gmail.com\",\n  \"channel\": \"email\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/send-one-time-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"send-one-time-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379784\",\n  \"channel\": \"sms\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/send-one-time-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"send-one-time-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:21:20 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "202"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"48d6631f-d79c-46cf-ba49-6c7fe2311997\",\n    \"message\": \"OTP sent successfully\",\n    \"data\": {\n        \"message\": \"OTP sent successfully\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:21:20.628884Z\"\n}"
						}
					]
				},
				{
					"name": "verify-one-time-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"+96598379782\",\n  \"channel\": \"sms\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify-one-time-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify-one-time-password"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379785\",\n  \"channel\": \"sms\",\n  \"otp\": \"473245\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/verify-one-time-password",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"verify-one-time-password"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "Text",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 08:05:22 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json"
								},
								{
									"key": "Content-Length",
									"value": "223"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"94e5ae63-f091-44c1-b25e-9eebb540b387\",\n    \"message\": \"Verify Successfully\",\n    \"data\": {\n        \"user_id\": \"+96598379785\",\n        \"message\": \"Verify Successfully\"\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T08:05:22.776751Z\"\n}"
						}
					]
				},
				{
					"name": "Verify Signup",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"",
									"// Check if the response succeeded",
									"if (response.success && response.data) {",
									"    if (response.data.access_token) {",
									"        pm.environment.set(\"access_token\", response.data.access_token);",
									"        console.log(\"Access token updated:\", response.data.access_token);",
									"    }",
									"",
									"    if (response.data.refresh_token) {",
									"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
									"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
									"    }",
									"} else {",
									"    console.log(\"No token found in response:\", response);",
									"}",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mrdasdeveloper1@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify"
							]
						}
					},
					"response": [
						{
							"name": "success",
							"originalRequest": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"user_id\": \"+96598379784\",\n  \"channel\": \"sms\",\n  \"otp\": \"553916\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/auth/verify",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"auth",
										"verify"
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Thu, 13 Nov 2025 06:21:51 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "2483"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"fcbd4a21-228b-44f4-948e-51d49e08f934\",\n    \"message\": \"Signup successful\",\n    \"data\": {\n        \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MDYyMzc0ZS1mYzNkLTQ4NGEtODE3OC1jMGZhZDg2YTA3YjYiLCJ1c2VybmFtZSI6Ijk2NTk4Mzc5Nzg0IiwiZmlyc3RfbmFtZSI6bnVsbCwibGFzdF9uYW1lIjpudWxsLCJlbWFpbCI6bnVsbCwiZXhwIjoxNzYzMDE4NTExLCJpYXQiOjE3NjMwMTQ5MTEsImp0aSI6IjZlMTI1OWUyLWRkMmMtNDNhNS05YzQzLTJmYThjZTI4NDRiMCIsInR5cGUiOiJhY2Nlc3MiLCJ1c2VyX3Byb2ZpbGUiOnsidXNlcl9pZCI6IjQwNjIzNzRlLWZjM2QtNDg0YS04MTc4LWMwZmFkODZhMDdiNiIsImVtYWlsIjpudWxsLCJmaXJzdF9uYW1lIjpudWxsLCJsYXN0X25hbWUiOm51bGwsInVzZXJfbmFtZSI6Ijk2NTk4Mzc5Nzg0IiwicGhvbmVfbnVtYmVyIjp7InBob25lIjoiKzk2NTk4Mzc5Nzg0In0sImNvdW50cnkiOm51bGwsImRvYiI6bnVsbCwicHJvZmlsZV9waWN0dXJlX3VybCI6bnVsbCwiYmlvIjpudWxsLCJwb3J0Zm9saW9fdXJsIjpudWxsLCJzaG93X2tsaWt5X3dhdGVybWFyayI6dHJ1ZSwiYWRzX3Nob3dfdHlwZSI6InB1YmxpYyIsImF1dGhfdHlwZSI6InBob25lIiwidGhlbWUiOiJsaWdodCIsInByb2ZpbGVfYWNjZXNzaWJpbGl0eSI6InB1YmxpYyIsInVzZXJfdHlwZSI6ImN1c3RvbWVyIiwibGFuZ3VhZ2UiOiJlbiIsImlzX2RyYWZ0IjpmYWxzZSwiaXNfZGVsZXRlZCI6ZmFsc2UsInN0YXR1cyI6IkFjdGl2ZSIsInJvbGVfaWQiOm51bGwsInRpbWV6b25lIjpudWxsLCJpbnZpdGVkX2J5X3VzZXJfaWQiOm51bGwsImlzX3Byb3RlY3RlZCI6ZmFsc2UsImlzX3RyYXNoZWQiOmZhbHNlLCJsYXN0X3NpZ25faW5fYXQiOm51bGwsImVtYWlsX3ZlcmlmaWVkX2F0IjpudWxsLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0xM1QwNjoyMTo0Ny43ODc4MzgrMDA6MDAiLCJsYXN0X3VwZGF0ZWQiOiIyMDI1LTExLTEzVDA2OjIxOjQ3Ljc4NzgzOCswMDowMCJ9LCJwZXJtaXNzaW9ucyI6eyJpc19zdXBlcnVzZXIiOmZhbHNlLCJpc19hZG1pbiI6ZmFsc2UsImlzX2J1c2luZXNzIjpmYWxzZSwiaXNfYWNjb3VudGFudCI6ZmFsc2UsImlzX2RldmVsb3BlciI6ZmFsc2UsImlzX3VzZXIiOnRydWUsImlzX2FjdGl2ZSI6dHJ1ZSwiaXNfdmVyaWZpZWQiOnRydWV9LCJhdWQiOiJhdXRoZW50aWNhdGVkIiwib3JpZ2luIjoiaHR0cHM6Ly92My5zdGFnaW5nLndpbnN0YS5wcm8ifQ.m4bFg4EugMKOzGNweOH7pzj8jhnYY5bGpmJ0v1Pnvns\",\n        \"token_type\": \"bearer\",\n        \"user\": {\n            \"user_id\": \"4062374e-fc3d-484a-8178-c0fad86a07b6\",\n            \"phone_number\": {\n                \"phone\": \"+96598379784\"\n            },\n            \"user_name\": \"96598379784\",\n            \"show_kliky_watermark\": true,\n            \"ads_show_type\": \"public\",\n            \"auth_type\": \"phone\",\n            \"theme\": \"light\",\n            \"profile_accessibility\": \"public\",\n            \"user_type\": \"customer\",\n            \"language\": \"en\",\n            \"is_draft\": false,\n            \"is_active\": true,\n            \"is_verified\": true,\n            \"is_deleted\": false,\n            \"status\": \"Active\",\n            \"is_protected\": false,\n            \"is_trashed\": false,\n            \"created_at\": \"2025-11-13T06:21:47.787838+00:00\",\n            \"last_updated\": \"2025-11-13T06:21:47.787838+00:00\",\n            \"is_user\": true,\n            \"is_superuser\": false,\n            \"is_admin\": false,\n            \"is_business\": false,\n            \"is_accountant\": false,\n            \"is_developer\": false,\n            \"posts\": []\n        }\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-13T06:21:51.249808Z\"\n}"
						}
					]
				},
				{
					"name": "set-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"password\": \"Admin@404!!\",\n  \"confirm_password\": \"Admin@404!!\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/set-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"set-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "// {\n//   \"user_id\":\"klikyng3@gmail.com\",\n//   \"channel\": \"email\",  \n//   \"old_password\": \"Mrdasdeveloper@2021!!\",\n//   \"password\": \"Klikyng@2021!!\",\n//   \"confirm_password\": \"Klikyng@2021!!\"\n// }\n\n{\n  \"user_id\":\"+96598379555\",\n  \"channel\": \"sms\",  \n  \"old_password\": \"Mrdasdeveloper@2021!!\",\n  \"password\": \"Klikyng@2021!!\",\n  \"confirm_password\": \"Klikyng@2021!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/change-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"change-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "forget-password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "\n{\n  \"user_id\":\"+96598379785\",\n  \"otp\":\"473245\",\n  \"password\": \"Klikyng@2021!!\",\n  \"confirm_password\": \"Klikyng@2021!!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/forget-password",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"forget-password"
							]
						}
					},
					"response": []
				},
				{
					"name": "logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"if (response.access_token) {",
									"    pm.environment.set(\"access_token\", response.access_token);",
									"    console.log(\"Access token updated:\", response.access_token);",
									"}",
									"",
									"if (response.refresh_token) {",
									"    pm.environment.set(\"refresh_token\", response.refresh_token);",
									"    console.log(\"Refresh token updated:\", response.refresh_token);",
									"}"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\": \"{{access_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/logout",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"logout"
							]
						}
					},
					"response": []
				},
				{
					"name": "verify-email-and-phone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"mahdi.mansournia@gmail.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/verify-email-and-phone",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"verify-email-and-phone"
							]
						}
					},
					"response": []
				},
				{
					"name": "token-info",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/token-info",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"token-info"
							]
						}
					},
					"response": []
				},
				{
					"name": "token-info",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{session_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"access_token\": \"{{access_token}}\",\n  \"session_token\": \"{{session_token}}\",\n  \"refresh_token\": \"{{refresh_token}}\"\n}\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/token-info",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"token-info"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Authentication Router\n\n> **Complete Documentation for User Authentication Endpoints** \n  \n\nThis router handles all user authentication operations including login, registration, password management, OTP verification, and user availability checks.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    - [Login with Password](#login-with-password)\n        \n    - [Send OTP](#send-otp)\n        \n    - [Verify OTP](#verify-otp)\n        \n    - [Login with OTP](#login-with-otp)\n        \n    - [Signup/Register](#signupregister)\n        \n    - [Set Password](#set-password)\n        \n    - [Change Password](#change-password)\n        \n    - [Forget Password](#forget-password)\n        \n    - [Logout](#logout)\n        \n    - [Refresh Token](#refresh-token)\n        \n    - [Token Info](#token-info)\n        \n    - [Check User Availability](#check-user-availability)\n        \n    - [Verify Email and Phone](#verify-email-and-phone)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Authentication router provides comprehensive user authentication functionality including:\n\n- **Password-based Authentication**: Traditional email/phone + password login\n    \n- **OTP-based Authentication**: One-time password via email, SMS, or WhatsApp\n    \n- **User Registration**: Account creation with OTP verification\n    \n- **Password Management**: Set, change, and reset passwords\n    \n- **User Verification**: Email and phone number verification\n    \n- **Token Management**: Multi-token system (access, refresh, session) with token rotation\n    \n- **Session Management**: Session-based authentication with comprehensive token revocation\n    \n\n**Base Path:** `/{MODE}/auth` or `/{MODE}/token` or `/{MODE}/logout`\n\n**Authentication:** Most endpoints do not require authentication (except password change, logout, and token-info)\n\n## Endpoints\n\n### Login with Password\n\n**Endpoint:** `POST /{MODE}/token` or `POST /{MODE}/auth/login-with-password`\n\n**Description:** Authenticate user with email/phone and password. Returns JWT access token upon successful authentication.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"username\": \"user@example.com\",\n  \"password\": \"your-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Login successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"uuid\",\n    \"token_type\": \"bearer\",\n    \"user\": {\n      \"user_id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"first_name\": \"John\",\n      \"last_name\": \"Doe\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request Format\n   â”‚   â”œâ”€â–º Check username exists\n   â”‚   â””â”€â–º Check password exists\n   â”‚\n   â”œâ”€â–º Authenticate User\n   â”‚   â”œâ”€â–º Get User by Email/Phone\n   â”‚   â”œâ”€â–º Verify Password (bcrypt)\n   â”‚   â”œâ”€â–º Check User Status (is_active, is_verified)\n   â”‚   â””â”€â–º Update Last Sign-in\n   â”‚\n   â”œâ”€â–º Generate All Tokens\n   â”‚   â”œâ”€â–º Generate Access Token\n   â”‚   â”œâ”€â–º Generate Refresh Token\n   â”‚   â”œâ”€â–º Generate Session Token\n   â”‚   â”œâ”€â–º Create Session ID\n   â”‚   â””â”€â–º Sign with JWT_SECRET\n   â”‚\n   â””â”€â–º Return All Tokens + User Data\n\n ```\n\n**Use Cases:**\n\n- User login\n    \n- Session establishment\n    \n- API access token generation\n    \n\n---\n\n### Send OTP\n\n**Endpoint:** `POST /{MODE}/auth/send-one-time-password`\n\n**Description:** Send one-time password via email, SMS, or WhatsApp. OTP is valid for 10 minutes.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\"\n}\n\n ```\n\n**Channel Options:**\n\n- `email`: Send OTP via email\n    \n- `sms`: Send OTP via SMS\n    \n- `whatsapp`: Send OTP via WhatsApp\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"OTP sent successfully\",\n  \"data\": {\n    \"message\": \"OTP sent successfully\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â””â”€â–º channel required (email/sms/whatsapp)\n   â”‚\n   â”œâ”€â–º Generate OTP\n   â”‚   â”œâ”€â–º Generate 6-digit code\n   â”‚   â””â”€â–º Store in Redis (600 seconds TTL)\n   â”‚\n   â”œâ”€â–º Send OTP via Channel\n   â”‚   â”œâ”€â–º email â†’ Send Email via Nodemailer\n   â”‚   â”œâ”€â–º sms â†’ Send SMS via Twilio\n   â”‚   â””â”€â–º whatsapp â†’ Send WhatsApp via Twilio\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Use Cases:**\n\n- Password reset\n    \n- Email/phone verification\n    \n- Two-factor authentication\n    \n- Account recovery\n    \n\n---\n\n### Verify OTP\n\n**Endpoint:** `POST /{MODE}/auth/verify-one-time-password`\n\n**Description:** Verify one-time password without logging in. Used for verification purposes.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Verify Successfully\",\n  \"data\": {\n    \"user_id\": \"user@example.com\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â”œâ”€â–º channel required\n   â”‚   â””â”€â–º otp required\n   â”‚\n   â”œâ”€â–º Verify OTP\n   â”‚   â”œâ”€â–º Get OTP from Redis\n   â”‚   â”œâ”€â–º Compare with provided OTP\n   â”‚   â””â”€â–º Check expiration\n   â”‚\n   â””â”€â–º Return Verification Result\n       â””â”€â–º OTP not deleted (for reuse)\n\n ```\n\n**Use Cases:**\n\n- Email verification\n    \n- Phone verification\n    \n- Pre-login verification\n    \n\n---\n\n### Login with OTP\n\n**Endpoint:** `POST /{MODE}/auth/login-with-otp`\n\n**Description:** Verify OTP and login user. Returns access token upon successful verification. OTP is deleted after successful login.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Login successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"uuid\",\n    \"token_type\": \"bearer\",\n    \"user\": {\n      \"user_id\": \"uuid\",\n      \"email\": \"user@example.com\",\n      \"first_name\": \"John\",\n      \"last_name\": \"Doe\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request Format\n   â”‚   â”œâ”€â–º Validate email/phone format\n   â”‚   â””â”€â–º Check required fields\n   â”‚\n   â”œâ”€â–º Get User\n   â”‚   â””â”€â–º getUserByEmailOrPhone()\n   â”‚\n   â”œâ”€â–º Check User Status\n   â”‚   â”œâ”€â–º is_active = true\n   â”‚   â””â”€â–º is_verified = true\n   â”‚\n   â”œâ”€â–º Verify OTP\n   â”‚   â”œâ”€â–º Get OTP from Redis\n   â”‚   â”œâ”€â–º Compare with provided OTP\n   â”‚   â””â”€â–º Delete OTP (consume=true)\n   â”‚\n   â”œâ”€â–º Update Last Sign-in\n   â”‚   â””â”€â–º updateLastSignIn()\n   â”‚\n   â”œâ”€â–º Generate All Tokens\n   â”‚   â”œâ”€â–º Generate Access Token\n   â”‚   â”œâ”€â–º Generate Refresh Token\n   â”‚   â”œâ”€â–º Generate Session Token\n   â”‚   â””â”€â–º Create Session ID\n   â”‚\n   â””â”€â–º Return All Tokens + User Data\n\n ```\n\n**Use Cases:**\n\n- Passwordless login\n    \n- Quick authentication\n    \n- Mobile app login\n    \n\n---\n\n### Signup/Register\n\n**Endpoint:** `POST /{MODE}/auth/verify`\n\n**Description:** Verify OTP and create new user account. Supports master OTP for admin account creation.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Signup successful\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"uuid\",\n    \"token_type\": \"bearer\",\n    \"user\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â”œâ”€â–º channel required\n   â”‚   â””â”€â–º otp required\n   â”‚\n   â”œâ”€â–º Check Master OTP (if applicable)\n   â”‚   â””â”€â–º If master OTP, skip verification\n   â”‚\n   â”œâ”€â–º Verify OTP\n   â”‚   â””â”€â–º verifyOtp() (consume=false)\n   â”‚\n   â”œâ”€â–º Validate Email/Phone Format\n   â”‚   â”œâ”€â–º Email â†’ validateEmail()\n   â”‚   â””â”€â–º Phone â†’ validatePhone()\n   â”‚\n   â”œâ”€â–º Check User Exists\n   â”‚   â””â”€â–º getUserByEmailOrPhone()\n   â”‚\n   â”œâ”€â–º Create User Account\n   â”‚   â”œâ”€â–º Set Default Values\n   â”‚   â”‚   â”œâ”€â–º is_active: true\n   â”‚   â”‚   â”œâ”€â–º is_verified: true\n   â”‚   â”‚   â”œâ”€â–º profile_accessibility: public\n   â”‚   â”‚   â”œâ”€â–º theme: light\n   â”‚   â”‚   â”œâ”€â–º user_type: customer\n   â”‚   â”‚   â”œâ”€â–º language: en\n   â”‚   â”‚   â””â”€â–º status: ACTIVE\n   â”‚   â”œâ”€â–º Set Auth Type\n   â”‚   â”‚   â”œâ”€â–º email â†’ AuthTypeEnum.email\n   â”‚   â”‚   â””â”€â–º phone â†’ AuthTypeEnum.phone\n   â”‚   â””â”€â–º Set Verification Status\n   â”‚       â”œâ”€â–º Email verified if channel=email\n   â”‚       â””â”€â–º Phone verified if channel=sms/whatsapp\n   â”‚\n   â”œâ”€â–º Assign Groups (if master OTP)\n   â”‚   â””â”€â–º Assign admin group\n   â”‚\n   â”œâ”€â–º Generate All Tokens\n   â”‚   â”œâ”€â–º Generate Access Token\n   â”‚   â”œâ”€â–º Generate Refresh Token\n   â”‚   â”œâ”€â–º Generate Session Token\n   â”‚   â””â”€â–º Create Session ID\n   â”‚\n   â”œâ”€â–º Delete OTP (if not master OTP)\n   â”‚   â””â”€â–º verifyOtp(consume=true)\n   â”‚\n   â””â”€â–º Return All Tokens + User Data\n\n ```\n\n**Special Features:**\n\n- **Master OTP**: If `MASTER_OTP` environment variable matches, user is assigned admin group\n    \n- **Auto-verification**: Email/phone is automatically verified during signup\n    \n- **Default Settings**: New users get sensible defaults\n    \n\n**Use Cases:**\n\n- New user registration\n    \n- Account creation\n    \n- Onboarding flow\n    \n\n---\n\n### Set Password\n\n**Endpoint:** `POST /{MODE}/auth/set-password`\n\n**Description:** Set password for authenticated user (for users who signed up with OTP).\n\n**Authentication:** Required  \n**Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password set successfully\",\n  \"data\": {\n    \"message\": \"Password set successfully\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º password required\n   â”‚   â”œâ”€â–º confirm_password required\n   â”‚   â””â”€â–º password === confirm_password\n   â”‚\n   â”œâ”€â–º Hash Password\n   â”‚   â””â”€â–º bcrypt.hash() (10 rounds)\n   â”‚\n   â”œâ”€â–º Update User Password\n   â”‚   â””â”€â–º updateUserPassword()\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Use Cases:**\n\n- Initial password setup\n    \n- Passwordless signup completion\n    \n\n---\n\n### Change Password\n\n**Endpoint:** `POST /{MODE}/auth/change-password`\n\n**Description:** Change user's existing password. Requires old password verification.\n\n**Authentication:** Required  \n**Permission:** `edit_profile`\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"old_password\": \"current-password\",\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password updated successfully\",\n  \"data\": {\n    \"message\": \"Password updated successfully\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â”œâ”€â–º old_password required\n   â”‚   â”œâ”€â–º password required\n   â”‚   â””â”€â–º confirm_password required\n   â”‚\n   â”œâ”€â–º Verify Old Password\n   â”‚   â”œâ”€â–º authenticateUser(user_id, old_password)\n   â”‚   â””â”€â–º Check if valid\n   â”‚\n   â”œâ”€â–º Hash New Password\n   â”‚   â””â”€â–º bcrypt.hash()\n   â”‚\n   â”œâ”€â–º Update User Password\n   â”‚   â””â”€â–º updateUserPassword(currentUserId, newPassword)\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Use Cases:**\n\n- Password change\n    \n- Security updates\n    \n- Account security\n    \n\n---\n\n### Forget Password\n\n**Endpoint:** `POST /{MODE}/auth/forget-password`\n\n**Description:** Reset password after verifying OTP. Used for password recovery.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"otp\": \"123456\",\n  \"password\": \"new-password\",\n  \"confirm_password\": \"new-password\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Password updated successfully\",\n  \"data\": {\n    \"message\": \"Password updated successfully\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â”œâ”€â–º otp required\n   â”‚   â”œâ”€â–º password required\n   â”‚   â””â”€â–º confirm_password required\n   â”‚\n   â”œâ”€â–º Verify OTP\n   â”‚   â””â”€â–º verifyOtp(user_id, otp)\n   â”‚\n   â”œâ”€â–º Validate Email/Phone Format\n   â”‚   â””â”€â–º validateEmail() or validatePhone()\n   â”‚\n   â”œâ”€â–º Get User\n   â”‚   â””â”€â–º getUserByEmailOrPhone()\n   â”‚\n   â”œâ”€â–º Hash New Password\n   â”‚   â””â”€â–º bcrypt.hash()\n   â”‚\n   â”œâ”€â–º Update User Password\n   â”‚   â””â”€â–º updateUserPassword()\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Use Cases:**\n\n- Password recovery\n    \n- Account reset\n    \n- Security recovery\n    \n\n---\n\n### Logout\n\n**Endpoint:** `POST /{MODE}/auth/logout` or `POST /{MODE}/logout` (deprecated)\n\n**Description:** Logout user and revoke all tokens and sessions. The `/auth/logout` endpoint performs comprehensive token revocation, while `/logout` is deprecated and only returns user data.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Request Body:** None\n\n**Response (****`/auth/logout`****):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Logged out successfully. All tokens and sessions have been revoked.\",\n  \"data\": {\n    \"message\": \"Logged out successfully\",\n    \"access_token_revoked\": true,\n    \"refresh_tokens_revoked\": true,\n    \"sessions_revoked\": true,\n    \"tokens_revoked\": true\n  }\n}\n\n ```\n\n**Response (****`/logout`** **- deprecated):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Successfully fetched user data\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"email\": \"user@example.com\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n  }\n}\n\n ```\n\n**Workflow (****`/auth/logout`****):**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Token JTI\n   â”‚   â””â”€â–º Decode token to get JTI\n   â”‚\n   â”œâ”€â–º Blacklist Access Token\n   â”‚   â””â”€â–º blacklistAccessTokenByJti()\n   â”‚\n   â”œâ”€â–º Revoke All Refresh Tokens\n   â”‚   â””â”€â–º revokeAllUserRefreshTokens()\n   â”‚\n   â”œâ”€â–º Revoke All Sessions\n   â”‚   â””â”€â–º blacklistAllUserSessions()\n   â”‚\n   â””â”€â–º Return Revocation Status\n\n ```\n\n**Note:** The `/auth/logout` endpoint performs server-side token revocation using Redis blacklisting. All tokens and sessions are invalidated immediately. The deprecated `/logout` endpoint only returns user data without revoking tokens.\n\n**Use Cases:**\n\n- User logout\n    \n- Session termination\n    \n- Security logout\n    \n- Multi-device logout\n    \n\n---\n\n### Refresh Token\n\n**Endpoint:** `POST /{MODE}/auth/refresh-token`\n\n**Description:** Refresh access, refresh, and session tokens using a valid refresh token. Implements token rotation - old tokens are blacklisted and new tokens are generated with a new session ID.\n\n**Authentication:** Not required (refresh token in request body)\n\n**Request Body:**\n\n``` json\n{\n  \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Tokens refreshed successfully\",\n  \"data\": {\n    \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"session_id\": \"uuid\",\n    \"token_type\": \"bearer\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º refresh_token required\n   â”‚\n   â”œâ”€â–º Decode Refresh Token\n   â”‚   â”œâ”€â–º Verify JWT signature\n   â”‚   â”œâ”€â–º Check token type (must be \"refresh\")\n   â”‚   â””â”€â–º Extract user_id and session_id\n   â”‚\n   â”œâ”€â–º Get User from Database\n   â”‚   â””â”€â–º getUserById()\n   â”‚\n   â”œâ”€â–º Token Rotation\n   â”‚   â”œâ”€â–º Blacklist old refresh token\n   â”‚   â””â”€â–º Blacklist old session (invalidates all old tokens)\n   â”‚\n   â”œâ”€â–º Generate New Tokens\n   â”‚   â”œâ”€â–º Generate new access token\n   â”‚   â”œâ”€â–º Generate new refresh token\n   â”‚   â”œâ”€â–º Generate new session token\n   â”‚   â””â”€â–º Create new session ID\n   â”‚\n   â””â”€â–º Return New Tokens\n\n ```\n\n**Token Rotation:** The refresh endpoint implements token rotation for security. When refreshing, the old refresh token and session are blacklisted, and completely new tokens with a new session ID are generated.\n\n**Use Cases:**\n\n- Token renewal\n    \n- Session extension\n    \n- Security token rotation\n    \n\n---\n\n### Token Info\n\n**Endpoint:** `GET /{MODE}/auth/token-info` or `POST /{MODE}/auth/token-info`\n\n**Description:** Get detailed information about authentication tokens including age, expiration, type, and status. The POST endpoint allows comparing tokens from the request body with the current token.\n\n**Authentication:** Required\n\n**Request Body (POST only, optional):**\n\n``` json\n{\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"session_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Token information retrieved successfully\",\n  \"data\": {\n    \"token_ages\": {\n      \"current\": {\n        \"token_type\": \"access\",\n        \"token_age\": \"30 minutes\",\n        \"token_age_minutes\": 30,\n        \"expires_in\": \"30 minutes\",\n        \"expires_in_minutes\": 30,\n        \"lifetime_percentage_used\": 50.0,\n        \"status\": \"ACTIVE\"\n      },\n      \"access_token\": { ... },\n      \"session_token\": { ... },\n      \"refresh_token\": { ... }\n    },\n    \"token_configuration\": {\n      \"access_token\": {\n        \"expiry_minutes\": 60,\n        \"expires_in\": \"1 hour\"\n      },\n      \"session_token\": {\n        \"expiry_minutes\": 10080,\n        \"expires_in\": \"7 days\"\n      },\n      \"refresh_token\": {\n        \"expiry_minutes\": 43200,\n        \"expires_in\": \"30 days\"\n      }\n    },\n    \"extension_info\": {\n      \"current_expires_in\": \"30 minutes\",\n      \"after_refresh_expires_in\": \"1 hour\",\n      \"extension_minutes\": 60\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Tokens\n   â”‚   â”œâ”€â–º From Authorization header (Bearer)\n   â”‚   â”œâ”€â–º From X-Session-Token header\n   â”‚   â””â”€â–º From request body (POST only)\n   â”‚\n   â”œâ”€â–º Decode All Tokens\n   â”‚   â”œâ”€â–º Extract token type\n   â”‚   â”œâ”€â–º Calculate token age\n   â”‚   â”œâ”€â–º Calculate expiration time\n   â”‚   â””â”€â–º Determine status (ACTIVE/EXPIRED)\n   â”‚\n   â”œâ”€â–º Get Token Configuration\n   â”‚   â””â”€â–º From environment variables\n   â”‚\n   â”œâ”€â–º Calculate Extension Info\n   â”‚   â””â”€â–º If token refreshed, show extension details\n   â”‚\n   â””â”€â–º Return Token Information\n\n ```\n\n**Token Information Includes:**\n\n- **Token Age**: How long the token has been active\n    \n- **Expiration**: Time until token expires\n    \n- **Lifetime Percentage**: Percentage of token lifetime used\n    \n- **Status**: ACTIVE or EXPIRED\n    \n- **Token Type**: access, refresh, or session\n    \n- **Session ID**: Associated session identifier\n    \n\n**Use Cases:**\n\n- Token debugging\n    \n- Token expiration monitoring\n    \n- Security auditing\n    \n- Token comparison\n    \n\n---\n\n### Check User Availability\n\n**Endpoint:** `POST /{MODE}/auth/check-user-availability`\n\n**Description:** Check if email or phone number is available for registration.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\"\n}\n\n ```\n\n**Alternative:**\n\n``` json\n{\n  \"email\": \"user@example.com\"\n}\n\n ```\n\nor\n\n``` json\n{\n  \"phone\": \"+1234567890\"\n}\n\n ```\n\n**Response (Available):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User is not available\",\n  \"data\": {\n    \"available\": false,\n    \"first_name\": null,\n    \"last_name\": null\n  }\n}\n\n ```\n\n**Response (Not Available):**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User is available\",\n  \"data\": {\n    \"available\": true,\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id OR email OR phone required\n   â”‚   â””â”€â–º Validate format (email or phone)\n   â”‚\n   â”œâ”€â–º Get User\n   â”‚   â””â”€â–º getUserByEmailOrPhone(identifier)\n   â”‚\n   â”œâ”€â–º Check Availability\n   â”‚   â”œâ”€â–º If user exists â†’ available: false\n   â”‚   â””â”€â–º If user not exists â†’ available: true\n   â”‚\n   â””â”€â–º Return Availability Status\n       â””â”€â–º Include user name if exists\n\n ```\n\n**Use Cases:**\n\n- Registration form validation\n    \n- Username/email availability check\n    \n- Phone number availability check\n    \n\n---\n\n### Verify Email and Phone\n\n**Endpoint:** `POST /{MODE}/auth/verify-email-and-phone`\n\n**Description:** Verify email or phone number with OTP.\n\n**Authentication:** Not required\n\n**Request Body:**\n\n``` json\n{\n  \"user_id\": \"user@example.com\",\n  \"channel\": \"email\",\n  \"otp\": \"123456\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Email/Phone verified successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º user_id required\n   â”‚   â”œâ”€â–º channel required (email or sms)\n   â”‚   â””â”€â–º otp required\n   â”‚\n   â”œâ”€â–º Validate Channel\n   â”‚   â””â”€â–º Must be \"email\" or \"sms\"\n   â”‚\n   â”œâ”€â–º Validate Format\n   â”‚   â”œâ”€â–º Email â†’ validateEmail()\n   â”‚   â””â”€â–º Phone â†’ validatePhone()\n   â”‚\n   â”œâ”€â–º Verify OTP\n   â”‚   â””â”€â–º verifyOtp(user_id, otp, consume=false)\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Use Cases:**\n\n- Email verification\n    \n- Phone verification\n    \n- Account verification\n    \n\n---\n\n## Workflows\n\n### Complete Authentication Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              User Authentication Flow                       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Registration?  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚   Signup      â”‚         â”‚    Login      â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Send OTP     â”‚         â”‚ Password/OTP  â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Verify OTP   â”‚         â”‚ Authenticate  â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Generate Token  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Return Token   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### Password Reset Flow\n\n```\n1. User Requests Password Reset\n   â”‚\n   â”œâ”€â–º POST /auth/send-one-time-password\n   â”‚   â””â”€â–º OTP sent to email/phone\n   â”‚\n   â”œâ”€â–º User Receives OTP\n   â”‚\n   â”œâ”€â–º POST /auth/forget-password\n   â”‚   â”œâ”€â–º Verify OTP\n   â”‚   â”œâ”€â–º Validate new password\n   â”‚   â””â”€â–º Update password\n   â”‚\n   â””â”€â–º Password Reset Complete\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"Validation error details\",\n  \"statusCode\": 400\n}\n\n ```\n\n**401 Unauthorized - Invalid Credentials:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid credentials\",\n  \"error\": \"Email/phone or password is incorrect\",\n  \"statusCode\": 401\n}\n\n ```\n\n**401 Unauthorized - Invalid OTP:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid OTP\",\n  \"error\": \"OTP is incorrect or expired\",\n  \"statusCode\": 401\n}\n\n ```\n\n**404 Not Found - User Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"User not found\",\n  \"error\": \"User with provided email/phone does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - User Already Exists:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"User already exists\",\n  \"error\": \"User with this email/phone already registered\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Use Strong Passwords**: Enforce password complexity requirements\n    \n2. **OTP Expiration**: OTPs expire after 10 minutes for security\n    \n3. **Rate Limiting**: Implement rate limiting on authentication endpoints\n    \n4. **Token Storage**: Store JWT tokens securely (httpOnly cookies or secure storage)\n    \n5. **Password Hashing**: Always use bcrypt with appropriate salt rounds\n    \n6. **Email/Phone Validation**: Validate format before processing\n    \n7. **Error Messages**: Don't reveal if email/phone exists in system\n    \n8. **Master OTP**: Use master OTP only in development/staging environments\n    \n\n---\n\n**Last Updated**: January 2025",
			"auth": {
				"type": "bearer",
				"bearer": [
					{
						"key": "token",
						"value": "{{access_token}}",
						"type": "string"
					}
				]
			},
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"packages": {},
						"requests": {},
						"exec": [
							"const response = pm.response.json();",
							"",
							"// Check if the response succeeded",
							"if (response.success && response.data) {",
							"    if (response.data.access_token) {",
							"        pm.environment.set(\"access_token\", response.data.access_token);",
							"        console.log(\"Access token updated:\", response.data.access_token);",
							"    }",
							"",
							"    if (response.data.refresh_token) {",
							"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
							"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
							"    }",
							"} else {",
							"    console.log(\"No token found in response:\", response);",
							"}",
							""
						]
					}
				}
			]
		},
		{
			"name": "Profile & Settings",
			"item": [
				{
					"name": "profile",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "get-user-profile",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile/169ba70d-b3d8-413b-b07c-7413b9539c4b?page=1&page_size=1",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile",
								"169ba70d-b3d8-413b-b07c-7413b9539c4b"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "page_size",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "update-profile",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-profile",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-profile"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-profile-picture",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "/home/mrdas/Downloads/favicon_io/android-chrome-192x192.png"
								}
							]
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-profile-picture",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-profile-picture"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-email",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/change-email",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"change-email"
							]
						}
					},
					"response": []
				},
				{
					"name": "change-phone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"new_phone\": \"+1234567890\",\n  \"otp\": \"123456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/change-phone",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"change-phone"
							]
						}
					},
					"response": []
				},
				{
					"name": "profile-accessibility",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"profile_accessibility\": \"private\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-accessibility",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-accessibility"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-theme",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"theme\": \"light\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-theme",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-theme"
							]
						}
					},
					"response": []
				},
				{
					"name": "profile-language",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"en\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-language"
							]
						}
					},
					"response": []
				},
				{
					"name": "update-timezone",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"timezone\": \"America/New_York\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/update-timezone",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"update-timezone"
							]
						}
					},
					"response": []
				},
				{
					"name": "deactivate-account",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"language\": \"en\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/profile-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"profile-language"
							]
						}
					},
					"response": []
				},
				{
					"name": "delete-account",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"confirm\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/settings/delete-account",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"settings",
								"delete-account"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Profile Router\n\n> **Complete Documentation for User Profile Management Endpoints**\n\nThis router handles all user profile operations including viewing, updating profile information, managing profile pictures, changing email/phone, updating settings, and account management.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n  - [Profile System](#profile-system)\n  - [Permissions](#permissions)\n- [Endpoints](#endpoints)\n  - [Get User Profile](#get-user-profile)\n  - [Get User Profile by ID](#get-user-profile-by-id)\n  - [Update Profile Picture](#update-profile-picture)\n  - [Update Profile](#update-profile)\n  - [Profile Accessibility](#profile-accessibility)\n  - [Profile Language](#profile-language)\n  - [Change Email](#change-email)\n  - [Change Phone](#change-phone)\n  - [Send Phone OTP](#send-phone-otp)\n  - [Update Theme](#update-theme)\n  - [Update Timezone](#update-timezone)\n  - [Get Settings](#get-settings)\n  - [Deactivate Account](#deactivate-account)\n  - [Delete Account](#delete-account)\n- [User Model](#user-model)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Best Practices](#best-practices)\n- [Client-Side Implementation](#client-side-implementation)\n\n## Overview\n\nThe Profile router provides comprehensive user profile management functionality including:\n- **Profile Viewing**: Get current user profile or view other users' profiles\n- **Profile Updates**: Update personal information, bio, and preferences\n- **Profile Picture**: Upload and update profile pictures via Google Cloud Storage\n- **Contact Management**: Change email and phone numbers with OTP verification\n- **Settings Management**: Update theme, language, timezone, and accessibility settings\n- **Account Management**: Deactivate or delete user accounts\n\n**Base Path:** `/{MODE}/settings`\n\n**Authentication:** All endpoints require authentication via token (access_token or session_token)\n\n### Profile System\n\nThe profile system provides a comprehensive user management interface:\n\n1. **Profile Data**\n   - Personal information (name, email, phone, bio, etc.)\n   - Profile picture URL (stored in Google Cloud Storage)\n   - User preferences (theme, language, timezone)\n   - Verification status (email, phone)\n   - Account status (active, verified, protected)\n\n2. **Profile Updates**\n   - Partial updates supported (only provided fields are updated)\n   - Protected fields (user_id, email/phone) cannot be changed directly\n   - Email/phone changes require OTP verification\n   - Automatic timestamp updates (`last_updated`)\n\n3. **File Uploads**\n   - Profile pictures uploaded to Google Cloud Storage\n   - Automatic file naming with user_id and UUID\n   - Support for various image formats\n   - Public URL returned for frontend use\n\n### Permissions\n\nProfile endpoints use permission-based access control:\n\n- **`view_profile`**: Required for viewing own profile\n- **`view_user`**: Required for viewing other users' profiles\n- **`edit_profile`**: Required for all profile update operations\n\n**Permission Middleware:**\nAll endpoints use `check_permission()` middleware to validate user permissions before processing requests.\n\n## Endpoints\n\n### Get User Profile\n\n**Endpoint:** `GET /{MODE}/settings/profile`\n\n**Description:** Get the current authenticated user's profile information.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_profile`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile fetched successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"email\": \"john.doe@example.com\",\n    \"phone_number\": {\n      \"phone\": \"+1234567890\"\n    },\n    \"profile_picture_url\": \"https://storage.googleapis.com/...\",\n    \"bio\": \"Software developer\",\n    \"country\": \"US\",\n    \"gender\": \"male\",\n    \"theme\": \"light\",\n    \"language\": \"en\",\n    \"profile_accessibility\": \"public\",\n    \"timezone\": \"America/New_York\",\n    \"is_email_verified\": true,\n    \"is_phone_verified\": true,\n    \"is_active\": true,\n    \"is_verified\": true,\n    \"status\": \"ACTIVE\",\n    \"created_at\": \"2025-01-15T10:30:00Z\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/settings/profile\n\nStep 2: Client sends request\n  GET /{MODE}/settings/profile\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display profile data\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Not Found (404): Show profile not found error\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_profile\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Database query\n  â”œâ”€â–º Query user profile by user_id from token\n  â”œâ”€â–º Fetch all user fields from database\n  â””â”€â–º Serialize datetime fields to ISO format\n\nStep 4: Response preparation\n  â”œâ”€â–º Build User model from database result\n  â”œâ”€â–º Serialize data (convert datetime objects)\n  â””â”€â–º Return SUCCESS response with profile data\n\nStep 5: Error handling\n  â”œâ”€â–º Profile not found: Return 404 with error details\n  â”œâ”€â–º Database error: Log error, return 500\n  â””â”€â–º Permission error: Return 403 with error details\n```\n\n**Error Responses:**\n\n```json\n// 404 - Profile Not Found\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Profile not found\",\n  \"error\": {\n    \"code\": \"PROFILE_NOT_FOUND\",\n    \"details\": {\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  }\n}\n\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_profile\"\n    }\n  }\n}\n\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Error processing profile request\",\n  \"error\": {\n    \"code\": \"PROFILE_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  }\n}\n```\n\n---\n\n### Get User Profile by ID\n\n**Endpoint:** `GET /{MODE}/settings/profile/{user_id}`\n\n**Description:** Get a specific user's profile by user_id. Requires `view_user` permission.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_user`\n\n**Path Parameters:**\n- `user_id` (string, required): The UUID of the user whose profile to retrieve\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile fetched successfully\",\n  \"data\": {\n    \"user_id\": \"b3dgb6gd-6074-5b64-b1b9-7e3e361bg9ge\",\n    \"first_name\": \"Jane\",\n    \"last_name\": \"Smith\",\n    \"email\": \"jane.smith@example.com\",\n    \"profile_picture_url\": \"https://storage.googleapis.com/...\",\n    \"bio\": \"Designer\",\n    \"profile_accessibility\": \"public\",\n    \"is_active\": true,\n    \"is_verified\": true\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º User navigates to another user's profile page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Get target user_id from route/URL\n  â””â”€â–º Prepare GET request to /{MODE}/settings/profile/{user_id}\n\nStep 2: Client sends request\n  GET /{MODE}/settings/profile/{user_id}\n  Headers:\n    Authorization: Bearer <token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display user profile\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Not Found (404): Show user not found error\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user_id from path parameters\n  â””â”€â–º Extract current user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if current user has \"view_user\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Database query\n  â”œâ”€â–º Query user profile by target user_id\n  â”œâ”€â–º Fetch all user fields from database\n  â””â”€â–º Serialize datetime fields\n\nStep 4: Response preparation\n  â”œâ”€â–º Build User model from database result\n  â”œâ”€â–º Serialize data\n  â””â”€â–º Return SUCCESS response with profile data\n\nStep 5: Error handling\n  â”œâ”€â–º User not found: Return 404\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Server error: Log and return 500\n```\n\n---\n\n### Update Profile Picture\n\n**Endpoint:** `POST /{MODE}/settings/update-profile-picture`\n\n**Description:** Upload and update the user's profile picture. The file is uploaded to Google Cloud Storage and the public URL is stored in the database.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request:**\n```\nPOST /{MODE}/settings/update-profile-picture\nContent-Type: multipart/form-data\n\nfile: <binary image data>\n```\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\nContent-Type: multipart/form-data\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile picture updated successfully\",\n  \"data\": {\n    \"message\": \"Profile picture updated successfully\",\n    \"profile_picture_url\": \"https://storage.googleapis.com/bucket/media/users/johndoe-user_id_a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd-|-f533589d-48d3-4b67-9430-c0b4793ac13e.jpg\"\n  },\n  \"meta\": {\n    \"type\": \"dict\"\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User selects image\n  â”œâ”€â–º User clicks \"Change Profile Picture\"\n  â”œâ”€â–º File picker opens (accepts image/*)\n  â””â”€â–º User selects image file\n\nStep 2: Client validates image\n  â”œâ”€â–º Check file size (recommended: < 5MB)\n  â”œâ”€â–º Check file type (jpg, png, gif, webp)\n  â””â”€â–º Optionally: Preview image before upload\n\nStep 3: Client prepares request\n  â”œâ”€â–º Create FormData object\n  â”œâ”€â–º Append image file to FormData\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with multipart/form-data\n\nStep 4: Client sends request\n  POST /{MODE}/settings/update-profile-picture\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: multipart/form-data\n  Body:\n    file: <File object>\n\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI with new profile picture URL\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message, keep old picture\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â””â”€â–º Check permission: \"edit_profile\"\n\nStep 2: File processing\n  â”œâ”€â–º Read file data from request\n  â”œâ”€â–º Extract file extension\n  â”œâ”€â–º Determine content type\n  â””â”€â–º Generate unique object key: {username}-user_id_{user_id}-|-{uuid}.{ext}\n\nStep 3: Upload to Google Cloud Storage\n  â”œâ”€â–º Upload file to \"media/users\" folder\n  â”œâ”€â–º Set content type\n  â”œâ”€â–º Make file publicly accessible\n  â””â”€â–º Get public URL\n\nStep 4: Database update\n  â”œâ”€â–º Update user.profile_picture_url with new URL\n  â”œâ”€â–º Update user.last_updated timestamp\n  â””â”€â–º Return updated user_id\n\nStep 5: Response preparation\n  â”œâ”€â–º Build success response with profile_picture_url\n  â””â”€â–º Return SUCCESS response\n\nStep 6: Error handling\n  â”œâ”€â–º Upload failed: Return 500 with error details\n  â”œâ”€â–º Database update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n**Client-Side Implementation Example:**\n\n```javascript\n// Update Profile Picture\nasync function updateProfilePicture(file) {\n  try {\n    // Validate file\n    if (!file || !file.type.startsWith('image/')) {\n      throw new Error('Please select a valid image file');\n    }\n    \n    if (file.size > 5 * 1024 * 1024) { // 5MB limit\n      throw new Error('Image size must be less than 5MB');\n    }\n    \n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    // Get token from storage\n    const token = localStorage.getItem('access_token') || \n                 localStorage.getItem('session_token');\n    \n    // Send request\n    const response = await fetch('/api/v1/settings/update-profile-picture', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`\n      },\n      body: formData\n    });\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      // Update UI with new profile picture\n      document.getElementById('profile-picture').src = data.data.profile_picture_url;\n      showNotification('Profile picture updated successfully');\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile picture');\n    }\n  } catch (error) {\n    console.error('Error updating profile picture:', error);\n    showError(error.message);\n  }\n}\n\n// HTML Example\n<input \n  type=\"file\" \n  accept=\"image/*\" \n  onChange={(e) => updateProfilePicture(e.target.files[0])}\n/>\n```\n\n---\n\n### Update Profile\n\n**Endpoint:** `POST /{MODE}/settings/update-profile`\n\n**Description:** Partially update user profile fields. Only provided fields will be updated. Protected fields (user_id, email, phone) cannot be updated through this endpoint.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n```json\n{\n  \"first_name\": \"John\",\n  \"last_name\": \"Doe\",\n  \"bio\": \"Software developer passionate about web technologies\",\n  \"country\": \"US\",\n  \"gender\": \"male\",\n  \"dob\": \"1990-01-15T00:00:00Z\",\n  \"portfolio_url\": \"https://johndoe.dev\"\n}\n```\n\n**Note:** Only include fields you want to update. Omitted fields will remain unchanged.\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User profile update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"first_name\": \"John\",\n    \"last_name\": \"Doe\",\n    \"bio\": \"Software developer passionate about web technologies\",\n    \"country\": \"US\",\n    \"gender\": \"male\",\n    \"dob\": \"1990-01-15T00:00:00Z\",\n    \"portfolio_url\": \"https://johndoe.dev\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User edits profile form\n  â”œâ”€â–º User fills in profile fields (name, bio, country, etc.)\n  â”œâ”€â–º Client validates form fields\n  â””â”€â–º User clicks \"Save\" button\n\nStep 2: Client prepares request\n  â”œâ”€â–º Collect form data (only changed fields)\n  â”œâ”€â–º Remove protected fields (user_id, email, phone)\n  â”œâ”€â–º Convert dates to ISO format\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with JSON body\n\nStep 3: Client sends request\n  POST /{MODE}/settings/update-profile\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/json\n  Body:\n    {\n      \"first_name\": \"John\",\n      \"last_name\": \"Doe\",\n      \"bio\": \"...\",\n      ...\n    }\n\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Update UI with new profile data\n  â”œâ”€â–º Bad Request (400): Show validation errors\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body (User model)\n  â””â”€â–º Check permission: \"edit_profile\"\n\nStep 2: Data processing\n  â”œâ”€â–º Extract only provided fields (exclude_unset=True)\n  â”œâ”€â–º Remove protected fields:\n  â”‚   â”œâ”€â–º user_id (always protected)\n  â”‚   â”œâ”€â–º email (if user has email)\n  â”‚   â””â”€â–º phone (if user has phone)\n  â”œâ”€â–º Validate no protected fields in update\n  â””â”€â–º Check if any fields remain to update\n\nStep 3: Build SQL update query\n  â”œâ”€â–º Create SET clauses for each field\n  â”œâ”€â–º Handle phone_number as JSONB if provided\n  â”œâ”€â–º Add last_updated = NOW()\n  â””â”€â–º Prepare parameterized query\n\nStep 4: Database update\n  â”œâ”€â–º Execute UPDATE query\n  â”œâ”€â–º Verify update succeeded (check RETURNING)\n  â””â”€â–º Fetch updated user data\n\nStep 5: Response preparation\n  â”œâ”€â–º Build User model from updated data\n  â”œâ”€â–º Serialize data (convert datetime objects)\n  â””â”€â–º Return SUCCESS response with updated profile\n\nStep 6: Error handling\n  â”œâ”€â–º No fields to update: Return 400\n  â”œâ”€â–º Protected field attempted: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n**Protected Fields:**\n- `user_id`: Always protected (cannot be changed)\n- `email`: Protected if user has email (use `/change-email` endpoint)\n- `phone`: Protected if user has phone (use `/change-phone` endpoint)\n\n**Client-Side Implementation Example:**\n\n```javascript\n// Update Profile\nasync function updateProfile(profileData) {\n  try {\n    // Remove protected fields\n    const { user_id, email, phone_number, ...updateData } = profileData;\n    \n    // Get token\n    const token = localStorage.getItem('access_token') || \n                 localStorage.getItem('session_token');\n    \n    // Send request\n    const response = await fetch('/api/v1/settings/update-profile', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(updateData)\n    });\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      // Update UI with new profile data\n      updateProfileDisplay(data.data);\n      showNotification('Profile updated successfully');\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile');\n    }\n  } catch (error) {\n    console.error('Error updating profile:', error);\n    showError(error.message);\n  }\n}\n```\n\n---\n\n### Profile Accessibility\n\n**Endpoint:** `POST /{MODE}/settings/profile-accessibility`\n\n**Description:** Update user profile accessibility setting (public, private, friends).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n```json\n{\n  \"profile_accessibility\": \"public\"\n}\n```\n\n**Valid Values:**\n- `\"public\"`: Profile visible to everyone\n- `\"private\"`: Profile visible only to user\n- `\"friends\"`: Profile visible only to friends\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile accessibility update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"profile_accessibility\": \"public\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n```\n\n---\n\n### Profile Language\n\n**Endpoint:** `POST /{MODE}/settings/profile-language`\n\n**Description:** Update user's preferred language setting.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Body:**\n```json\n{\n  \"language\": \"en\"\n}\n```\n\n**Valid Values:**\n- `\"en\"`: English\n- `\"es\"`: Spanish\n- `\"fr\"`: French\n- (Other language codes as supported)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Profile language update successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"language\": \"en\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n```\n\n---\n\n### Change Email\n\n**Endpoint:** `POST /{MODE}/settings/change-email`\n\n**Description:** Change user's email address. Requires OTP verification sent to the new email address.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Prerequisites:**\n1. User must first request OTP to new email via `/auth/send-otp` endpoint\n2. OTP must be sent to the new email address (channel: \"email\")\n\n**Request Body:**\n```json\n{\n  \"new_email\": \"newemail@example.com\",\n  \"otp\": \"123456\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Email updated and verified successfully\",\n  \"data\": {\n    \"message\": \"Email updated and verified successfully\",\n    \"user\": {\n      \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n      \"email\": \"newemail@example.com\",\n      \"is_email_verified\": true,\n      \"email_verified_at\": \"2025-01-28T15:51:55Z\"\n    }\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User initiates email change\n  â”œâ”€â–º User enters new email address\n  â”œâ”€â–º User clicks \"Send OTP\" button\n  â””â”€â–º Client validates email format\n\nStep 2: Request OTP to new email\n  POST /{MODE}/auth/send-otp\n  Body: {\n    \"user_id\": \"newemail@example.com\",\n    \"channel\": \"email\"\n  }\n  â”œâ”€â–º Server sends OTP to new email\n  â””â”€â–º Client shows \"OTP sent\" message\n\nStep 3: User enters OTP\n  â”œâ”€â–º User receives OTP via email\n  â”œâ”€â–º User enters OTP in form\n  â””â”€â–º User clicks \"Change Email\" button\n\nStep 4: Client sends change email request\n  POST /{MODE}/settings/change-email\n  Headers:\n    Authorization: Bearer <token>\n  Body: {\n    \"new_email\": \"newemail@example.com\",\n    \"otp\": \"123456\"\n  }\n\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI, show success message\n  â”œâ”€â–º Bad Request (400): Show error (invalid OTP, email exists)\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body\n  â””â”€â–º Check permission: \"edit_profile\"\n\nStep 2: OTP verification\n  â”œâ”€â–º Verify OTP for new_email (delete_after_verify=False)\n  â”œâ”€â–º If invalid: Return 400 with \"PROFILE_INVALID_OTP\"\n  â””â”€â–º OTP must be sent to new_email (not old email)\n\nStep 3: Email uniqueness check\n  â”œâ”€â–º Check if new_email already exists for another user\n  â”œâ”€â–º If exists: Return 400 with \"EMAIL_ALREADY_EXISTS\"\n  â””â”€â–º Allow same email if it's the current user\n\nStep 4: Database update\n  â”œâ”€â–º Update user.email = new_email\n  â”œâ”€â–º Set is_email_verified = TRUE\n  â”œâ”€â–º Set email_verified_at = NOW()\n  â”œâ”€â–º Update last_updated = NOW()\n  â””â”€â–º Verify update succeeded\n\nStep 5: Cleanup\n  â”œâ”€â–º Delete OTP from cache (delete_after_verify=True)\n  â””â”€â–º Prepare response with updated user data\n\nStep 6: Response preparation\n  â”œâ”€â–º Build success response\n  â”œâ”€â–º Include updated email and verification status\n  â””â”€â–º Return SUCCESS response\n\nStep 7: Error handling\n  â”œâ”€â–º Invalid OTP: Return 400\n  â”œâ”€â–º Email exists: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n**Important Notes:**\n- OTP must be sent to the **new email address**, not the old one\n- Email change automatically verifies the new email (`is_email_verified = true`)\n- Old email is replaced; user cannot revert without going through the process again\n\n---\n\n### Change Phone\n\n**Endpoint:** `POST /{MODE}/settings/change-phone`\n\n**Description:** Change user's phone number. Requires OTP verification sent to the new phone number.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Prerequisites:**\n1. User must first request OTP to new phone via `/settings/send-phone-otp` endpoint\n2. OTP must be sent to the new phone number (channel: \"sms\" or \"whatsapp\")\n\n**Request Body:**\n```json\n{\n  \"new_phone\": \"+1234567890\",\n  \"otp\": \"123456\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Phone number updated and verified successfully\",\n  \"data\": {\n    \"user\": {\n      \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n      \"phone_number\": {\n        \"phone\": \"1234567890\"\n      },\n      \"is_phone_verified\": true,\n      \"phone_number_verified_at\": \"2025-01-28T15:51:55Z\"\n    }\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User initiates phone change\n  â”œâ”€â–º User enters new phone number\n  â”œâ”€â–º User selects channel (SMS or WhatsApp)\n  â”œâ”€â–º User clicks \"Send OTP\" button\n  â””â”€â–º Client validates phone format\n\nStep 2: Request OTP to new phone\n  POST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n  Headers:\n    Authorization: Bearer <token>\n  â”œâ”€â–º Server sends OTP to new phone\n  â””â”€â–º Client shows \"OTP sent\" message\n\nStep 3: User enters OTP\n  â”œâ”€â–º User receives OTP via SMS/WhatsApp\n  â”œâ”€â–º User enters OTP in form\n  â””â”€â–º User clicks \"Change Phone\" button\n\nStep 4: Client sends change phone request\n  POST /{MODE}/settings/change-phone\n  Headers:\n    Authorization: Bearer <token>\n  Body: {\n    \"new_phone\": \"+1234567890\",\n    \"otp\": \"123456\"\n  }\n\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Update UI, show success message\n  â”œâ”€â–º Bad Request (400): Show error (invalid OTP, phone exists, invalid format)\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract current user from token\n  â”œâ”€â–º Parse request body\n  â”œâ”€â–º Validate phone format (E.164 format)\n  â””â”€â–º Check permission: \"edit_profile\"\n\nStep 2: OTP verification\n  â”œâ”€â–º Verify OTP for new_phone (delete_after_verify=False)\n  â”œâ”€â–º If invalid: Return 400 with \"PROFILE_INVALID_OTP\"\n  â””â”€â–º OTP must be sent to new_phone (not old phone)\n\nStep 3: Phone uniqueness check\n  â”œâ”€â–º Clean phone number (remove +)\n  â”œâ”€â–º Check if phone already exists for another user\n  â”œâ”€â–º Query: phone_number->>'phone' = cleaned_phone\n  â”œâ”€â–º If exists: Return 400 with \"EMAIL_ALREADY_EXISTS\" (reused error code)\n  â””â”€â–º Allow same phone if it's the current user\n\nStep 4: Database update\n  â”œâ”€â–º Format phone as JSON: {\"phone\": cleaned_phone}\n  â”œâ”€â–º Update user.phone_number = JSONB\n  â”œâ”€â–º Set is_phone_verified = TRUE\n  â”œâ”€â–º Set phone_number_verified_at = NOW()\n  â”œâ”€â–º Update last_updated = NOW()\n  â””â”€â–º Verify update succeeded\n\nStep 5: Cleanup\n  â”œâ”€â–º Delete OTP from cache (delete_after_verify=True)\n  â””â”€â–º Prepare response with updated user data\n\nStep 6: Response preparation\n  â”œâ”€â–º Build success response\n  â”œâ”€â–º Include updated phone_number and verification status\n  â””â”€â–º Return SUCCESS response\n\nStep 7: Error handling\n  â”œâ”€â–º Invalid phone format: Return 400\n  â”œâ”€â–º Invalid OTP: Return 400\n  â”œâ”€â–º Phone exists: Return 400\n  â”œâ”€â–º Update failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n**Phone Format:**\n- Must be in E.164 format: `+[country code][number]`\n- Example: `+1234567890`, `+441234567890`\n- The `+` sign is optional but recommended\n\n---\n\n### Send Phone OTP\n\n**Endpoint:** `POST /{MODE}/settings/send-phone-otp`\n\n**Description:** Send OTP to a phone number via SMS or WhatsApp. Used for phone number verification during phone change.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n- `phone` (string, required): Phone number in E.164 format\n- `channel` (string, required): Delivery channel - `\"sms\"` or `\"whatsapp\"`\n\n**Request:**\n```\nPOST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n```\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"OTP sent successfully\",\n  \"data\": {\n    \"message\": \"OTP sent successfully\"\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User enters phone number\n  â”œâ”€â–º User enters new phone number\n  â”œâ”€â–º User selects channel (SMS or WhatsApp)\n  â””â”€â–º Client validates phone format\n\nStep 2: Client sends request\n  POST /{MODE}/settings/send-phone-otp?phone=+1234567890&channel=sms\n  Headers:\n    Authorization: Bearer <token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Show \"OTP sent\" message, enable OTP input\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract query parameters (phone, channel)\n  â”œâ”€â–º Validate phone format (E.164)\n  â”œâ”€â–º Validate channel (sms or whatsapp)\n  â””â”€â–º Check permission: \"edit_profile\"\n\nStep 2: Generate and store OTP\n  â”œâ”€â–º Generate 6-digit OTP\n  â”œâ”€â–º Store OTP in cache with TTL (600 seconds = 10 minutes)\n  â”œâ”€â–º Key: phone number\n  â””â”€â–º Value: OTP code\n\nStep 3: Send OTP\n  â”œâ”€â–º If channel = \"sms\": Send SMS via SMS service\n  â”œâ”€â–º If channel = \"whatsapp\": Send WhatsApp message\n  â””â”€â–º Message includes OTP code\n\nStep 4: Response preparation\n  â”œâ”€â–º Build success response\n  â””â”€â–º Return SUCCESS response\n\nStep 5: Error handling\n  â”œâ”€â–º Invalid phone format: Return 400\n  â”œâ”€â–º Invalid channel: Return 400\n  â”œâ”€â–º OTP generation failed: Return 500\n  â”œâ”€â–º SMS/WhatsApp send failed: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n---\n\n### Update Theme\n\n**Endpoint:** `POST /{MODE}/settings/update-theme`\n\n**Description:** Update user's theme preference (light or dark).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n- `theme` (string, required): Theme value - `\"light\"` or `\"dark\"`\n\n**Request:**\n```\nPOST /{MODE}/settings/update-theme?theme=dark\n```\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Theme updated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"theme\": \"dark\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n```\n\n---\n\n### Update Timezone\n\n**Endpoint:** `POST /{MODE}/settings/update-timezone`\n\n**Description:** Update user's timezone preference.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n- `timezone` (string, required): Timezone identifier (e.g., `\"America/New_York\"`, `\"Europe/London\"`)\n\n**Request:**\n```\nPOST /{MODE}/settings/update-timezone?timezone=America/New_York\n```\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Timezone updated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"timezone\": \"America/New_York\",\n    \"last_updated\": \"2025-01-28T15:51:55Z\"\n  }\n}\n```\n\n---\n\n### Get Settings\n\n**Endpoint:** `GET /{MODE}/settings/get-settings`\n\n**Description:** Get user settings including theme, language, timezone, verification status, and account status.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_profile`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"User settings retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"theme\": \"light\",\n    \"language\": \"en\",\n    \"profile_accessibility\": \"public\",\n    \"timezone\": \"America/New_York\",\n    \"country\": \"US\",\n    \"bio\": \"Software developer\",\n    \"is_email_verified\": true,\n    \"is_phone_verified\": true,\n    \"is_active\": true,\n    \"is_verified\": true,\n    \"status\": \"ACTIVE\"\n  }\n}\n```\n\n---\n\n### Deactivate Account\n\n**Endpoint:** `POST /{MODE}/settings/deactivate-account`\n\n**Description:** Deactivate user account. Sets `is_active = false` and `status = 'INACTIVE'`. Account data is preserved.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Account deactivated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"is_active\": false,\n    \"status\": \"INACTIVE\"\n  }\n}\n```\n\n**Note:** Deactivated accounts cannot log in. To reactivate, contact support or use account recovery process.\n\n---\n\n### Delete Account\n\n**Endpoint:** `POST /{MODE}/settings/delete-account`\n\n**Description:** Delete user account. Requires confirmation. Sets `is_active = false` and `status = 'INACTIVE'`. Account data is preserved (soft delete).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `edit_profile`\n\n**Query Parameters:**\n- `confirm` (boolean, required): Must be `true` to confirm deletion\n\n**Request:**\n```\nPOST /{MODE}/settings/delete-account?confirm=true\n```\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n  \"message\": \"Account deactivated successfully\",\n  \"data\": {\n    \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\",\n    \"is_active\": false\n  }\n}\n```\n\n**Note:** \n- Currently performs soft delete (same as deactivate)\n- Account data is preserved in database\n- User cannot log in after deletion\n- For permanent deletion, contact support\n\n---\n\n## User Model\n\nThe User model contains all user profile information:\n\n```typescript\ninterface User {\n  // Primary identifier\n  user_id: string;\n  \n  // Basic information\n  first_name?: string;\n  last_name?: string;\n  email?: string;\n  phone_number?: {\n    phone: string;\n  };\n  country?: string;\n  gender?: string;\n  dob?: string; // ISO 8601 datetime\n  profile_picture_url?: string;\n  bio?: string;\n  portfolio_url?: string;\n  user_name?: string;\n  \n  // Preferences\n  theme?: \"light\" | \"dark\";\n  language?: string; // Language code (en, es, fr, etc.)\n  profile_accessibility?: \"public\" | \"private\" | \"friends\";\n  timezone?: string; // IANA timezone (America/New_York, etc.)\n  \n  // Verification status\n  is_email_verified?: boolean;\n  is_phone_verified?: boolean;\n  email_verified_at?: string; // ISO 8601 datetime\n  phone_number_verified_at?: string; // ISO 8601 datetime\n  \n  // Account status\n  is_active?: boolean;\n  is_verified?: boolean;\n  status?: \"ACTIVE\" | \"INACTIVE\" | \"SUSPENDED\" | \"DELETED\";\n  \n  // Timestamps\n  created_at?: string; // ISO 8601 datetime\n  last_updated?: string; // ISO 8601 datetime\n  last_sign_in_at?: string; // ISO 8601 datetime\n}\n```\n\n---\n\n## Workflows\n\n### Complete Profile Update Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    PROFILE UPDATE WORKFLOW                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User Authentication\n  â”œâ”€â–º User logs in (via /auth/login-with-password or /auth/login-with-otp)\n  â”œâ”€â–º Client receives tokens (access_token, session_token, refresh_token)\n  â””â”€â–º Client stores tokens securely\n\nStep 2: View Profile\n  â”œâ”€â–º Client requests profile: GET /{MODE}/settings/profile\n  â”œâ”€â–º Server validates token and permissions\n  â”œâ”€â–º Server returns user profile data\n  â””â”€â–º Client displays profile in UI\n\nStep 3: Update Profile Information\n  â”œâ”€â–º User edits profile fields (name, bio, country, etc.)\n  â”œâ”€â–º Client validates form data\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/update-profile\n  â”œâ”€â–º Server validates token, permissions, and data\n  â”œâ”€â–º Server updates database\n  â””â”€â–º Server returns updated profile\n\nStep 4: Update Profile Picture\n  â”œâ”€â–º User selects new profile picture\n  â”œâ”€â–º Client validates image file\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/update-profile-picture (multipart/form-data)\n  â”œâ”€â–º Server uploads to Google Cloud Storage\n  â”œâ”€â–º Server updates database with new URL\n  â””â”€â–º Server returns new profile_picture_url\n\nStep 5: Change Email (if needed)\n  â”œâ”€â–º User enters new email\n  â”œâ”€â–º Client requests OTP: POST /{MODE}/auth/send-otp (to new email)\n  â”œâ”€â–º User receives OTP via email\n  â”œâ”€â–º User enters OTP\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/change-email\n  â”œâ”€â–º Server verifies OTP and updates email\n  â””â”€â–º Server returns updated user data\n\nStep 6: Change Phone (if needed)\n  â”œâ”€â–º User enters new phone\n  â”œâ”€â–º Client requests OTP: POST /{MODE}/settings/send-phone-otp\n  â”œâ”€â–º User receives OTP via SMS/WhatsApp\n  â”œâ”€â–º User enters OTP\n  â”œâ”€â–º Client sends: POST /{MODE}/settings/change-phone\n  â”œâ”€â–º Server verifies OTP and updates phone\n  â””â”€â–º Server returns updated user data\n\nStep 7: Update Settings\n  â”œâ”€â–º User updates theme: POST /{MODE}/settings/update-theme\n  â”œâ”€â–º User updates language: POST /{MODE}/settings/profile-language\n  â”œâ”€â–º User updates timezone: POST /{MODE}/settings/update-timezone\n  â”œâ”€â–º User updates accessibility: POST /{MODE}/settings/profile-accessibility\n  â””â”€â–º Each update returns updated user data\n```\n\n### Profile Picture Upload Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              PROFILE PICTURE UPLOAD WORKFLOW                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 1. User selects image file\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  Validation  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 2. Validate file (type, size)\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  FormData    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 3. Create FormData with file\n       â”‚    Add Authorization header\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Validation  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 4. Validate token & permission\n       â”‚    Read file data\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Generate    â”‚\nâ”‚  Object Key  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 5. Generate: {username}-user_id_{id}-|-{uuid}.{ext}\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Google      â”‚\nâ”‚  Cloud       â”‚\nâ”‚  Storage     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 6. Upload to \"media/users\" folder\n       â”‚    Set public access\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Database    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 7. Update profile_picture_url\n       â”‚    Update last_updated\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SERVER     â”‚\nâ”‚  Response    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n       â”‚\n       â”‚ 8. Return profile_picture_url\n       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   CLIENT     â”‚\nâ”‚  Update UI   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## Error Handling\n\nAll profile endpoints return standardized error responses:\n\n### Error Response Format\n\n```json\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Error message\",\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"details\": {\n      \"field\": \"value\",\n      \"user_id\": \"a2cfa5fc-5963-4a53-a0a8-6d2d250af8fd\"\n    }\n  },\n  \"timestamp\": \"2025-01-28T15:51:55.980680Z\"\n}\n```\n\n### Common Error Codes\n\n| Error Code | HTTP Status | Description |\n|------------|-------------|-------------|\n| `PROFILE_NOT_FOUND` | 404 | User profile not found |\n| `PROFILE_INVALID_PAYLOAD` | 400 | Invalid request data |\n| `PROFILE_UPDATE_FAILED` | 500 | Profile update operation failed |\n| `PROFILE_PICTURE_UPDATE_FAILED` | 500 | Profile picture upload failed |\n| `PROFILE_INVALID_OTP` | 400 | Invalid or expired OTP |\n| `EMAIL_ALREADY_EXISTS` | 400 | Email already registered to another user |\n| `PERMISSION_DENIED` | 403 | User lacks required permission |\n| `UNAUTHORIZED` | 401 | Invalid or missing authentication token |\n| `PROFILE_PROCESSING_ERROR` | 500 | Internal server error processing profile request |\n\n### Error Handling Best Practices\n\n1. **Client-Side:**\n   - Always check `response.success` before processing data\n   - Display user-friendly error messages\n   - Handle 401 errors by redirecting to login\n   - Handle 403 errors by showing permission denied message\n   - Log errors for debugging\n\n2. **Server-Side:**\n   - All errors are logged with context\n   - Sensitive information is not exposed in error messages\n   - Errors include user_id for tracking\n   - Database errors are caught and returned as 500\n\n---\n\n## Best Practices\n\n### Profile Management\n\n1. **Partial Updates:**\n   - Only send fields that need to be updated\n   - Don't send protected fields (user_id, email, phone)\n   - Use appropriate endpoints for email/phone changes\n\n2. **Profile Picture:**\n   - Validate file size (recommended: < 5MB)\n   - Validate file type (jpg, png, gif, webp)\n   - Show loading state during upload\n   - Handle upload failures gracefully\n\n3. **Email/Phone Changes:**\n   - Always request OTP first\n   - Verify OTP before allowing change\n   - Show clear instructions to user\n   - Handle OTP expiration (10 minutes)\n\n4. **Token Management:**\n   - Use session_token for API calls (recommended)\n   - Store tokens securely (httpOnly cookies or secure storage)\n   - Handle token expiration with refresh flow\n   - Include tokens in all authenticated requests\n\n5. **Permissions:**\n   - Check user permissions before showing edit buttons\n   - Handle permission errors gracefully\n   - Request appropriate permissions from admin if needed\n\n### Security\n\n1. **Authentication:**\n   - Always include tokens in request headers\n   - Use HTTPS for all API calls\n   - Don't expose tokens in URLs or logs\n\n2. **Data Validation:**\n   - Validate all user input on client side\n   - Server validates all inputs (don't trust client)\n   - Sanitize user-generated content (bio, etc.)\n\n3. **File Uploads:**\n   - Validate file types and sizes\n   - Scan files for malware (if applicable)\n   - Store files in secure, isolated storage\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Store tokens after login\nfunction storeTokens(tokens) {\n  localStorage.setItem('access_token', tokens.access_token);\n  localStorage.setItem('session_token', tokens.session_token);\n  localStorage.setItem('refresh_token', tokens.refresh_token);\n  localStorage.setItem('session_id', tokens.session_id);\n}\n\n// Get token for API calls (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper\nasync function apiRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, try refresh\n    await refreshTokens();\n    // Retry request\n    return apiRequest(url, options);\n  }\n  \n  return response.json();\n}\n```\n\n### Profile Update Example\n\n```javascript\n// Update Profile\nasync function updateProfile(profileData) {\n  try {\n    // Remove protected fields\n    const { user_id, email, phone_number, ...updateData } = profileData;\n    \n    const response = await apiRequest('/api/v1/settings/update-profile', {\n      method: 'POST',\n      body: JSON.stringify(updateData)\n    });\n    \n    if (response.success) {\n      // Update UI\n      updateProfileDisplay(response.data);\n      showNotification('Profile updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to update profile');\n    }\n  } catch (error) {\n    console.error('Error updating profile:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Update Profile Picture\nasync function updateProfilePicture(file) {\n  try {\n    // Validate file\n    if (!file || !file.type.startsWith('image/')) {\n      throw new Error('Please select a valid image file');\n    }\n    \n    if (file.size > 5 * 1024 * 1024) {\n      throw new Error('Image size must be less than 5MB');\n    }\n    \n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    const token = getAuthToken();\n    \n    const response = await fetch('/api/v1/settings/update-profile-picture', {\n      method: 'POST',\n      headers: {\n        'X-Session-Token': token\n      },\n      body: formData\n    });\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      // Update UI\n      document.getElementById('profile-picture').src = data.data.profile_picture_url;\n      showNotification('Profile picture updated successfully');\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update profile picture');\n    }\n  } catch (error) {\n    console.error('Error updating profile picture:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Change Email\nasync function changeEmail(newEmail, otp) {\n  try {\n    // First, request OTP to new email\n    await requestOTP(newEmail, 'email');\n    \n    // Then, change email with OTP\n    const response = await apiRequest('/api/v1/settings/change-email', {\n      method: 'POST',\n      body: JSON.stringify({\n        new_email: newEmail,\n        otp: otp\n      })\n    });\n    \n    if (response.success) {\n      showNotification('Email updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to change email');\n    }\n  } catch (error) {\n    console.error('Error changing email:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Change Phone\nasync function changePhone(newPhone, otp, channel = 'sms') {\n  try {\n    // First, request OTP to new phone\n    const token = getAuthToken();\n    const otpResponse = await fetch(\n      `/api/v1/settings/send-phone-otp?phone=${encodeURIComponent(newPhone)}&channel=${channel}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    \n    const otpData = await otpResponse.json();\n    if (!otpData.success) {\n      throw new Error('Failed to send OTP');\n    }\n    \n    // Then, change phone with OTP\n    const response = await apiRequest('/api/v1/settings/change-phone', {\n      method: 'POST',\n      body: JSON.stringify({\n        new_phone: newPhone,\n        otp: otp\n      })\n    });\n    \n    if (response.success) {\n      showNotification('Phone number updated successfully');\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to change phone');\n    }\n  } catch (error) {\n    console.error('Error changing phone:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Get Profile\nasync function getProfile() {\n  try {\n    const response = await apiRequest('/api/v1/settings/profile', {\n      method: 'GET'\n    });\n    \n    if (response.success) {\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to fetch profile');\n    }\n  } catch (error) {\n    console.error('Error fetching profile:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Update Theme\nasync function updateTheme(theme) {\n  try {\n    if (!['light', 'dark'].includes(theme)) {\n      throw new Error('Theme must be \"light\" or \"dark\"');\n    }\n    \n    const token = getAuthToken();\n    const response = await fetch(\n      `/api/v1/settings/update-theme?theme=${theme}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      showNotification('Theme updated successfully');\n      // Apply theme to UI\n      document.documentElement.setAttribute('data-theme', theme);\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update theme');\n    }\n  } catch (error) {\n    console.error('Error updating theme:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Update Timezone\nasync function updateTimezone(timezone) {\n  try {\n    const token = getAuthToken();\n    const response = await fetch(\n      `/api/v1/settings/update-timezone?timezone=${encodeURIComponent(timezone)}`,\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      showNotification('Timezone updated successfully');\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to update timezone');\n    }\n  } catch (error) {\n    console.error('Error updating timezone:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Deactivate Account\nasync function deactivateAccount() {\n  try {\n    const confirmed = confirm('Are you sure you want to deactivate your account?');\n    if (!confirmed) {\n      return;\n    }\n    \n    const response = await apiRequest('/api/v1/settings/deactivate-account', {\n      method: 'POST'\n    });\n    \n    if (response.success) {\n      showNotification('Account deactivated successfully');\n      // Redirect to login or home page\n      window.location.href = '/login';\n      return response.data;\n    } else {\n      throw new Error(response.error?.message || 'Failed to deactivate account');\n    }\n  } catch (error) {\n    console.error('Error deactivating account:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n\n// Delete Account\nasync function deleteAccount() {\n  try {\n    const confirmed = confirm(\n      'Are you sure you want to delete your account? This action cannot be undone.'\n    );\n    if (!confirmed) {\n      return;\n    }\n    \n    const token = getAuthToken();\n    const response = await fetch(\n      '/api/v1/settings/delete-account?confirm=true',\n      {\n        method: 'POST',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (data.success) {\n      showNotification('Account deleted successfully');\n      // Redirect to login or home page\n      window.location.href = '/login';\n      return data.data;\n    } else {\n      throw new Error(data.error?.message || 'Failed to delete account');\n    }\n  } catch (error) {\n    console.error('Error deleting account:', error);\n    showError(error.message);\n    throw error;\n  }\n}\n```\n\n### Complete Profile Management Example\n\n```javascript\n// Complete Profile Management Component\nclass ProfileManager {\n  constructor() {\n    this.profile = null;\n    this.token = null;\n  }\n  \n  async init() {\n    // Load profile on initialization\n    this.token = getAuthToken();\n    if (this.token) {\n      await this.loadProfile();\n    }\n  }\n  \n  async loadProfile() {\n    try {\n      this.profile = await getProfile();\n      this.renderProfile();\n      return this.profile;\n    } catch (error) {\n      console.error('Failed to load profile:', error);\n      return null;\n    }\n  }\n  \n  renderProfile() {\n    if (!this.profile) return;\n    \n    // Update UI elements\n    document.getElementById('profile-name').textContent = \n      `${this.profile.first_name || ''} ${this.profile.last_name || ''}`.trim();\n    document.getElementById('profile-email').textContent = this.profile.email || '';\n    document.getElementById('profile-bio').textContent = this.profile.bio || '';\n    \n    if (this.profile.profile_picture_url) {\n      document.getElementById('profile-picture').src = this.profile.profile_picture_url;\n    }\n    \n    // Update theme\n    if (this.profile.theme) {\n      document.documentElement.setAttribute('data-theme', this.profile.theme);\n    }\n  }\n  \n  async updateProfile(data) {\n    try {\n      this.profile = await updateProfile(data);\n      this.renderProfile();\n      return this.profile;\n    } catch (error) {\n      console.error('Failed to update profile:', error);\n      throw error;\n    }\n  }\n  \n  async updatePicture(file) {\n    try {\n      const result = await updateProfilePicture(file);\n      this.profile.profile_picture_url = result.profile_picture_url;\n      this.renderProfile();\n      return result;\n    } catch (error) {\n      console.error('Failed to update picture:', error);\n      throw error;\n    }\n  }\n}\n\n// Initialize profile manager\nconst profileManager = new ProfileManager();\nprofileManager.init();\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all profile management endpoints:\n\n### Endpoints Covered:\n1. âœ… **Get User Profile** - View own profile\n2. âœ… **Get User Profile by ID** - View other users' profiles\n3. âœ… **Update Profile Picture** - Upload and update profile picture\n4. âœ… **Update Profile** - Partial profile updates\n5. âœ… **Profile Accessibility** - Update profile visibility\n6. âœ… **Profile Language** - Update language preference\n7. âœ… **Change Email** - Change email with OTP verification\n8. âœ… **Change Phone** - Change phone with OTP verification\n9. âœ… **Send Phone OTP** - Request OTP for phone verification\n10. âœ… **Update Theme** - Update theme preference\n11. âœ… **Update Timezone** - Update timezone preference\n12. âœ… **Get Settings** - Get all user settings\n13. âœ… **Deactivate Account** - Deactivate user account\n14. âœ… **Delete Account** - Delete user account (soft delete)\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices\n- âœ… Complete client-side implementation examples\n- âœ… User model reference\n\n### Key Features:\n- **Permission-based access control** - All endpoints require appropriate permissions\n- **OTP verification** - Email and phone changes require OTP verification\n- **Partial updates** - Only send fields that need updating\n- **File uploads** - Profile pictures uploaded to Google Cloud Storage\n- **Comprehensive error handling** - Standardized error responses\n- **Client-side examples** - Ready-to-use JavaScript code\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance."
		},
		{
			"name": "User & Activity",
			"item": [
				{
					"name": "Create activity log",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"level\": \"info\",\n    \"message\": \"User logged in successfully\",\n    \"action\": \"login\",\n    \"module\": \"authentication\",\n    \"ip_address\": \"127.0.0.1\",\n    \"user_agent\": \"PostmanRuntime/7.49.1\",\n    \"device\": \"Desktop\",\n    \"browser\": null,\n    \"os\": null,\n    \"platform\": \"web\",\n    \"endpoint\": \"/dev/v1/activity/logs\",\n    \"method\": \"POST\",\n    \"status_code\": null,\n    \"request_id\": null,\n    \"session_id\": null,\n    \"metadata\": null,\n    \"error_details\": null,\n    \"duration_ms\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get specific log",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs/:log_id",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs",
								":log_id"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							],
							"variable": [
								{
									"key": "log_id",
									"value": "265df286-d4e2-45d0-a1d9-a4561baded93"
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get all logs (with filters)",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get current user logs",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/me/logs",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"me",
								"logs"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Delete old logs",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/logs/cleanup",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"logs",
								"cleanup"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Activity Logging Router\n\n> **Complete Documentation for Activity Logging and Audit Trail Endpoints**\n\nThis router handles all activity logging operations including creating log entries, retrieving logs with filters, getting statistics, and managing log cleanup.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Create Activity Log](#create-activity-log)\n  - [Get Activity Logs](#get-activity-logs)\n  - [Get Activity Log by ID](#get-activity-log-by-id)\n  - [Get User Activity Logs](#get-user-activity-logs)\n  - [Get My Activity Logs](#get-my-activity-logs)\n  - [Get Activity Statistics](#get-activity-statistics)\n  - [Delete Old Activity Logs](#delete-old-activity-logs)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n\n## Overview\n\nThe Activity Logging router provides comprehensive audit trail and activity tracking functionality including:\n- **Activity Logging**: Create detailed activity log entries\n- **Log Retrieval**: Query logs with advanced filters\n- **User Activity Tracking**: Track user-specific activities\n- **Statistics**: Get activity statistics and analytics\n- **Log Management**: Clean up old logs\n\n**Base Path:** `/{MODE}/activity`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Create Activity Log\n\n**Endpoint:** `POST /{MODE}/activity/logs`\n\n**Description:** Create a new activity log entry with comprehensive metadata.\n\n**Authentication:** Required\n**Permission:** `edit_profile`\n\n**Request Body:**\n```json\n{\n  \"level\": \"info\",\n  \"message\": \"User performed action\",\n  \"action\": \"login\",\n  \"module\": \"authentication\",\n  \"ip_address\": \"192.168.1.1\",\n  \"user_agent\": \"Mozilla/5.0...\",\n  \"endpoint\": \"/api/token\",\n  \"method\": \"POST\",\n  \"status_code\": 200,\n  \"metadata\": {\n    \"key\": \"value\"\n  }\n}\n```\n\n**Level Options:** `info`, `warn`, `error`, `debug`, `audit`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Activity log created successfully\",\n  \"data\": {\n    \"activity_log\": {\n      \"log_id\": \"uuid\",\n      \"user_id\": \"uuid\",\n      \"level\": \"info\",\n      \"message\": \"User performed action\",\n      \"action\": \"login\",\n      \"module\": \"authentication\",\n      \"ip_address\": \"192.168.1.1\",\n      \"created_at\": \"2025-01-01T00:00:00.000Z\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_profile)\n   â”‚\n   â”œâ”€â–º Extract Request Metadata\n   â”‚   â”œâ”€â–º IP Address (req.ip or req.connection.remoteAddress)\n   â”‚   â”œâ”€â–º User Agent (req.get('user-agent'))\n   â”‚   â””â”€â–º Parse User Agent (device, browser, OS)\n   â”‚\n   â”œâ”€â–º Build Log Data\n   â”‚   â”œâ”€â–º user_id (from token or request body)\n   â”‚   â”œâ”€â–º level (default: 'info')\n   â”‚   â”œâ”€â–º message (required)\n   â”‚   â”œâ”€â–º action, module, endpoint, method\n   â”‚   â”œâ”€â–º ip_address, user_agent, device, browser, os\n   â”‚   â”œâ”€â–º request_id, session_id\n   â”‚   â”œâ”€â–º metadata (JSONB)\n   â”‚   â””â”€â–º error_details (JSONB, if error)\n   â”‚\n   â”œâ”€â–º Create Activity Log\n   â”‚   â””â”€â–º createActivityLog(logData)\n   â”‚\n   â””â”€â–º Return Created Log Entry\n```\n\n**Auto-Extracted Fields:**\n- `user_id`: From JWT token if not provided\n- `ip_address`: From request if not provided\n- `user_agent`: From request headers if not provided\n- `device`, `browser`, `os`: Parsed from user agent\n- `endpoint`: From request URL if not provided\n- `method`: From request method if not provided\n\n---\n\n### Get Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/logs`\n\n**Description:** Retrieve activity logs with advanced filtering options.\n\n**Authentication:** Required\n**Permission:** `view_activity_log`\n\n**Query Parameters:**\n- `user_id` (optional): Filter by user ID\n- `level` (optional): Filter by log level (`info`, `warn`, `error`, `debug`, `audit`)\n- `action` (optional): Filter by action\n- `module` (optional): Filter by module\n- `ip_address` (optional): Filter by IP address\n- `start_date` (optional): Start date (ISO format)\n- `end_date` (optional): End date (ISO format)\n- `limit` (optional): Number of results (default: 100)\n- `offset` (optional): Pagination offset (default: 0)\n- `order_by` (optional): Sort field (default: `created_at`)\n- `order` (optional): Sort order (`asc`, `desc`, default: `desc`)\n\n**Request:**\n```http\nGET /dev/v1/activity/logs?user_id=uuid&level=error&limit=50&offset=0 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Activity logs retrieved successfully\",\n  \"data\": {\n    \"activity_logs\": [\n      {\n        \"log_id\": \"uuid\",\n        \"user_id\": \"uuid\",\n        \"level\": \"error\",\n        \"message\": \"Error occurred\",\n        \"action\": \"api_call\",\n        \"module\": \"api\",\n        \"ip_address\": \"192.168.1.1\",\n        \"created_at\": \"2025-01-01T00:00:00.000Z\"\n      }\n    ],\n    \"count\": 50\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º Filters (user_id, level, action, module, ip_address)\n   â”‚   â”œâ”€â–º Date Range (start_date, end_date)\n   â”‚   â”œâ”€â–º Pagination (limit, offset)\n   â”‚   â””â”€â–º Sorting (order_by, order)\n   â”‚\n   â”œâ”€â–º Build Query Filters\n   â”‚   â””â”€â–º Construct Prisma where clause\n   â”‚\n   â”œâ”€â–º Execute Query\n   â”‚   â””â”€â–º getActivityLogs(filters)\n   â”‚\n   â””â”€â–º Return Filtered Logs\n```\n\n---\n\n### Get Activity Log by ID\n\n**Endpoint:** `GET /{MODE}/activity/logs/:log_id`\n\n**Description:** Get a specific activity log by ID.\n\n**Authentication:** Required\n**Permission:** `view_activity_log`\n\n**Parameters:**\n- `log_id` (path): Log UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Activity log retrieved successfully\",\n  \"data\": {\n    \"activity_log\": {\n      \"log_id\": \"uuid\",\n      \"user_id\": \"uuid\",\n      \"level\": \"info\",\n      \"message\": \"User performed action\",\n      \"action\": \"login\",\n      \"module\": \"authentication\",\n      \"ip_address\": \"192.168.1.1\",\n      \"user_agent\": \"Mozilla/5.0...\",\n      \"device\": \"Desktop\",\n      \"browser\": \"Chrome\",\n      \"os\": \"Windows\",\n      \"endpoint\": \"/api/token\",\n      \"method\": \"POST\",\n      \"status_code\": 200,\n      \"metadata\": { ... },\n      \"created_at\": \"2025-01-01T00:00:00.000Z\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Get Activity Log by ID\n   â”‚   â””â”€â–º getActivityLogById(log_id)\n   â”‚\n   â”œâ”€â–º Check if Log Exists\n   â”‚   â””â”€â–º Return 404 if not found\n   â”‚\n   â””â”€â–º Return Activity Log\n```\n\n---\n\n### Get User Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/users/:user_id/logs`\n\n**Description:** Get activity logs for a specific user.\n\n**Authentication:** Required\n**Permission:** `view_activity_log`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Query Parameters:**\n- `start_date` (optional): Start date (ISO format)\n- `end_date` (optional): End date (ISO format)\n- `limit` (optional): Number of results (default: 100)\n- `offset` (optional): Pagination offset (default: 0)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User activity logs retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"activity_logs\": [ ... ],\n    \"count\": 25\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º Date Range (start_date, end_date)\n   â”‚   â””â”€â–º Pagination (limit, offset)\n   â”‚\n   â”œâ”€â–º Get User Activity Logs\n   â”‚   â””â”€â–º getUserActivityLogs(user_id, filters)\n   â”‚\n   â””â”€â–º Return User Activity Logs\n```\n\n---\n\n### Get My Activity Logs\n\n**Endpoint:** `GET /{MODE}/activity/me/logs`\n\n**Description:** Get activity logs for the current authenticated user.\n\n**Authentication:** Required\n**Permission:** `view_profile`\n\n**Query Parameters:**\n- `start_date` (optional): Start date (ISO format)\n- `end_date` (optional): End date (ISO format)\n- `limit` (optional): Number of results (default: 100)\n- `offset` (optional): Pagination offset (default: 0)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Your activity logs retrieved successfully\",\n  \"data\": {\n    \"activity_logs\": [ ... ],\n    \"count\": 10\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º Date range and pagination\n   â”‚\n   â”œâ”€â–º Get User Activity Logs\n   â”‚   â””â”€â–º getUserActivityLogs(userId, filters)\n   â”‚\n   â””â”€â–º Return Activity Logs\n```\n\n---\n\n### Get Activity Statistics\n\n**Endpoint:** `GET /{MODE}/activity/statistics`\n\n**Description:** Get activity log statistics including counts by level, action, and module.\n\n**Authentication:** Required\n**Permission:** `view_activity_log`\n\n**Query Parameters:**\n- `user_id` (optional): Filter by user ID\n- `start_date` (optional): Start date (ISO format)\n- `end_date` (optional): End date (ISO format)\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Activity statistics retrieved successfully\",\n  \"data\": {\n    \"statistics\": {\n      \"total_logs\": 1000,\n      \"by_level\": {\n        \"info\": 800,\n        \"warn\": 100,\n        \"error\": 80,\n        \"debug\": 15,\n        \"audit\": 5\n      },\n      \"by_action\": {\n        \"login\": 200,\n        \"logout\": 150,\n        \"api_call\": 500\n      },\n      \"by_module\": {\n        \"authentication\": 350,\n        \"api\": 500,\n        \"profile\": 150\n      }\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º user_id (optional)\n   â”‚   â””â”€â–º Date range (optional)\n   â”‚\n   â”œâ”€â–º Build Query Filters\n   â”‚\n   â”œâ”€â–º Calculate Statistics\n   â”‚   â”œâ”€â–º Total logs count\n   â”‚   â”œâ”€â–º Count by level (groupBy)\n   â”‚   â”œâ”€â–º Count by action (groupBy)\n   â”‚   â””â”€â–º Count by module (groupBy)\n   â”‚\n   â””â”€â–º Return Statistics\n```\n\n---\n\n### Delete Old Activity Logs\n\n**Endpoint:** `DELETE /{MODE}/activity/logs/cleanup`\n\n**Description:** Delete activity logs older than specified days.\n\n**Authentication:** Required\n**Permission:** `delete_activity_log`\n\n**Query Parameters:**\n- `days` (optional): Days old (default: 90)\n\n**Request:**\n```http\nDELETE /dev/v1/activity/logs/cleanup?days=90 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Old activity logs deleted successfully\",\n  \"data\": {\n    \"deleted_count\": 500,\n    \"days_old\": 90\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_activity_log)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º days (default: 90)\n   â”‚\n   â”œâ”€â–º Calculate Cutoff Date\n   â”‚   â””â”€â–º Current date - days\n   â”‚\n   â”œâ”€â–º Delete Old Logs\n   â”‚   â””â”€â–º deleteOldActivityLogs(daysOld)\n   â”‚       â””â”€â–º prisma.activityLog.deleteMany()\n   â”‚\n   â””â”€â–º Return Deletion Count\n```\n\n**Use Cases:**\n- Database maintenance\n- Storage optimization\n- Compliance (GDPR data retention)\n- Performance optimization\n\n---\n\n## Workflows\n\n### Complete Activity Logging Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Activity Logging Flow                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Create Log   â”‚         â”‚  Query Logs   â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Extract Meta  â”‚         â”‚ Apply Filters â”‚\n        â”‚   Data        â”‚         â”‚   & Paginationâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Parse User    â”‚         â”‚ Execute Query â”‚\n        â”‚   Agent       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Store in DB   â”‚         â”‚ Return Resultsâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Activity Log Creation Flow\n\n```\n1. User Action Occurs\n   â”‚\n   â”œâ”€â–º Extract Request Context\n   â”‚   â”œâ”€â–º IP Address\n   â”‚   â”œâ”€â–º User Agent\n   â”‚   â”œâ”€â–º Endpoint\n   â”‚   â””â”€â–º Method\n   â”‚\n   â”œâ”€â–º Parse User Agent\n   â”‚   â”œâ”€â–º Device Type\n   â”‚   â”œâ”€â–º Browser\n   â”‚   â””â”€â–º Operating System\n   â”‚\n   â”œâ”€â–º Build Log Entry\n   â”‚   â”œâ”€â–º User ID\n   â”‚   â”œâ”€â–º Level\n   â”‚   â”œâ”€â–º Message\n   â”‚   â”œâ”€â–º Action & Module\n   â”‚   â”œâ”€â–º Request Metadata\n   â”‚   â””â”€â–º Custom Metadata\n   â”‚\n   â”œâ”€â–º Store in Database\n   â”‚   â””â”€â–º ActivityLog table\n   â”‚\n   â””â”€â–º Return Log Entry\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"message is required\",\n  \"statusCode\": 400\n}\n```\n\n**403 Forbidden - Permission Denied:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires view_activity_log permission\",\n  \"statusCode\": 403\n}\n```\n\n**404 Not Found - Log Not Found:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Activity log not found\",\n  \"error\": \"Log with provided ID does not exist\",\n  \"statusCode\": 404\n}\n```\n\n**500 Internal Server Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Activity log creation failed\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n```\n\n---\n\n## Best Practices\n\n1. **Log Levels**: Use appropriate log levels (info, warn, error, debug, audit)\n2. **Metadata**: Include relevant metadata for debugging and auditing\n3. **User Agent Parsing**: Automatically parse user agent for device/browser/OS info\n4. **Pagination**: Always use pagination for log queries to avoid performance issues\n5. **Date Filtering**: Use date filters to limit query scope\n6. **Log Cleanup**: Regularly clean up old logs to maintain database performance\n7. **Sensitive Data**: Don't log sensitive information (passwords, tokens, etc.)\n8. **Performance**: Index frequently queried fields (user_id, level, action, created_at)\n\n---\n\n## Log Levels\n\n- **info**: General informational messages\n- **warn**: Warning messages for potential issues\n- **error**: Error messages for failures\n- **debug**: Debug messages for development\n- **audit**: Audit trail messages for compliance\n\n---\n\n## Database Schema\n\n**ActivityLog Model:**\n- `log_id`: UUID (Primary Key)\n- `user_id`: UUID (Foreign Key, nullable)\n- `level`: String (info, warn, error, debug, audit)\n- `message`: String\n- `action`: String (nullable)\n- `module`: String (nullable)\n- `ip_address`: String\n- `user_agent`: String\n- `device`: String (nullable)\n- `browser`: String (nullable)\n- `os`: String (nullable)\n- `platform`: String (default: 'web')\n- `endpoint`: String (nullable)\n- `method`: String (nullable)\n- `status_code`: Integer (nullable)\n- `request_id`: String (nullable)\n- `session_id`: String (nullable)\n- `metadata`: JSONB (nullable)\n- `error_details`: JSONB (nullable)\n- `duration_ms`: Integer (nullable)\n- `created_at`: Timestamp\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Groups & Permissions",
			"item": [
				{
					"name": "Permissions",
					"item": [
						{
							"name": "permissions",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"response": [
								{
									"name": "profile",
									"originalRequest": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{domain.com}}/{{mode}}/settings/profile",
											"host": [
												"{{domain.com}}"
											],
											"path": [
												"{{mode}}",
												"settings",
												"profile"
											],
											"query": [
												{
													"key": "page",
													"value": "1",
													"disabled": true
												},
												{
													"key": "page_size",
													"value": "1",
													"disabled": true
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Server",
											"value": "openresty"
										},
										{
											"key": "Date",
											"value": "Sun, 16 Nov 2025 07:46:55 GMT"
										},
										{
											"key": "Content-Type",
											"value": "application/json",
											"description": "",
											"type": "text"
										},
										{
											"key": "Content-Length",
											"value": "994"
										},
										{
											"key": "Connection",
											"value": "keep-alive"
										},
										{
											"key": "X-XSS-Protection",
											"value": "1; mode=block"
										},
										{
											"key": "X-Content-Type-Options",
											"value": "nosniff"
										},
										{
											"key": "X-Frame-Options",
											"value": "DENY"
										},
										{
											"key": "Referrer-Policy",
											"value": "strict-origin-when-cross-origin"
										},
										{
											"key": "Permissions-Policy",
											"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
										},
										{
											"key": "X-Permitted-Cross-Domain-Policies",
											"value": "none"
										},
										{
											"key": "Content-Security-Policy",
											"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
										},
										{
											"key": "X-Served-By",
											"value": "v3.staging.winsta.pro"
										}
									],
									"cookie": [],
									"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
								}
							]
						},
						{
							"name": "get-permissions",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/59bcc480-e972-46db-8b7f-804af5102e42?page=1&page_size=1",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"59bcc480-e972-46db-8b7f-804af5102e42"
									],
									"query": [
										{
											"key": "page",
											"value": "1"
										},
										{
											"key": "page_size",
											"value": "1"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "create-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									]
								}
							},
							"response": []
						},
						{
							"name": "update-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"type": "file",
											"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"permission_id"
									]
								}
							},
							"response": []
						},
						{
							"name": "delete-permissions",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions",
										"permission_id"
									]
								}
							},
							"response": []
						}
					],
					"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints** \n  \n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    \n    - [Permissions](#permissions)\n        \n    - [Groups](#groups)\n        \n    - [User Permissions &amp; Groups](#user-permissions--groups)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n\n- **Permission Management**: Create, read, update, and delete permissions\n    \n- **Group Management**: Create, read, update, and delete groups\n    \n- **Permission Assignment**: Assign permissions to groups\n    \n- **User-Group Assignment**: Assign groups to users\n    \n- **Permission Queries**: Get user permissions and groups\n    \n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get All Permissions\n   â”‚   â””â”€â–º prisma.permission.findMany()\n   â”‚\n   â””â”€â–º Return Permissions List\n\n ```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n\n ```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required  \n**Permission:** `add_permission`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_permission)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Permission\n   â”‚   â””â”€â–º prisma.permission.create()\n   â”‚\n   â””â”€â–º Return Created Permission\n\n ```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required  \n**Permission:** `edit_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n\n ```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required  \n**Permission:** `delete_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n\n ```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n\n ```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required  \n**Permission:** `add_group`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n\n ```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required  \n**Permission:** `delete_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required  \n**Permission:** `assign_groups`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n\n ```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissionsâ”‚\n                    â”‚   (Aggregated)  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n\n ```\n\n**403 Forbidden - Permission Denied:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - Duplicate Entry:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n    \n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n    \n3. **System Groups**: Don't delete system groups (is_system = true)\n    \n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n    \n5. **Group Assignment**: Assign groups to users, not permissions directly\n    \n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n    \n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n    \n8. **Validation**: Always validate permission/group codenames before assignment\n    \n\n---\n\n**Last Updated**: January 2025"
				},
				{
					"name": "Groups",
					"item": [
						{
							"name": "groups",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"response": [
								{
									"name": "profile",
									"originalRequest": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{domain.com}}/{{mode}}/settings/profile",
											"host": [
												"{{domain.com}}"
											],
											"path": [
												"{{mode}}",
												"settings",
												"profile"
											],
											"query": [
												{
													"key": "page",
													"value": "1",
													"disabled": true
												},
												{
													"key": "page_size",
													"value": "1",
													"disabled": true
												}
											]
										}
									},
									"status": "OK",
									"code": 200,
									"_postman_previewlanguage": "json",
									"header": [
										{
											"key": "Server",
											"value": "openresty"
										},
										{
											"key": "Date",
											"value": "Sun, 16 Nov 2025 07:46:55 GMT"
										},
										{
											"key": "Content-Type",
											"value": "application/json",
											"description": "",
											"type": "text"
										},
										{
											"key": "Content-Length",
											"value": "994"
										},
										{
											"key": "Connection",
											"value": "keep-alive"
										},
										{
											"key": "X-XSS-Protection",
											"value": "1; mode=block"
										},
										{
											"key": "X-Content-Type-Options",
											"value": "nosniff"
										},
										{
											"key": "X-Frame-Options",
											"value": "DENY"
										},
										{
											"key": "Referrer-Policy",
											"value": "strict-origin-when-cross-origin"
										},
										{
											"key": "Permissions-Policy",
											"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
										},
										{
											"key": "X-Permitted-Cross-Domain-Policies",
											"value": "none"
										},
										{
											"key": "Content-Security-Policy",
											"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
										},
										{
											"key": "X-Served-By",
											"value": "v3.staging.winsta.pro"
										}
									],
									"cookie": [],
									"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
								}
							]
						},
						{
							"name": "get-groups",
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/9c93cc19-7325-45e4-8f03-7ea80850170d?page=1&page_size=1",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"9c93cc19-7325-45e4-8f03-7ea80850170d"
									],
									"query": [
										{
											"key": "page",
											"value": "1"
										},
										{
											"key": "page_size",
											"value": "1"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "create",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"permissions"
									]
								}
							},
							"response": []
						},
						{
							"name": "Assign permissions to group",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/:group_id/permissions",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										":group_id",
										"permissions"
									],
									"variable": [
										{
											"key": "group_id",
											"value": ""
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "update",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "PUT",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"type": "file",
											"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
										}
									]
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/groups_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"groups_id"
									]
								}
							},
							"response": []
						},
						{
							"name": "delete-groups",
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{access_token}}",
											"type": "string"
										}
									]
								},
								"method": "DELETE",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"new_email\": \"mrdasdeveloper@gmail.com\",\n  \"otp\": \"123456\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{domain.com}}/{{mode}}/groups/permission_id",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"groups",
										"permission_id"
									]
								}
							},
							"response": []
						}
					],
					"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints** \n  \n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n    \n- [Endpoints](#endpoints)\n    \n    - [Permissions](#permissions)\n        \n    - [Groups](#groups)\n        \n    - [User Permissions &amp; Groups](#user-permissions--groups)\n        \n- [Workflows](#workflows)\n    \n- [Error Handling](#error-handling)\n    \n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n\n- **Permission Management**: Create, read, update, and delete permissions\n    \n- **Group Management**: Create, read, update, and delete groups\n    \n- **Permission Assignment**: Assign permissions to groups\n    \n- **User-Group Assignment**: Assign groups to users\n    \n- **Permission Queries**: Get user permissions and groups\n    \n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get All Permissions\n   â”‚   â””â”€â–º prisma.permission.findMany()\n   â”‚\n   â””â”€â–º Return Permissions List\n\n ```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required  \n**Permission:** `view_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n\n ```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required  \n**Permission:** `add_permission`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_permission)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Permission\n   â”‚   â””â”€â–º prisma.permission.create()\n   â”‚\n   â””â”€â–º Return Created Permission\n\n ```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required  \n**Permission:** `edit_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n\n ```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required  \n**Permission:** `delete_permission`\n\n**Parameters:**\n\n- `permission_id` (path): Permission UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n\n ```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required  \n**Permission:** `view_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n\n ```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required  \n**Permission:** `add_group`\n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n\n ```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required  \n**Permission:** `delete_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n\n ```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required  \n**Permission:** `edit_group`\n\n**Parameters:**\n\n- `group_id` (path): Group UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n\n ```\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n\n ```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required  \n**Permission:** `view_user`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required  \n**Permission:** `assign_groups`\n\n**Parameters:**\n\n- `user_id` (path): User UUID\n    \n\n**Request Body:**\n\n``` json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n\n ```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n\n ```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required  \n**Permission:** `view_profile`\n\n**Response:**\n\n``` json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n\n ```\n\n**Workflow:**\n\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n\n ```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissionsâ”‚\n                    â”‚   (Aggregated)  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n ```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n\n ```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n\n ```\n\n**403 Forbidden - Permission Denied:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n\n ```\n\n**404 Not Found:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n\n ```\n\n**409 Conflict - Duplicate Entry:**\n\n``` json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n\n ```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n    \n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n    \n3. **System Groups**: Don't delete system groups (is_system = true)\n    \n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n    \n5. **Group Assignment**: Assign groups to users, not permissions directly\n    \n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n    \n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n    \n8. **Validation**: Always validate permission/group codenames before assignment\n    \n\n---\n\n**Last Updated**: January 2025"
				},
				{
					"name": "Get user's groups",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"groups"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "Get user's permissions",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/:user_id/permissions",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								":user_id",
								"permissions"
							],
							"variable": [
								{
									"key": "user_id",
									"value": ""
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Assign groups to user",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/api/users/:user_id/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"api",
								"users",
								":user_id",
								"groups"
							],
							"variable": [
								{
									"key": "user_id",
									"value": ""
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get current user's groups",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"MR\",\n  \"last_name\": \"DAS\",\n  \"country\": \"Nepal\",\n  \"bio\": \"Full Stack Developer\",\n  \"email\": \"demo@gmail.com\",\n  \"language\": \"en\",\n  \"gender\":\"Male\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/me/groups",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								"me",
								"groups"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get current user's permissions",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/users/me/permissions",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"users",
								"me",
								"permissions"
							]
						}
					},
					"response": []
				}
			],
			"description": "# Permissions & Groups Router\n\n> **Complete Documentation for Permission and Group Management Endpoints**\n\nThis router handles all permission and group management operations including CRUD operations for permissions and groups, assigning permissions to groups, and managing user-group relationships.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Permissions](#permissions)\n  - [Groups](#groups)\n  - [User Permissions & Groups](#user-permissions--groups)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Client-Side Implementation](#client-side-implementation)\n- [Summary](#summary)\n\n## Overview\n\nThe Permissions & Groups router provides comprehensive role-based access control (RBAC) functionality including:\n- **Permission Management**: Create, read, update, and delete permissions\n- **Group Management**: Create, read, update, and delete groups\n- **Permission Assignment**: Assign permissions to groups\n- **User-Group Assignment**: Assign groups to users\n- **Permission Queries**: Get user permissions and groups\n\n**Base Path:** `/{MODE}/permissions`, `/{MODE}/groups`, `/{MODE}/users`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** Various permissions required (see each endpoint)\n\n## Endpoints\n\n### Permissions\n\n#### Get All Permissions\n\n**Endpoint:** `GET /{MODE}/permissions`\n\n**Description:** Get list of all permissions in the system.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_permission`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\",\n        \"description\": \"Permission to view dashboard\",\n        \"category\": \"dashboard\"\n      }\n    ]\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Admin navigates to permissions management page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/permissions\n\nStep 2: Client sends request\n  GET /{MODE}/permissions\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display permissions list in UI\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract permissions array from response.data.permissions\n  â”œâ”€â–º Render permissions table/list\n  â”œâ”€â–º Group by category if needed\n  â””â”€â–º Enable edit/delete actions based on permissions\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_permission\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Database query\n  â”œâ”€â–º Query all permissions from database\n  â”œâ”€â–º Fetch permission fields (permission_id, name, codename, description, category)\n  â””â”€â–º Order by category or name\n\nStep 4: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include permissions array in data.permissions\n  â””â”€â–º Return response with user's language preference\n\nStep 5: Error handling\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Error Responses:**\n\n```json\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_permission\"\n    }\n  }\n}\n\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Internal server error\",\n  \"error\": {\n    \"code\": \"INTERNAL_ERROR\",\n    \"details\": {\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n#### Get Permission by ID\n\n**Endpoint:** `GET /{MODE}/permissions/:permission_id`\n\n**Description:** Get a specific permission by ID.\n\n**Authentication:** Required\n**Permission:** `view_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission retrieved successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_permission)\n   â”‚\n   â”œâ”€â–º Get Permission by ID\n   â”‚   â””â”€â–º prisma.permission.findUnique()\n   â”‚\n   â””â”€â–º Return Permission Data\n```\n\n---\n\n#### Create Permission\n\n**Endpoint:** `POST /{MODE}/permissions`\n\n**Description:** Create a new permission.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `add_permission`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\nContent-Type: application/json\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Body:**\n```json\n{\n  \"name\": \"View Dashboard\",\n  \"codename\": \"view_dashboard\",\n  \"description\": \"Permission to view dashboard\",\n  \"category\": \"dashboard\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission created successfully\",\n  \"data\": {\n    \"permission\": {\n      \"permission_id\": \"uuid\",\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n  }\n}\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User fills permission form\n  â”œâ”€â–º User enters permission name\n  â”œâ”€â–º User enters codename (lowercase with underscores)\n  â”œâ”€â–º User enters description (optional)\n  â”œâ”€â–º User selects category (optional)\n  â””â”€â–º User clicks \"Create\" button\n\nStep 2: Client validates form\n  â”œâ”€â–º Validate name is not empty\n  â”œâ”€â–º Validate codename format (lowercase, underscores)\n  â”œâ”€â–º Check codename uniqueness (client-side check)\n  â””â”€â–º Prepare request payload\n\nStep 3: Client sends request\n  POST /{MODE}/permissions\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/json\n  Body:\n    {\n      \"name\": \"View Dashboard\",\n      \"codename\": \"view_dashboard\",\n      \"description\": \"Permission to view dashboard\",\n      \"category\": \"dashboard\"\n    }\n\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Add permission to list, show success message\n  â”œâ”€â–º Bad Request (400): Show validation errors\n  â”œâ”€â–º Conflict (409): Show duplicate codename error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Parse request body (PermissionCreate model)\n  â””â”€â–º Check permission: \"add_permission\"\n\nStep 2: Data validation\n  â”œâ”€â–º Validate name is provided and not empty\n  â”œâ”€â–º Validate codename is provided\n  â”œâ”€â–º Validate codename format (lowercase, underscores, alphanumeric)\n  â”œâ”€â–º Check codename uniqueness in database\n  â””â”€â–º If duplicate: Return 409 Conflict\n\nStep 3: Create permission\n  â”œâ”€â–º Insert permission into database\n  â”œâ”€â–º Generate permission_id (UUID)\n  â”œâ”€â–º Set created_at timestamp\n  â””â”€â–º Return created permission\n\nStep 4: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include created permission in data.permission\n  â””â”€â–º Return response with user's language preference\n\nStep 5: Error handling\n  â”œâ”€â–º Validation error: Return 400\n  â”œâ”€â–º Duplicate codename: Return 409\n  â”œâ”€â–º Permission denied: Return 403\n  â”œâ”€â–º Database error: Log error, return 500\n  â””â”€â–º Token invalid: Return 401\n```\n\n---\n\n#### Update Permission\n\n**Endpoint:** `PUT /{MODE}/permissions/:permission_id`\n\n**Description:** Update an existing permission.\n\n**Authentication:** Required\n**Permission:** `edit_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Request Body:**\n```json\n{\n  \"name\": \"View Dashboard Updated\",\n  \"description\": \"Updated description\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission updated successfully\",\n  \"data\": {\n    \"permission\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_permission)\n   â”‚\n   â”œâ”€â–º Update Permission\n   â”‚   â””â”€â–º prisma.permission.update()\n   â”‚\n   â””â”€â–º Return Updated Permission\n```\n\n---\n\n#### Delete Permission\n\n**Endpoint:** `DELETE /{MODE}/permissions/:permission_id`\n\n**Description:** Delete a permission. Removes permission from all groups.\n\n**Authentication:** Required\n**Permission:** `delete_permission`\n\n**Parameters:**\n- `permission_id` (path): Permission UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permission deleted successfully\",\n  \"data\": { ... }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_permission)\n   â”‚\n   â”œâ”€â–º Delete Permission\n   â”‚   â””â”€â–º prisma.permission.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission entries\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n---\n\n### Groups\n\n#### Get All Groups\n\n**Endpoint:** `GET /{MODE}/groups`\n\n**Description:** Get list of all groups with their permissions.\n\n**Authentication:** Required\n**Permission:** `view_group`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\",\n        \"description\": \"Administrator group\",\n        \"is_system\": true,\n        \"is_active\": true,\n        \"permissions\": [\n          {\n            \"permission_id\": \"uuid\",\n            \"name\": \"View Dashboard\",\n            \"codename\": \"view_dashboard\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get All Groups with Permissions\n   â”‚   â””â”€â–º prisma.group.findMany({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Groups List\n```\n\n---\n\n#### Get Group by ID\n\n**Endpoint:** `GET /{MODE}/groups/:group_id`\n\n**Description:** Get a specific group with its permissions.\n\n**Authentication:** Required\n**Permission:** `view_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group retrieved successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"name\": \"Admin\",\n      \"codename\": \"admin\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_group)\n   â”‚\n   â”œâ”€â–º Get Group by ID with Permissions\n   â”‚   â””â”€â–º prisma.group.findUnique({ include: { permissions } })\n   â”‚\n   â””â”€â–º Return Group Data\n```\n\n---\n\n#### Create Group\n\n**Endpoint:** `POST /{MODE}/groups`\n\n**Description:** Create a new group.\n\n**Authentication:** Required\n**Permission:** `add_group`\n\n**Request Body:**\n```json\n{\n  \"name\": \"Moderator\",\n  \"codename\": \"moderator\",\n  \"description\": \"Moderator group\",\n  \"is_system\": false,\n  \"is_active\": true\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group created successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_group)\n   â”‚\n   â”œâ”€â–º Validate Request Data\n   â”‚   â”œâ”€â–º name required\n   â”‚   â”œâ”€â–º codename required\n   â”‚   â””â”€â–º codename must be unique\n   â”‚\n   â”œâ”€â–º Create Group\n   â”‚   â””â”€â–º prisma.group.create()\n   â”‚\n   â””â”€â–º Return Created Group\n```\n\n---\n\n#### Update Group\n\n**Endpoint:** `PUT /{MODE}/groups/:group_id`\n\n**Description:** Update an existing group.\n\n**Authentication:** Required\n**Permission:** `edit_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Request Body:**\n```json\n{\n  \"name\": \"Moderator Updated\",\n  \"description\": \"Updated description\",\n  \"is_active\": true\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group updated successfully\",\n  \"data\": {\n    \"group\": { ... }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Update Group\n   â”‚   â””â”€â–º prisma.group.update()\n   â”‚\n   â””â”€â–º Return Updated Group\n```\n\n---\n\n#### Delete Group\n\n**Endpoint:** `DELETE /{MODE}/groups/:group_id`\n\n**Description:** Delete a group. System groups cannot be deleted.\n\n**Authentication:** Required\n**Permission:** `delete_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Group deleted successfully\",\n  \"data\": {\n    \"group_id\": \"uuid\"\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_group)\n   â”‚\n   â”œâ”€â–º Check if System Group\n   â”‚   â””â”€â–º If is_system = true, reject deletion\n   â”‚\n   â”œâ”€â–º Delete Group\n   â”‚   â””â”€â–º prisma.group.delete()\n   â”‚       â””â”€â–º Cascade deletes GroupPermission and UserGroup entries\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n**Note:** System groups (is_system = true) cannot be deleted.\n\n---\n\n#### Assign Permissions to Group\n\n**Endpoint:** `POST /{MODE}/groups/:group_id/permissions`\n\n**Description:** Assign permissions to a group. Replaces existing permissions.\n\n**Authentication:** Required\n**Permission:** `edit_group`\n\n**Parameters:**\n- `group_id` (path): Group UUID\n\n**Request Body:**\n```json\n{\n  \"permission_ids\": [\"uuid1\", \"uuid2\", \"uuid3\"]\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Permissions assigned successfully\",\n  \"data\": {\n    \"group\": {\n      \"group_id\": \"uuid\",\n      \"permissions\": [ ... ]\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (edit_group)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º permission_ids must be array\n   â”‚\n   â”œâ”€â–º Delete Existing Permissions\n   â”‚   â””â”€â–º prisma.groupPermission.deleteMany()\n   â”‚\n   â”œâ”€â–º Create New Permission Assignments\n   â”‚   â””â”€â–º prisma.groupPermission.createMany()\n   â”‚\n   â”œâ”€â–º Get Updated Group with Permissions\n   â”‚\n   â””â”€â–º Return Updated Group\n```\n\n---\n\n### User Permissions & Groups\n\n#### Get User Groups\n\n**Endpoint:** `GET /{MODE}/users/:user_id/groups`\n\n**Description:** Get all groups assigned to a user.\n\n**Authentication:** Required\n**Permission:** `view_user`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [\n      {\n        \"group_id\": \"uuid\",\n        \"name\": \"Admin\",\n        \"codename\": \"admin\"\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n---\n\n#### Get User Permissions\n\n**Endpoint:** `GET /{MODE}/users/:user_id/permissions`\n\n**Description:** Get all permissions for a user (from all groups).\n\n**Authentication:** Required\n**Permission:** `view_user`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"permissions\": [\n      {\n        \"permission_id\": \"uuid\",\n        \"name\": \"View Dashboard\",\n        \"codename\": \"view_dashboard\"\n      }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_user)\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(user_id)\n   â”‚       â””â”€â–º Aggregates permissions from all user groups\n   â”‚\n   â””â”€â–º Return User Permissions\n```\n\n---\n\n#### Assign Groups to User\n\n**Endpoint:** `POST /{MODE}/users/:user_id/groups`\n\n**Description:** Assign groups to a user. Uses group codenames. Updates user role flags.\n\n**Authentication:** Required\n**Permission:** `assign_groups`\n\n**Parameters:**\n- `user_id` (path): User UUID\n\n**Request Body:**\n```json\n{\n  \"group_codenames\": [\"admin\", \"user\"]\n}\n```\n\n**Valid Codenames:** `super_admin`, `admin`, `developer`, `business`, `accountant`, `user`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Groups assigned successfully (user role flags updated)\",\n  \"data\": {\n    \"user_id\": \"uuid\",\n    \"groups\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (assign_groups)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â”œâ”€â–º group_codenames must be array\n   â”‚   â””â”€â–º Validate codenames (must be valid)\n   â”‚\n   â”œâ”€â–º Get Assigned By User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Assign Groups to User\n   â”‚   â”œâ”€â–º Delete existing UserGroup entries\n   â”‚   â”œâ”€â–º Create new UserGroup entries\n   â”‚   â””â”€â–º Update user role flags (is_superuser, is_admin, etc.)\n   â”‚\n   â”œâ”€â–º Get Updated User Groups\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n**Note:** This endpoint updates user role flags (is_superuser, is_admin, etc.) based on assigned groups.\n\n---\n\n#### Get My Groups\n\n**Endpoint:** `GET /{MODE}/users/me/groups`\n\n**Description:** Get all groups for the current authenticated user.\n\n**Authentication:** Required\n**Permission:** `view_profile`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User groups retrieved successfully\",\n  \"data\": {\n    \"groups\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º getUserGroups(userId)\n   â”‚\n   â””â”€â–º Return User Groups\n```\n\n---\n\n#### Get My Permissions\n\n**Endpoint:** `GET /{MODE}/users/me/permissions`\n\n**Description:** Get all permissions for the current authenticated user.\n\n**Authentication:** Required\n**Permission:** `view_profile`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User permissions retrieved successfully\",\n  \"data\": {\n    \"permissions\": [ ... ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_profile)\n   â”‚\n   â”œâ”€â–º Get Current User ID\n   â”‚   â””â”€â–º From JWT token\n   â”‚\n   â”œâ”€â–º Get User Permissions\n   â”‚   â””â”€â–º getUserPermissions(userId)\n   â”‚\n   â””â”€â–º Return User Permissions\n```\n\n---\n\n## Workflows\n\n### Complete Permission Management Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚          Permission & Group Management Flow                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Permissions  â”‚         â”‚    Groups     â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚               â”‚         â”‚               â”‚\n        â–¼               â–¼         â–¼               â–¼\n    Create/Read    Update/Delete  Create/Read  Update/Delete\n        â”‚               â”‚         â”‚               â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Permissionsâ”‚\n                    â”‚   to Groups       â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Assign Groups   â”‚\n                    â”‚   to Users      â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ User Permissions â”‚\n                    â”‚   (Aggregated)   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### User Permission Resolution Flow\n\n```\n1. User Makes Request\n   â”‚\n   â”œâ”€â–º Extract JWT Token\n   â”‚\n   â”œâ”€â–º Get User ID from Token\n   â”‚\n   â”œâ”€â–º Get User Groups\n   â”‚   â””â”€â–º Query UserGroup table\n   â”‚\n   â”œâ”€â–º Get Group Permissions\n   â”‚   â””â”€â–º Query GroupPermission for each group\n   â”‚\n   â”œâ”€â–º Aggregate Permissions\n   â”‚   â””â”€â–º Combine all permissions from all groups\n   â”‚\n   â””â”€â–º Check Required Permission\n       â””â”€â–º Verify permission exists in aggregated list\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - Invalid Payload:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid request payload\",\n  \"error\": \"name and codename are required\",\n  \"statusCode\": 400\n}\n```\n\n**403 Forbidden - Permission Denied:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions\",\n  \"statusCode\": 403\n}\n```\n\n**404 Not Found:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Group not found\",\n  \"error\": \"Group with provided ID does not exist\",\n  \"statusCode\": 404\n}\n```\n\n**409 Conflict - Duplicate Entry:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Duplicate entry\",\n  \"error\": \"Group with this name or codename already exists\",\n  \"statusCode\": 409\n}\n```\n\n---\n\n## Best Practices\n\n1. **Permission Codenames**: Use lowercase with underscores (e.g., `view_dashboard`)\n2. **Group Codenames**: Use lowercase (e.g., `admin`, `user`)\n3. **System Groups**: Don't delete system groups (is_system = true)\n4. **Permission Assignment**: Assign permissions to groups, not directly to users\n5. **Group Assignment**: Assign groups to users, not permissions directly\n6. **Permission Aggregation**: User permissions are aggregated from all assigned groups\n7. **Role Flags**: User role flags are automatically updated when groups are assigned\n8. **Validation**: Always validate permission/group codenames before assignment\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for permissions endpoints\nasync function permissionsRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to perform this action');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success) {\n    throw new Error(data.error?.message || 'Request failed');\n  }\n  \n  return data;\n}\n```\n\n### Permissions Management\n\n```javascript\n// Get all permissions\nasync function getPermissions() {\n  try {\n    const response = await permissionsRequest('/api/dev/v1/permissions', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching permissions:', error);\n    showError('Failed to load permissions');\n    throw error;\n  }\n}\n\n// Get permission by ID\nasync function getPermission(permissionId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/permissions/${permissionId}`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error fetching permission:', error);\n    showError('Failed to load permission');\n    throw error;\n  }\n}\n\n// Create permission\nasync function createPermission(permissionData) {\n  try {\n    // Validate codename format\n    if (!/^[a-z][a-z0-9_]*$/.test(permissionData.codename)) {\n      throw new Error('Codename must be lowercase with underscores');\n    }\n    \n    const response = await permissionsRequest('/api/dev/v1/permissions', {\n      method: 'POST',\n      body: JSON.stringify(permissionData)\n    });\n    \n    if (response && response.data) {\n      showNotification('Permission created successfully');\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error creating permission:', error);\n    showError(error.message || 'Failed to create permission');\n    throw error;\n  }\n}\n\n// Update permission\nasync function updatePermission(permissionId, updateData) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/permissions/${permissionId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updateData)\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Permission updated successfully');\n      return response.data.permission;\n    }\n  } catch (error) {\n    console.error('Error updating permission:', error);\n    showError('Failed to update permission');\n    throw error;\n  }\n}\n\n// Delete permission\nasync function deletePermission(permissionId) {\n  try {\n    const confirmed = confirm('Are you sure you want to delete this permission?');\n    if (!confirmed) {\n      return;\n    }\n    \n    const response = await permissionsRequest(\n      `/api/dev/v1/permissions/${permissionId}`,\n      { method: 'DELETE' }\n    );\n    \n    if (response) {\n      showNotification('Permission deleted successfully');\n      return true;\n    }\n  } catch (error) {\n    console.error('Error deleting permission:', error);\n    showError('Failed to delete permission');\n    throw error;\n  }\n}\n```\n\n### Groups Management\n\n```javascript\n// Get all groups\nasync function getGroups() {\n  try {\n    const response = await permissionsRequest('/api/dev/v1/groups', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching groups:', error);\n    showError('Failed to load groups');\n    throw error;\n  }\n}\n\n// Get group by ID\nasync function getGroup(groupId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/groups/${groupId}`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error fetching group:', error);\n    showError('Failed to load group');\n    throw error;\n  }\n}\n\n// Create group\nasync function createGroup(groupData) {\n  try {\n    // Validate codename format\n    if (!/^[a-z][a-z0-9_]*$/.test(groupData.codename)) {\n      throw new Error('Codename must be lowercase with underscores');\n    }\n    \n    const response = await permissionsRequest('/api/dev/v1/groups', {\n      method: 'POST',\n      body: JSON.stringify(groupData)\n    });\n    \n    if (response && response.data) {\n      showNotification('Group created successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error creating group:', error);\n    showError(error.message || 'Failed to create group');\n    throw error;\n  }\n}\n\n// Update group\nasync function updateGroup(groupId, updateData) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/groups/${groupId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updateData)\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Group updated successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error updating group:', error);\n    showError('Failed to update group');\n    throw error;\n  }\n}\n\n// Delete group\nasync function deleteGroup(groupId) {\n  try {\n    const confirmed = confirm(\n      'Are you sure you want to delete this group? This will remove all user assignments.'\n    );\n    if (!confirmed) {\n      return;\n    }\n    \n    const response = await permissionsRequest(\n      `/api/dev/v1/groups/${groupId}`,\n      { method: 'DELETE' }\n    );\n    \n    if (response) {\n      showNotification('Group deleted successfully');\n      return true;\n    }\n  } catch (error) {\n    console.error('Error deleting group:', error);\n    showError('Failed to delete group');\n    throw error;\n  }\n}\n\n// Assign permissions to group\nasync function assignPermissionsToGroup(groupId, permissionIds) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/groups/${groupId}/permissions`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ permission_ids: permissionIds })\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Permissions assigned successfully');\n      return response.data.group;\n    }\n  } catch (error) {\n    console.error('Error assigning permissions:', error);\n    showError('Failed to assign permissions');\n    throw error;\n  }\n}\n```\n\n### User Permissions & Groups\n\n```javascript\n// Get user groups\nasync function getUserGroups(userId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/users/${userId}/groups`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching user groups:', error);\n    showError('Failed to load user groups');\n    throw error;\n  }\n}\n\n// Get user permissions\nasync function getUserPermissions(userId) {\n  try {\n    const response = await permissionsRequest(\n      `/api/dev/v1/users/${userId}/permissions`,\n      { method: 'GET' }\n    );\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching user permissions:', error);\n    showError('Failed to load user permissions');\n    throw error;\n  }\n}\n\n// Assign groups to user\nasync function assignGroupsToUser(userId, groupCodenames) {\n  try {\n    // Validate group codenames\n    const validCodenames = ['super_admin', 'admin', 'developer', 'business', 'accountant', 'user'];\n    const invalid = groupCodenames.filter(c => !validCodenames.includes(c));\n    if (invalid.length > 0) {\n      throw new Error(`Invalid group codenames: ${invalid.join(', ')}`);\n    }\n    \n    const response = await permissionsRequest(\n      `/api/dev/v1/users/${userId}/groups`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ group_codenames: groupCodenames })\n      }\n    );\n    \n    if (response && response.data) {\n      showNotification('Groups assigned successfully');\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error assigning groups:', error);\n    showError(error.message || 'Failed to assign groups');\n    throw error;\n  }\n}\n\n// Get my groups (current user)\nasync function getMyGroups() {\n  try {\n    const response = await permissionsRequest('/api/dev/v1/users/me/groups', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.groups;\n    }\n  } catch (error) {\n    console.error('Error fetching my groups:', error);\n    showError('Failed to load groups');\n    throw error;\n  }\n}\n\n// Get my permissions (current user)\nasync function getMyPermissions() {\n  try {\n    const response = await permissionsRequest('/api/dev/v1/users/me/permissions', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      return response.data.permissions;\n    }\n  } catch (error) {\n    console.error('Error fetching my permissions:', error);\n    showError('Failed to load permissions');\n    throw error;\n  }\n}\n```\n\n### Complete Permissions Manager Component\n\n```javascript\n// Complete Permissions Manager Class\nclass PermissionsManager {\n  constructor() {\n    this.permissions = [];\n    this.groups = [];\n    this.userPermissions = null;\n    this.userGroups = null;\n  }\n  \n  async init() {\n    try {\n      // Load permissions and groups\n      await Promise.all([\n        this.loadPermissions(),\n        this.loadGroups(),\n        this.loadMyPermissions(),\n        this.loadMyGroups()\n      ]);\n    } catch (error) {\n      console.error('Failed to initialize permissions manager:', error);\n      showError('Failed to load permissions data');\n    }\n  }\n  \n  async loadPermissions() {\n    try {\n      this.permissions = await getPermissions();\n      this.renderPermissions();\n      return this.permissions;\n    } catch (error) {\n      console.error('Failed to load permissions:', error);\n      return [];\n    }\n  }\n  \n  async loadGroups() {\n    try {\n      this.groups = await getGroups();\n      this.renderGroups();\n      return this.groups;\n    } catch (error) {\n      console.error('Failed to load groups:', error);\n      return [];\n    }\n  }\n  \n  async loadMyPermissions() {\n    try {\n      this.userPermissions = await getMyPermissions();\n      this.renderMyPermissions();\n      return this.userPermissions;\n    } catch (error) {\n      console.error('Failed to load my permissions:', error);\n      return [];\n    }\n  }\n  \n  async loadMyGroups() {\n    try {\n      this.userGroups = await getMyGroups();\n      this.renderMyGroups();\n      return this.userGroups;\n    } catch (error) {\n      console.error('Failed to load my groups:', error);\n      return [];\n    }\n  }\n  \n  renderPermissions() {\n    const container = document.getElementById('permissions-list');\n    if (!container) return;\n    \n    container.innerHTML = this.permissions.map(perm => `\n      <div class=\"permission-item\">\n        <h4>${perm.name}</h4>\n        <code>${perm.codename}</code>\n        <p>${perm.description || ''}</p>\n        <span class=\"category\">${perm.category || 'uncategorized'}</span>\n        <button onclick=\"permissionsManager.editPermission('${perm.permission_id}')\">Edit</button>\n        <button onclick=\"permissionsManager.deletePermission('${perm.permission_id}')\">Delete</button>\n      </div>\n    `).join('');\n  }\n  \n  renderGroups() {\n    const container = document.getElementById('groups-list');\n    if (!container) return;\n    \n    container.innerHTML = this.groups.map(group => `\n      <div class=\"group-item\">\n        <h4>${group.name}</h4>\n        <code>${group.codename}</code>\n        <p>${group.description || ''}</p>\n        <div class=\"permissions-count\">\n          ${group.permissions?.length || 0} permissions\n        </div>\n        <button onclick=\"permissionsManager.editGroup('${group.group_id}')\">Edit</button>\n        <button onclick=\"permissionsManager.deleteGroup('${group.group_id}')\">Delete</button>\n      </div>\n    `).join('');\n  }\n  \n  renderMyPermissions() {\n    const container = document.getElementById('my-permissions');\n    if (!container) return;\n    \n    if (this.userPermissions && this.userPermissions.length > 0) {\n      container.innerHTML = this.userPermissions.map(perm => `\n        <div class=\"permission-badge\">${perm.name} (${perm.codename})</div>\n      `).join('');\n    } else {\n      container.innerHTML = '<p>No permissions assigned</p>';\n    }\n  }\n  \n  renderMyGroups() {\n    const container = document.getElementById('my-groups');\n    if (!container) return;\n    \n    if (this.userGroups && this.userGroups.length > 0) {\n      container.innerHTML = this.userGroups.map(group => `\n        <div class=\"group-badge\">${group.name} (${group.codename})</div>\n      `).join('');\n    } else {\n      container.innerHTML = '<p>No groups assigned</p>';\n    }\n  }\n  \n  async createPermission(permissionData) {\n    try {\n      const permission = await createPermission(permissionData);\n      await this.loadPermissions();\n      return permission;\n    } catch (error) {\n      console.error('Failed to create permission:', error);\n      throw error;\n    }\n  }\n  \n  async updatePermission(permissionId, updateData) {\n    try {\n      const permission = await updatePermission(permissionId, updateData);\n      await this.loadPermissions();\n      return permission;\n    } catch (error) {\n      console.error('Failed to update permission:', error);\n      throw error;\n    }\n  }\n  \n  async deletePermission(permissionId) {\n    try {\n      await deletePermission(permissionId);\n      await this.loadPermissions();\n    } catch (error) {\n      console.error('Failed to delete permission:', error);\n      throw error;\n    }\n  }\n  \n  async createGroup(groupData) {\n    try {\n      const group = await createGroup(groupData);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to create group:', error);\n      throw error;\n    }\n  }\n  \n  async updateGroup(groupId, updateData) {\n    try {\n      const group = await updateGroup(groupId, updateData);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to update group:', error);\n      throw error;\n    }\n  }\n  \n  async deleteGroup(groupId) {\n    try {\n      await deleteGroup(groupId);\n      await this.loadGroups();\n    } catch (error) {\n      console.error('Failed to delete group:', error);\n      throw error;\n    }\n  }\n  \n  async assignPermissionsToGroup(groupId, permissionIds) {\n    try {\n      const group = await assignPermissionsToGroup(groupId, permissionIds);\n      await this.loadGroups();\n      return group;\n    } catch (error) {\n      console.error('Failed to assign permissions:', error);\n      throw error;\n    }\n  }\n}\n\n// Initialize permissions manager\ndocument.addEventListener('DOMContentLoaded', () => {\n  window.permissionsManager = new PermissionsManager();\n  permissionsManager.init();\n});\n```\n\n### Permission Checking Utility\n\n```javascript\n// Check if user has a specific permission\nasync function hasPermission(codename) {\n  try {\n    const permissions = await getMyPermissions();\n    return permissions.some(perm => perm.codename === codename);\n  } catch (error) {\n    console.error('Error checking permission:', error);\n    return false;\n  }\n}\n\n// Check if user has any of the specified permissions\nasync function hasAnyPermission(codenames) {\n  try {\n    const permissions = await getMyPermissions();\n    const permissionCodenames = permissions.map(p => p.codename);\n    return codenames.some(codename => permissionCodenames.includes(codename));\n  } catch (error) {\n    console.error('Error checking permissions:', error);\n    return false;\n  }\n}\n\n// Check if user has all of the specified permissions\nasync function hasAllPermissions(codenames) {\n  try {\n    const permissions = await getMyPermissions();\n    const permissionCodenames = permissions.map(p => p.codename);\n    return codenames.every(codename => permissionCodenames.includes(codename));\n  } catch (error) {\n    console.error('Error checking permissions:', error);\n    return false;\n  }\n}\n\n// Conditionally render UI based on permissions\nasync function renderPermissionBasedUI() {\n  const canViewDashboard = await hasPermission('view_dashboard');\n  const canEditProfile = await hasPermission('edit_profile');\n  \n  if (canViewDashboard) {\n    document.getElementById('dashboard-link').style.display = 'block';\n  }\n  \n  if (canEditProfile) {\n    document.getElementById('edit-profile-btn').style.display = 'block';\n  }\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all permission and group management endpoints:\n\n### Endpoints Covered:\n1. âœ… **Get All Permissions** - List all permissions\n2. âœ… **Get Permission by ID** - Get specific permission\n3. âœ… **Create Permission** - Create new permission\n4. âœ… **Update Permission** - Update existing permission\n5. âœ… **Delete Permission** - Delete permission\n6. âœ… **Get All Groups** - List all groups with permissions\n7. âœ… **Get Group by ID** - Get specific group\n8. âœ… **Create Group** - Create new group\n9. âœ… **Update Group** - Update existing group\n10. âœ… **Delete Group** - Delete group\n11. âœ… **Assign Permissions to Group** - Assign permissions to a group\n12. âœ… **Get User Groups** - Get groups for a user\n13. âœ… **Get User Permissions** - Get permissions for a user\n14. âœ… **Assign Groups to User** - Assign groups to a user\n15. âœ… **Get My Groups** - Get current user's groups\n16. âœ… **Get My Permissions** - Get current user's permissions\n\n### Documentation Sections:\n- âœ… Overview and RBAC architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices\n- âœ… Complete client-side implementation examples\n- âœ… Permissions Manager component\n- âœ… Permission checking utilities\n\n### Key Features:\n- **Role-Based Access Control (RBAC)** - Comprehensive permission system\n- **Group Management** - Organize permissions into groups\n- **User Assignment** - Assign groups to users\n- **Permission Aggregation** - User permissions from all groups\n- **System Groups Protection** - System groups cannot be deleted\n- **Client-side examples** - Ready-to-use JavaScript code\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Dashboard & Analytics",
			"item": [
				{
					"name": "overview",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-status",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/auth/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"auth",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-type",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/users-by-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"users-by-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-auth-type",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/users-by-auth-type",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"users-by-auth-type"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-country",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/users-by-country",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"users-by-country"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "users-by-language",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/users-by-language",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"users-by-language"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "user-growth",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/user-growth",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"user-growth"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "role-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/role-statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"role-statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "recent-sign-ins",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/recent-sign-ins",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"recent-sign-ins"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "all-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/all-statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"all-statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "activity-statistics",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/activity/statistics",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"activity",
								"statistics"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Dashboard Router\n\n> **Complete Documentation for Dashboard Analytics and Statistics Endpoints**\n\nThis router provides comprehensive dashboard statistics and analytics for user management, including user counts, growth metrics, role statistics, and sign-in analytics.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Dashboard Overview](#dashboard-overview)\n  - [Users by Status](#users-by-status)\n  - [Users by Type](#users-by-type)\n  - [Users by Auth Type](#users-by-auth-type)\n  - [Users by Country](#users-by-country)\n  - [Users by Language](#users-by-language)\n  - [User Growth](#user-growth)\n  - [Role Statistics](#role-statistics)\n  - [Recent Sign-ins](#recent-sign-ins)\n  - [All Statistics](#all-statistics)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n\n## Overview\n\nThe Dashboard router provides analytics and statistics endpoints for monitoring user data, growth metrics, and system health. These endpoints are essential for:\n- **Administrative Dashboards**: Display key metrics and KPIs\n- **User Analytics**: Track user growth and demographics\n- **System Monitoring**: Monitor user activity and engagement\n- **Reporting**: Generate reports for stakeholders\n\n**Base Path:** `/{MODE}/dashboard`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** All endpoints require `view_dashboard` permission\n\n## Endpoints\n\n### Dashboard Overview\n\n**Endpoint:** `GET /{MODE}/dashboard/overview`\n\n**Description:** Returns comprehensive dashboard overview statistics including total users, active users, verified users, and new user counts.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_dashboard`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Dashboard overview retrieved successfully\",\n  \"data\": {\n    \"overview\": {\n      \"total_users\": 1000,\n      \"active_users\": 850,\n      \"verified_users\": 800,\n      \"email_verified\": 750,\n      \"phone_verified\": 700,\n      \"new_users\": {\n        \"today\": 10,\n        \"this_week\": 50,\n        \"this_month\": 200\n      },\n      \"users_with_sign_in\": 600\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º Today (00:00:00)\n   â”‚   â”œâ”€â–º Tomorrow (00:00:00)\n   â”‚   â”œâ”€â–º Week Ago (7 days)\n   â”‚   â””â”€â–º Month Start (1st of month)\n   â”‚\n   â”œâ”€â–º Execute Parallel Queries\n   â”‚   â”œâ”€â–º Total Users Count\n   â”‚   â”œâ”€â–º Active Users Count (is_active = true)\n   â”‚   â”œâ”€â–º Verified Users Count (is_verified = true)\n   â”‚   â”œâ”€â–º Email Verified Count\n   â”‚   â”œâ”€â–º Phone Verified Count\n   â”‚   â”œâ”€â–º New Users Today\n   â”‚   â”œâ”€â–º New Users This Week\n   â”‚   â”œâ”€â–º New Users This Month\n   â”‚   â””â”€â–º Users With Sign-in (last_sign_in_at not null)\n   â”‚\n   â””â”€â–º Return Aggregated Statistics\n```\n\n**Metrics Explained:**\n- `total_users`: Total number of registered users\n- `active_users`: Users with `is_active = true`\n- `verified_users`: Users with `is_verified = true`\n- `email_verified`: Users with verified email addresses\n- `phone_verified`: Users with verified phone numbers\n- `new_users.today`: Users created today\n- `new_users.this_week`: Users created in last 7 days\n- `new_users.this_month`: Users created this month\n- `users_with_sign_in`: Users who have signed in at least once\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º User navigates to dashboard page\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Add token to Authorization header or X-Session-Token header\n  â””â”€â–º Prepare GET request to /{MODE}/dashboard/overview\n\nStep 2: Client sends request\n  GET /{MODE}/dashboard/overview\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Display dashboard metrics in UI\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message, log error\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract overview statistics from response.data.overview\n  â”œâ”€â–º Update dashboard cards/widgets with metrics\n  â”œâ”€â–º Format numbers (e.g., 1000 â†’ \"1,000\")\n  â””â”€â–º Display charts/graphs if applicable\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â””â”€â–º Extract user from token\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_dashboard\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Calculate date boundaries\n  â”œâ”€â–º today = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)\n  â”œâ”€â–º tomorrow = today + timedelta(days=1)\n  â”œâ”€â–º week_ago = datetime.now() - timedelta(days=7)\n  â””â”€â–º month_start = datetime.now().replace(day=1, hour=0, minute=0, second=0, microsecond=0)\n\nStep 4: Execute database queries\n  â”œâ”€â–º Total Users: SELECT COUNT(*) FROM public.\"user\"\n  â”œâ”€â–º Active Users: SELECT COUNT(*) WHERE is_active = TRUE\n  â”œâ”€â–º Verified Users: SELECT COUNT(*) WHERE is_verified = TRUE\n  â”œâ”€â–º Email Verified: SELECT COUNT(*) WHERE is_email_verified = TRUE\n  â”œâ”€â–º Phone Verified: SELECT COUNT(*) WHERE is_phone_verified = TRUE\n  â”œâ”€â–º New Users Today: SELECT COUNT(*) WHERE created_at >= today AND created_at < tomorrow\n  â”œâ”€â–º New Users Week: SELECT COUNT(*) WHERE created_at >= week_ago\n  â”œâ”€â–º New Users Month: SELECT COUNT(*) WHERE created_at >= month_start\n  â””â”€â–º Users With Sign-in: SELECT COUNT(*) WHERE last_sign_in_at IS NOT NULL\n\nStep 5: Aggregate results\n  â”œâ”€â–º Combine all query results\n  â”œâ”€â–º Structure data into overview object\n  â””â”€â–º Format new_users as nested object\n\nStep 6: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include overview statistics in data.overview\n  â””â”€â–º Return response with user's language preference\n\nStep 7: Error handling\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Error Responses:**\n\n```json\n// 401 - Unauthorized\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Authentication required\",\n  \"error\": {\n    \"code\": \"UNAUTHORIZED\",\n    \"details\": {\n      \"message\": \"Invalid or missing token\"\n    }\n  }\n}\n\n// 403 - Forbidden\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"view_dashboard\"\n    }\n  }\n}\n\n// 500 - Server Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Dashboard error\",\n  \"error\": {\n    \"code\": \"DASHBOARD_ERROR\",\n    \"details\": {\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n### Users by Status\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-status`\n\n**Description:** Returns count of users grouped by status (ACTIVE, INACTIVE, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by status retrieved successfully\",\n  \"data\": {\n    \"users_by_status\": [\n      { \"status\": \"ACTIVE\", \"count\": 850 },\n      { \"status\": \"INACTIVE\", \"count\": 150 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Status\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['status'] })\n   â”‚\n   â”œâ”€â–º Count Users per Status\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Status Statistics\n```\n\n**Status Values:**\n- `ACTIVE`: Active users\n- `INACTIVE`: Inactive users\n- Other custom statuses as defined in the system\n\n---\n\n### Users by Type\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-type`\n\n**Description:** Returns count of users grouped by user_type (customer, business, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by type retrieved successfully\",\n  \"data\": {\n    \"users_by_type\": [\n      { \"user_type\": \"customer\", \"count\": 800 },\n      { \"user_type\": \"business\", \"count\": 200 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Type\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['user_type'] })\n   â”‚\n   â”œâ”€â–º Count Users per Type\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Type Statistics\n```\n\n**User Types:**\n- `customer`: Regular customers\n- `business`: Business accounts\n- Other custom types as defined in the system\n\n---\n\n### Users by Auth Type\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-auth-type`\n\n**Description:** Returns count of users grouped by authentication type (email, phone, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by auth type retrieved successfully\",\n  \"data\": {\n    \"users_by_auth_type\": [\n      { \"auth_type\": \"email\", \"count\": 600 },\n      { \"auth_type\": \"phone\", \"count\": 400 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Auth Type\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['auth_type'] })\n   â”‚\n   â”œâ”€â–º Count Users per Auth Type\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Auth Type Statistics\n```\n\n**Auth Types:**\n- `email`: Email-based authentication\n- `phone`: Phone-based authentication\n\n---\n\n### Users by Country\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-country`\n\n**Description:** Returns count of users grouped by country (top 20 countries).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by country retrieved successfully\",\n  \"data\": {\n    \"users_by_country\": [\n      { \"country\": \"US\", \"count\": 300 },\n      { \"country\": \"UK\", \"count\": 200 },\n      { \"country\": \"CA\", \"count\": 150 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Country\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['country'], take: 20 })\n   â”‚\n   â”œâ”€â–º Count Users per Country\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Top 20 Countries\n```\n\n**Note:** Returns top 20 countries by user count.\n\n---\n\n### Users by Language\n\n**Endpoint:** `GET /{MODE}/dashboard/users-by-language`\n\n**Description:** Returns count of users grouped by language preference.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User statistics by language retrieved successfully\",\n  \"data\": {\n    \"users_by_language\": [\n      { \"language\": \"en\", \"count\": 700 },\n      { \"language\": \"ar\", \"count\": 300 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Group Users by Language\n   â”‚   â””â”€â–º prisma.user.groupBy({ by: ['language'] })\n   â”‚\n   â”œâ”€â–º Count Users per Language\n   â”‚   â””â”€â–º Order by count (descending)\n   â”‚\n   â””â”€â–º Return Language Statistics\n```\n\n**Language Codes:** ISO 639-1 codes (en, ar, etc.)\n\n---\n\n### User Growth\n\n**Endpoint:** `GET /{MODE}/dashboard/user-growth`\n\n**Description:** Returns user sign-up statistics over time (daily, weekly, monthly).\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_dashboard`\n\n**Query Parameters:**\n- `period` (optional): Time period for growth statistics\n  - `daily` (default): Daily growth\n  - `weekly`: Weekly growth\n  - `monthly`: Monthly growth\n- `days` (optional): Number of days to look back (for daily period, default: 30, max: 365)\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Example:**\n```http\nGET /dev/v1/dashboard/user-growth?period=daily&days=30 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"User growth statistics retrieved successfully\",\n  \"data\": {\n    \"period\": \"daily\",\n    \"growth\": [\n      { \"period\": \"2025-01-01\", \"count\": 10 },\n      { \"period\": \"2025-01-02\", \"count\": 15 },\n      { \"period\": \"2025-01-03\", \"count\": 12 }\n    ]\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â”œâ”€â–º period: daily/weekly/monthly (default: daily)\n   â”‚   â””â”€â–º days: number (default: 30, max: 365)\n   â”‚\n   â”œâ”€â–º Execute Raw SQL Query\n   â”‚   â”œâ”€â–º Daily: DATE(created_at) with last N days\n   â”‚   â”œâ”€â–º Weekly: DATE_TRUNC('week', created_at) with last 12 weeks\n   â”‚   â””â”€â–º Monthly: DATE_TRUNC('month', created_at) with last 12 months\n   â”‚\n   â”œâ”€â–º Format Results\n   â”‚   â””â”€â–º Map to period and count\n   â”‚\n   â””â”€â–º Return Growth Statistics\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º User selects time period (daily/weekly/monthly)\n  â”œâ”€â–º User selects number of days (for daily period)\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â”œâ”€â–º Build query string with parameters\n  â””â”€â–º Prepare GET request to /{MODE}/dashboard/user-growth\n\nStep 2: Client sends request\n  GET /{MODE}/dashboard/user-growth?period=daily&days=30\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Process growth data\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract growth array from response.data.growth\n  â”œâ”€â–º Format dates for display\n  â”œâ”€â–º Render line chart or bar chart\n  â””â”€â–º Update UI with growth statistics\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract query parameters (period, days)\n  â””â”€â–º Validate parameters (period: daily/weekly/monthly, days: 1-365)\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"view_dashboard\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Build SQL query based on period\n  â”œâ”€â–º If period = \"daily\":\n  â”‚   â”œâ”€â–º Limit days to 1-365 range\n  â”‚   â””â”€â–º Query: SELECT DATE(created_at) as date, COUNT(*) \n  â”‚       WHERE created_at >= CURRENT_DATE - INTERVAL '{days} days'\n  â”‚       GROUP BY DATE(created_at) ORDER BY date ASC\n  â”‚\n  â”œâ”€â–º If period = \"weekly\":\n  â”‚   â””â”€â–º Query: SELECT DATE_TRUNC('week', created_at) as week, COUNT(*)\n  â”‚       WHERE created_at >= CURRENT_DATE - INTERVAL '12 weeks'\n  â”‚       GROUP BY DATE_TRUNC('week', created_at) ORDER BY week ASC\n  â”‚\n  â””â”€â–º If period = \"monthly\":\n      â””â”€â–º Query: SELECT DATE_TRUNC('month', created_at) as month, COUNT(*)\n          WHERE created_at >= CURRENT_DATE - INTERVAL '12 months'\n          GROUP BY DATE_TRUNC('month', created_at) ORDER BY month ASC\n\nStep 4: Execute database query\n  â”œâ”€â–º Execute SQL query\n  â”œâ”€â–º Fetch all rows\n  â””â”€â–º Process results\n\nStep 5: Format results\n  â”œâ”€â–º Convert dates to ISO format\n  â”œâ”€â–º Structure as array of {period, count} objects\n  â””â”€â–º Ensure count is integer\n\nStep 6: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include period type and growth array\n  â””â”€â–º Return response with user's language preference\n\nStep 7: Error handling\n  â”œâ”€â–º Invalid parameters: Return 400\n  â”œâ”€â–º Database error: Log error, return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Use Cases:**\n- Growth trend analysis\n- User acquisition metrics\n- Time-series visualization\n- Reporting\n\n---\n\n### Role Statistics\n\n**Endpoint:** `GET /{MODE}/dashboard/role-statistics`\n\n**Description:** Returns count of users by role (admin, business, developer, etc.).\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Role statistics retrieved successfully\",\n  \"data\": {\n    \"role_statistics\": {\n      \"superusers\": 5,\n      \"admins\": 10,\n      \"business\": 50,\n      \"developers\": 20,\n      \"accountants\": 15,\n      \"regular_users\": 900\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Get All Users\n   â”‚   â””â”€â–º prisma.user.findMany({ select: { user_id: true } })\n   â”‚\n   â”œâ”€â–º For Each User\n   â”‚   â”œâ”€â–º Get User Groups\n   â”‚   â”‚   â””â”€â–º getUserGroups(user_id)\n   â”‚   â”‚\n   â”‚   â””â”€â–º Count by Group Codename\n   â”‚       â”œâ”€â–º super_admin\n   â”‚       â”œâ”€â–º admin\n   â”‚       â”œâ”€â–º business\n   â”‚       â”œâ”€â–º developer\n   â”‚       â”œâ”€â–º accountant\n   â”‚       â””â”€â–º user\n   â”‚\n   â””â”€â–º Return Role Statistics\n```\n\n**Note:** This endpoint iterates through all users to count roles. For large user bases, consider caching or optimization.\n\n**Roles:**\n- `superusers`: Users with super_admin group\n- `admins`: Users with admin group\n- `business`: Users with business group\n- `developers`: Users with developer group\n- `accountants`: Users with accountant group\n- `regular_users`: Users with user group\n\n---\n\n### Recent Sign-ins\n\n**Endpoint:** `GET /{MODE}/dashboard/recent-sign-ins`\n\n**Description:** Returns users who signed in recently within specified hours.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Query Parameters:**\n- `hours` (optional): Number of hours to look back (default: 24, max: 168)\n\n**Request:**\n```http\nGET /dev/v1/dashboard/recent-sign-ins?hours=24 HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Recent sign-in statistics retrieved successfully\",\n  \"data\": {\n    \"recent_sign_ins\": {\n      \"total_with_sign_in\": 600,\n      \"last_hour\": 10,\n      \"last_24_hours\": 100,\n      \"today\": 150\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º hours: number (default: 24, max: 168)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º One Hour Ago\n   â”‚   â”œâ”€â–º N Hours Ago (from query)\n   â”‚   â””â”€â–º Today (00:00:00)\n   â”‚\n   â”œâ”€â–º Execute Parallel Queries\n   â”‚   â”œâ”€â–º Total Users With Sign-in (last_sign_in_at not null)\n   â”‚   â”œâ”€â–º Sign-ins Last Hour\n   â”‚   â”œâ”€â–º Sign-ins Last N Hours\n   â”‚   â””â”€â–º Sign-ins Today\n   â”‚\n   â””â”€â–º Return Sign-in Statistics\n```\n\n**Metrics:**\n- `total_with_sign_in`: Total users who have signed in at least once\n- `last_hour`: Users who signed in within last hour\n- `last_{N}_hours`: Users who signed in within last N hours\n- `today`: Users who signed in today\n\n---\n\n### All Statistics\n\n**Endpoint:** `GET /{MODE}/dashboard/all-statistics`\n\n**Description:** Returns comprehensive dashboard statistics including all metrics from other endpoints.\n\n**Authentication:** Required\n**Permission:** `view_dashboard`\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"All dashboard statistics retrieved successfully\",\n  \"data\": {\n    \"overview\": {\n      \"total_users\": 1000,\n      \"active_users\": 850,\n      \"verified_users\": 800,\n      \"email_verified\": 750,\n      \"phone_verified\": 700,\n      \"new_users\": {\n        \"today\": 10,\n        \"this_week\": 50,\n        \"this_month\": 200\n      }\n    },\n    \"by_status\": [\n      { \"status\": \"ACTIVE\", \"count\": 850 },\n      { \"status\": \"INACTIVE\", \"count\": 150 }\n    ],\n    \"by_type\": [\n      { \"user_type\": \"customer\", \"count\": 800 },\n      { \"user_type\": \"business\", \"count\": 200 }\n    ],\n    \"by_auth_type\": [\n      { \"auth_type\": \"email\", \"count\": 600 },\n      { \"auth_type\": \"phone\", \"count\": 400 }\n    ],\n    \"roles\": {\n      \"superusers\": 5,\n      \"admins\": 10,\n      \"business\": 50,\n      \"developers\": 20,\n      \"accountants\": 15,\n      \"regular_users\": 900\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (view_dashboard)\n   â”‚\n   â”œâ”€â–º Calculate Date Boundaries\n   â”‚   â”œâ”€â–º Today, Tomorrow, Week Ago, Month Start\n   â”‚\n   â”œâ”€â–º Execute All Queries in Parallel\n   â”‚   â”œâ”€â–º Overview Statistics (9 queries)\n   â”‚   â”œâ”€â–º Users by Status (groupBy)\n   â”‚   â”œâ”€â–º Users by Type (groupBy)\n   â”‚   â”œâ”€â–º Users by Auth Type (groupBy)\n   â”‚   â””â”€â–º Role Statistics (iterate users)\n   â”‚\n   â”œâ”€â–º Aggregate All Results\n   â”‚\n   â””â”€â–º Return Comprehensive Statistics\n```\n\n**Use Cases:**\n- Dashboard initialization\n- Comprehensive reporting\n- Single API call for all metrics\n- Admin panel data loading\n\n---\n\n## Workflows\n\n### Complete Dashboard Data Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Dashboard Statistics Request                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚  Validate Auth  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Check Permission â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Single Metric â”‚         â”‚ All Metrics   â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â–¼                         â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Execute Query â”‚         â”‚ Parallel Queriesâ”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                         â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Format Results  â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Return Response â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**401 Unauthorized:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Authentication required\",\n  \"error\": \"Invalid or missing token\",\n  \"statusCode\": 401\n}\n```\n\n**403 Forbidden:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires view_dashboard permission\",\n  \"statusCode\": 403\n}\n```\n\n**500 Internal Server Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Dashboard error\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n```\n\n### Error Handling Workflow\n\n```\n1. Error Occurs\n   â”‚\n   â”œâ”€â–º Log Error\n   â”‚   â””â”€â–º Winston Logger with module: 'Dashboard'\n   â”‚\n   â”œâ”€â–º Format Error Response\n   â”‚   â””â”€â–º ERROR.fromMap('DASHBOARD_ERROR')\n   â”‚\n   â””â”€â–º Return Error Response\n       â””â”€â–º Appropriate Status Code\n```\n\n---\n\n## Best Practices\n\n1. **Caching**: Consider caching dashboard statistics for better performance\n2. **Pagination**: For large datasets, implement pagination\n3. **Optimization**: Role statistics endpoint may be slow for large user bases - consider optimization\n4. **Rate Limiting**: Implement rate limiting for dashboard endpoints\n5. **Data Aggregation**: Use database aggregation functions for better performance\n6. **Date Boundaries**: Always use proper date boundaries for time-based queries\n7. **Parallel Queries**: Use Promise.all() for parallel queries when possible\n8. **Error Handling**: Handle database errors gracefully\n\n---\n\n## Performance Considerations\n\n1. **Role Statistics**: This endpoint iterates through all users - consider caching or background jobs\n2. **User Growth**: Raw SQL queries are used for date aggregations - ensure proper indexing\n3. **All Statistics**: Combines multiple queries - may be slower, consider caching\n4. **Database Indexing**: Ensure proper indexes on:\n   - `created_at` (for growth queries)\n   - `last_sign_in_at` (for sign-in queries)\n   - `status`, `user_type`, `auth_type`, `country`, `language` (for groupBy queries)\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for dashboard endpoints\nasync function dashboardRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to view dashboard');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success) {\n    throw new Error(data.error?.message || 'Dashboard request failed');\n  }\n  \n  return data;\n}\n```\n\n### Dashboard Overview\n\n```javascript\n// Get dashboard overview statistics\nasync function getDashboardOverview() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/overview', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const overview = response.data.overview;\n      \n      // Update UI with metrics\n      updateMetricCard('total-users', overview.total_users);\n      updateMetricCard('active-users', overview.active_users);\n      updateMetricCard('verified-users', overview.verified_users);\n      updateMetricCard('email-verified', overview.email_verified);\n      updateMetricCard('phone-verified', overview.phone_verified);\n      updateMetricCard('new-users-today', overview.new_users.today);\n      updateMetricCard('new-users-week', overview.new_users.this_week);\n      updateMetricCard('new-users-month', overview.new_users.this_month);\n      updateMetricCard('users-with-signin', overview.users_with_sign_in);\n      \n      return overview;\n    }\n  } catch (error) {\n    console.error('Error fetching dashboard overview:', error);\n    showError('Failed to load dashboard overview');\n    throw error;\n  }\n}\n\n// Helper function to update metric cards\nfunction updateMetricCard(elementId, value) {\n  const element = document.getElementById(elementId);\n  if (element) {\n    element.textContent = formatNumber(value);\n  }\n}\n\n// Format numbers with commas\nfunction formatNumber(num) {\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n}\n```\n\n### Users by Status\n\n```javascript\n// Get users grouped by status\nasync function getUsersByStatus() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/users-by-status', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const stats = response.data.users_by_status;\n      \n      // Update chart or table\n      renderStatusChart(stats);\n      \n      return stats;\n    }\n  } catch (error) {\n    console.error('Error fetching users by status:', error);\n    showError('Failed to load user status statistics');\n    throw error;\n  }\n}\n\n// Render status chart (example using Chart.js)\nfunction renderStatusChart(stats) {\n  const ctx = document.getElementById('status-chart').getContext('2d');\n  new Chart(ctx, {\n    type: 'pie',\n    data: {\n      labels: stats.map(s => s.status),\n      datasets: [{\n        data: stats.map(s => s.count),\n        backgroundColor: ['#4CAF50', '#F44336', '#FF9800', '#2196F3']\n      }]\n    }\n  });\n}\n```\n\n### User Growth\n\n```javascript\n// Get user growth statistics\nasync function getUserGrowth(period = 'daily', days = 30) {\n  try {\n    const url = `/api/v1/dashboard/user-growth?period=${period}&days=${days}`;\n    const response = await dashboardRequest(url, {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const growth = response.data.growth;\n      \n      // Render growth chart\n      renderGrowthChart(growth, period);\n      \n      return growth;\n    }\n  } catch (error) {\n    console.error('Error fetching user growth:', error);\n    showError('Failed to load user growth statistics');\n    throw error;\n  }\n}\n\n// Render growth line chart\nfunction renderGrowthChart(growth, period) {\n  const ctx = document.getElementById('growth-chart').getContext('2d');\n  new Chart(ctx, {\n    type: 'line',\n    data: {\n      labels: growth.map(g => formatPeriod(g.period, period)),\n      datasets: [{\n        label: 'New Users',\n        data: growth.map(g => g.count),\n        borderColor: '#2196F3',\n        tension: 0.1\n      }]\n    },\n    options: {\n      responsive: true,\n      scales: {\n        y: {\n          beginAtZero: true\n        }\n      }\n    }\n  });\n}\n\n// Format period label based on type\nfunction formatPeriod(period, type) {\n  const date = new Date(period);\n  if (type === 'daily') {\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n  } else if (type === 'weekly') {\n    return `Week of ${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;\n  } else {\n    return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n  }\n}\n```\n\n### All Statistics\n\n```javascript\n// Get all dashboard statistics at once\nasync function getAllDashboardStatistics() {\n  try {\n    const response = await dashboardRequest('/api/v1/dashboard/all-statistics', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const stats = response.data;\n      \n      // Update all dashboard sections\n      updateOverviewSection(stats.overview);\n      updateStatusSection(stats.by_status);\n      updateTypeSection(stats.by_type);\n      updateAuthTypeSection(stats.by_auth_type);\n      updateRolesSection(stats.roles);\n      \n      return stats;\n    }\n  } catch (error) {\n    console.error('Error fetching all statistics:', error);\n    showError('Failed to load dashboard statistics');\n    throw error;\n  }\n}\n```\n\n### Complete Dashboard Component\n\n```javascript\n// Complete Dashboard Manager Class\nclass DashboardManager {\n  constructor() {\n    this.stats = null;\n    this.refreshInterval = null;\n  }\n  \n  async init() {\n    try {\n      // Load all statistics on initialization\n      await this.loadAllStatistics();\n      \n      // Set up auto-refresh (every 5 minutes)\n      this.startAutoRefresh(5 * 60 * 1000);\n      \n      // Set up manual refresh button\n      document.getElementById('refresh-dashboard').addEventListener('click', () => {\n        this.loadAllStatistics();\n      });\n    } catch (error) {\n      console.error('Failed to initialize dashboard:', error);\n      showError('Failed to load dashboard');\n    }\n  }\n  \n  async loadAllStatistics() {\n    try {\n      showLoading('Loading dashboard...');\n      \n      const stats = await getAllDashboardStatistics();\n      this.stats = stats;\n      \n      this.renderDashboard();\n      hideLoading();\n    } catch (error) {\n      hideLoading();\n      showError('Failed to load dashboard statistics');\n    }\n  }\n  \n  renderDashboard() {\n    if (!this.stats) return;\n    \n    // Render overview cards\n    this.renderOverviewCards();\n    \n    // Render charts\n    this.renderCharts();\n    \n    // Render tables\n    this.renderTables();\n  }\n  \n  renderOverviewCards() {\n    const overview = this.stats.overview;\n    \n    // Update metric cards\n    document.getElementById('total-users').textContent = formatNumber(overview.total_users);\n    document.getElementById('active-users').textContent = formatNumber(overview.active_users);\n    document.getElementById('verified-users').textContent = formatNumber(overview.verified_users);\n    document.getElementById('new-users-today').textContent = formatNumber(overview.new_users.today);\n  }\n  \n  renderCharts() {\n    // Render status pie chart\n    renderStatusChart(this.stats.by_status);\n    \n    // Render type bar chart\n    renderTypeChart(this.stats.by_type);\n    \n    // Render growth line chart\n    getUserGrowth('daily', 30).then(growth => {\n      renderGrowthChart(growth, 'daily');\n    });\n  }\n  \n  renderTables() {\n    // Render status table\n    renderTable('status-table', this.stats.by_status, ['status', 'count']);\n    \n    // Render type table\n    renderTable('type-table', this.stats.by_type, ['user_type', 'count']);\n  }\n  \n  startAutoRefresh(interval) {\n    this.refreshInterval = setInterval(() => {\n      this.loadAllStatistics();\n    }, interval);\n  }\n  \n  stopAutoRefresh() {\n    if (this.refreshInterval) {\n      clearInterval(this.refreshInterval);\n      this.refreshInterval = null;\n    }\n  }\n}\n\n// Initialize dashboard when page loads\ndocument.addEventListener('DOMContentLoaded', () => {\n  const dashboard = new DashboardManager();\n  dashboard.init();\n});\n```\n\n### Error Handling\n\n```javascript\n// Enhanced error handling for dashboard requests\nasync function dashboardRequestWithRetry(url, options = {}, maxRetries = 3) {\n  let lastError;\n  \n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await dashboardRequest(url, options);\n    } catch (error) {\n      lastError = error;\n      \n      // Don't retry on 401 or 403 errors\n      if (error.message.includes('401') || error.message.includes('403')) {\n        throw error;\n      }\n      \n      // Wait before retry (exponential backoff)\n      await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));\n    }\n  }\n  \n  throw lastError;\n}\n```\n\n### Loading States\n\n```javascript\n// Show loading indicator\nfunction showLoading(message = 'Loading...') {\n  const loader = document.getElementById('dashboard-loader');\n  if (loader) {\n    loader.textContent = message;\n    loader.style.display = 'block';\n  }\n}\n\n// Hide loading indicator\nfunction hideLoading() {\n  const loader = document.getElementById('dashboard-loader');\n  if (loader) {\n    loader.style.display = 'none';\n  }\n}\n\n// Show error message\nfunction showError(message) {\n  const errorDiv = document.getElementById('dashboard-error');\n  if (errorDiv) {\n    errorDiv.textContent = message;\n    errorDiv.style.display = 'block';\n    \n    // Auto-hide after 5 seconds\n    setTimeout(() => {\n      errorDiv.style.display = 'none';\n    }, 5000);\n  }\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all dashboard analytics endpoints:\n\n### Endpoints Covered:\n1. âœ… **Dashboard Overview** - Comprehensive user statistics\n2. âœ… **Users by Status** - Group users by account status\n3. âœ… **Users by Type** - Group users by user type\n4. âœ… **Users by Auth Type** - Group users by authentication method\n5. âœ… **Users by Country** - Geographic distribution (top 20)\n6. âœ… **Users by Language** - Language preference distribution\n7. âœ… **User Growth** - Time-series growth statistics\n8. âœ… **Recent Sign-ins** - Sign-in activity metrics\n9. âœ… **All Statistics** - Comprehensive dashboard data\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices and performance considerations\n- âœ… Complete client-side implementation examples\n- âœ… Dashboard component examples\n\n### Key Features:\n- **Permission-based access** - All endpoints require `view_dashboard` permission\n- **Comprehensive metrics** - User counts, growth, demographics, and activity\n- **Flexible queries** - Support for different time periods and filters\n- **Performance optimized** - Efficient database queries with proper indexing\n- **Client-side examples** - Ready-to-use JavaScript code for dashboard implementation\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Health",
			"item": [
				{
					"name": "health",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/dashboard/overview",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"dashboard",
								"overview"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "health & system",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/health/system",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"health",
								"system"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				},
				{
					"name": "test-sentry",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/test-sentry",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"test-sentry"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"disabled": true
								},
								{
									"key": "page_size",
									"value": "1",
									"disabled": true
								}
							]
						}
					},
					"response": [
						{
							"name": "profile",
							"originalRequest": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{domain.com}}/{{mode}}/settings/profile",
									"host": [
										"{{domain.com}}"
									],
									"path": [
										"{{mode}}",
										"settings",
										"profile"
									],
									"query": [
										{
											"key": "page",
											"value": "1",
											"disabled": true
										},
										{
											"key": "page_size",
											"value": "1",
											"disabled": true
										}
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Server",
									"value": "openresty"
								},
								{
									"key": "Date",
									"value": "Sun, 16 Nov 2025 07:46:55 GMT"
								},
								{
									"key": "Content-Type",
									"value": "application/json",
									"description": "",
									"type": "text"
								},
								{
									"key": "Content-Length",
									"value": "994"
								},
								{
									"key": "Connection",
									"value": "keep-alive"
								},
								{
									"key": "X-XSS-Protection",
									"value": "1; mode=block"
								},
								{
									"key": "X-Content-Type-Options",
									"value": "nosniff"
								},
								{
									"key": "X-Frame-Options",
									"value": "DENY"
								},
								{
									"key": "Referrer-Policy",
									"value": "strict-origin-when-cross-origin"
								},
								{
									"key": "Permissions-Policy",
									"value": "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), fullscreen=(self)"
								},
								{
									"key": "X-Permitted-Cross-Domain-Policies",
									"value": "none"
								},
								{
									"key": "Content-Security-Policy",
									"value": "default-src 'self' https://storage.googleapis.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://cdn.tailwindcss.com https://code.jquery.com https://unpkg.com https://storage.googleapis.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://cdn.jsdelivr.net https://*.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://storage.googleapis.com https://*.googleapis.com data:; img-src 'self' data: https: blob: https://storage.googleapis.com https://*.googleapis.com https://ui-avatars.com https://upload.wikimedia.org; media-src 'self' https: blob: https://storage.googleapis.com https://*.googleapis.com; connect-src 'self' https://api.tap.company https://storage.googleapis.com https://*.googleapis.com https://cdn.jsdelivr.net wss: ws:; frame-ancestors 'none'; base-uri 'self' https://storage.googleapis.com; form-action 'self'; upgrade-insecure-requests;"
								},
								{
									"key": "X-Served-By",
									"value": "v3.staging.winsta.pro"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"id\": \"565beb6b-7b12-4a08-a775-2e8423677d1b\",\n    \"message\": \"User profile fetched successfully\",\n    \"data\": {\n        \"user_id\": \"a713d948-a6ff-4e19-b397-55a835445198\",\n        \"first_name\": \"MR\",\n        \"last_name\": \"DAS\",\n        \"email\": \"mrsuper300@gmail.com\",\n        \"phone_number\": {\n            \"phone\": \"+96598379785\"\n        },\n        \"country\": \"Nepal\",\n        \"gender\": \"Male\",\n        \"bio\": \"Full Stack Developer\",\n        \"user_name\": \"96598379785\",\n        \"show_kliky_watermark\": true,\n        \"ads_show_type\": \"public\",\n        \"auth_type\": \"phone\",\n        \"theme\": \"light\",\n        \"profile_accessibility\": \"public\",\n        \"user_type\": \"customer\",\n        \"language\": \"en\",\n        \"is_draft\": false,\n        \"is_active\": true,\n        \"is_verified\": true,\n        \"is_deleted\": false,\n        \"status\": \"Active\",\n        \"is_protected\": false,\n        \"is_trashed\": false,\n        \"last_sign_in_at\": \"2025-11-16T07:39:22.173870+00:00\",\n        \"created_at\": \"2025-11-16T06:45:02.043820+00:00\",\n        \"last_updated\": \"2025-11-16T07:40:12.063407+00:00\",\n        \"is_user\": true,\n        \"is_superuser\": false,\n        \"is_admin\": false,\n        \"is_business\": false,\n        \"is_accountant\": false,\n        \"is_developer\": false,\n        \"posts\": []\n    },\n    \"meta\": {\n        \"type\": \"dict\"\n    },\n    \"timestamp\": \"2025-11-16T07:46:55.781175Z\"\n}"
						}
					]
				}
			],
			"description": "# Health & Monitoring Router\n\n> **Complete Documentation for Health Check and System Monitoring Endpoints**\n\nThis router provides endpoints for checking API health status, system information, and testing error tracking integration.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Health Check](#health-check)\n  - [System Health Check](#system-health-check)\n  - [Database Health Check](#database-health-check)\n  - [Storage Health Check](#storage-health-check)\n  - [Test Sentry](#test-sentry)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Client-Side Implementation](#client-side-implementation)\n- [Summary](#summary)\n\n## Overview\n\nThe Health router provides monitoring and diagnostic endpoints that help track the API's operational status. These endpoints are essential for:\n- **Load Balancer Health Checks**: Verify service availability\n- **System Monitoring**: Track resource usage and system metrics\n- **Error Tracking Testing**: Validate Sentry integration\n\n**Base Path:** `/{MODE}/health` or `/health` (for basic health check)\n\n**Authentication:** Most endpoints do not require authentication (except `/test-sentry`)\n\n## Endpoints\n\n### Health Check\n\n**Endpoint:** `GET /health` or `GET /{MODE}/health`\n\n**Description:** Returns the health status of the API service with environment information. This endpoint is typically used by load balancers and monitoring systems.\n\n**Authentication:** Not required\n\n**Request Headers:**\n```\n(No authentication required)\n```\n\n**Request Example:**\n```http\nGET /health HTTP/1.1\nHost: api.example.com\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Service is healthy\",\n  \"data\": {\n    \"status\": \"ok\"\n  },\n  \"meta\": {\n    \"service\": \"nodejs-backend-with-postgresql-api\",\n    \"status\": \"ok\",\n    \"env\": {\n      \"API_VERSION\": \"1.0.0\",\n      \"API_MODE\": \"development\",\n      \"MODE\": \"dev/v1\",\n      \"UTC\": \"UTC\",\n      \"DEBUG_MODE\": \"false\",\n      \"TIMEZONE\": \"UTC\",\n      \"LOG_LEVEL\": \"info\"\n    }\n  }\n}\n```\n\n**Workflow:**\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Extract Environment Variables\n   â”‚   â”œâ”€â–º API_VERSION\n   â”‚   â”œâ”€â–º API_MODE\n   â”‚   â”œâ”€â–º MODE\n   â”‚   â”œâ”€â–º UTC\n   â”‚   â”œâ”€â–º DEBUG_MODE\n   â”‚   â”œâ”€â–º TIMEZONE\n   â”‚   â””â”€â–º LOG_LEVEL\n   â”‚\n   â”œâ”€â–º Build Response\n   â”‚   â”œâ”€â–º Status: \"ok\"\n   â”‚   â””â”€â–º Meta Information\n   â”‚\n   â””â”€â–º Return 200 OK\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Load balancer/monitoring system initiates health check\n  â”œâ”€â–º No authentication required\n  â””â”€â–º Prepare GET request to /health or /{MODE}/health\n\nStep 2: Client sends request\n  GET /health\n  Headers:\n    (No special headers required)\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Service is healthy, continue routing traffic\n  â”œâ”€â–º Error (500): Service unhealthy, remove from load balancer\n  â””â”€â–º Timeout: Service unavailable, mark as down\n\nStep 4: Client processes response\n  â”œâ”€â–º Check response.status === \"ok\"\n  â”œâ”€â–º Verify response time < threshold (e.g., 100ms)\n  â””â”€â–º Update service status in monitoring system\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request received\n  â”œâ”€â–º No authentication validation needed\n  â””â”€â–º Process request immediately\n\nStep 2: Gather environment information\n  â”œâ”€â–º Extract environment variables:\n  â”‚   â”œâ”€â–º API_VERSION\n  â”‚   â”œâ”€â–º API_MODE\n  â”‚   â”œâ”€â–º MODE\n  â”‚   â”œâ”€â–º UTC\n  â”‚   â”œâ”€â–º DEBUG_MODE\n  â”‚   â”œâ”€â–º TIMEZONE\n  â”‚   â””â”€â–º LOG_LEVEL\n  â””â”€â–º Build environment info object\n\nStep 3: Build response\n  â”œâ”€â–º Set status: \"ok\"\n  â”œâ”€â–º Include service name\n  â”œâ”€â–º Include environment information\n  â””â”€â–º Return 200 OK\n\nStep 4: Error handling\n  â”œâ”€â–º If environment variables not accessible: Return 500\n  â””â”€â–º Log any errors for debugging\n```\n\n**Use Cases:**\n- Load balancer health checks\n- Container orchestration health probes\n- Service discovery\n- Monitoring dashboards\n\n---\n\n### System Health Check\n\n**Endpoint:** `GET /{MODE}/health/system`\n\n**Description:** Returns detailed system information including CPU, memory, platform details, and environment configuration. Useful for system administrators and monitoring tools.\n\n**Authentication:** Not required\n\n**Request Headers:**\n```\n(No authentication required)\n```\n\n**Request Example:**\n```http\nGET /dev/v1/health/system HTTP/1.1\nHost: api.example.com\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"System health check completed\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"system_info\": {\n      \"platform\": \"linux\",\n      \"nodeVersion\": \"v18.0.0\",\n      \"cpuCount\": 4,\n      \"memoryTotal\": 8589934592,\n      \"memoryFree\": 4294967296,\n      \"memoryUsed\": 4294967296,\n      \"uptime\": 3600\n    },\n    \"environment\": {\n      \"API_VERSION\": \"1.0.0\",\n      \"API_MODE\": \"development\",\n      \"MODE\": \"dev/v1\",\n      \"DEBUG_MODE\": \"false\",\n      \"LOG_LEVEL\": \"info\"\n    },\n    \"timestamp\": 1704067200000\n  }\n}\n```\n\n**Response Fields:**\n- `system_info.platform`: Operating system platform (Linux, Windows, macOS)\n- `system_info.python_version`: Python version\n- `system_info.cpu_count`: Number of CPU cores\n- `system_info.memory_total`: Total system memory in bytes\n- `system_info.memory_available`: Available memory in bytes\n- `system_info.memory_percent`: Memory usage percentage\n- `system_info.disk_usage`: Disk usage percentage\n- `environment`: Environment configuration variables\n- `timestamp`: Unix timestamp of the check\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Monitoring system or admin dashboard initiates check\n  â”œâ”€â–º No authentication required\n  â””â”€â–º Prepare GET request to /{MODE}/health/system\n\nStep 2: Client sends request\n  GET /{MODE}/health/system\n  Headers:\n    (No special headers required)\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Process system information\n  â”œâ”€â–º Error (500): Log error, show error message\n  â””â”€â–º Timeout: Mark service as unavailable\n\nStep 4: Client processes data\n  â”œâ”€â–º Extract system_info from response.data\n  â”œâ”€â–º Format memory values (bytes â†’ MB/GB)\n  â”œâ”€â–º Display CPU, memory, disk usage\n  â”œâ”€â–º Update monitoring dashboard\n  â””â”€â–º Alert if thresholds exceeded\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request received\n  â”œâ”€â–º No authentication validation needed\n  â””â”€â–º Process request immediately\n\nStep 2: Gather system information\n  â”œâ”€â–º Import psutil and platform modules\n  â”œâ”€â–º Get platform information:\n  â”‚   â”œâ”€â–º platform.platform() - OS platform\n  â”‚   â””â”€â–º platform.python_version() - Python version\n  â”œâ”€â–º Get CPU information:\n  â”‚   â””â”€â–º psutil.cpu_count() - Number of CPU cores\n  â”œâ”€â–º Get memory information:\n  â”‚   â”œâ”€â–º psutil.virtual_memory().total - Total memory\n  â”‚   â”œâ”€â–º psutil.virtual_memory().available - Available memory\n  â”‚   â””â”€â–º psutil.virtual_memory().percent - Memory usage %\n  â””â”€â–º Get disk information:\n      â””â”€â–º psutil.disk_usage('/').percent - Disk usage %\n\nStep 3: Gather environment information\n  â”œâ”€â–º Extract environment variables:\n  â”‚   â”œâ”€â–º API_VERSION\n  â”‚   â”œâ”€â–º API_MODE\n  â”‚   â”œâ”€â–º MODE\n  â”‚   â”œâ”€â–º DEBUG_MODE\n  â”‚   â””â”€â–º LOG_LEVEL\n  â””â”€â–º Build environment info object\n\nStep 4: Build response\n  â”œâ”€â–º Set status: \"healthy\"\n  â”œâ”€â–º Include system_info object\n  â”œâ”€â–º Include environment information\n  â”œâ”€â–º Add timestamp\n  â””â”€â–º Return 200 OK\n\nStep 5: Error handling\n  â”œâ”€â–º If psutil not available: Return error\n  â”œâ”€â–º If system info gathering fails: Return 500\n  â””â”€â–º Log errors for debugging\n```\n\n**Workflow:**\n```\n1. Client Request\n   â”‚\n   â”œâ”€â–º Gather System Information\n   â”‚   â”œâ”€â–º Platform (process.platform)\n   â”‚   â”œâ”€â–º Node.js Version (process.version)\n   â”‚   â”œâ”€â–º CPU Count (os.cpus().length)\n   â”‚   â”œâ”€â–º Memory Stats (os.totalmem(), os.freemem())\n   â”‚   â””â”€â–º System Uptime (os.uptime())\n   â”‚\n   â”œâ”€â–º Gather Environment Info\n   â”‚   â”œâ”€â–º API_VERSION\n   â”‚   â”œâ”€â–º API_MODE\n   â”‚   â”œâ”€â–º MODE\n   â”‚   â”œâ”€â–º DEBUG_MODE\n   â”‚   â””â”€â–º LOG_LEVEL\n   â”‚\n   â”œâ”€â–º Calculate Memory Usage\n   â”‚   â””â”€â–º memoryUsed = totalmem - freemem\n   â”‚\n   â”œâ”€â–º Build Response\n   â”‚   â”œâ”€â–º Status: \"healthy\"\n   â”‚   â”œâ”€â–º System Information\n   â”‚   â”œâ”€â–º Environment Information\n   â”‚   â””â”€â–º Timestamp\n   â”‚\n   â””â”€â–º Return 200 OK\n```\n\n**Use Cases:**\n- System resource monitoring\n- Performance analysis\n- Capacity planning\n- Troubleshooting system issues\n\n---\n\n### Test Sentry\n\n**Endpoint:** `GET /{MODE}/health/test-sentry`\n\n**Description:** Intentionally triggers different types of errors to test Sentry error tracking integration. Useful for validating error monitoring setup.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `test_sentry`\n\n**Query Parameters:**\n- `type` (optional): Type of error to test\n  - `exception` (default): Manual exception capture\n  - `message`: Manual message capture\n  - `unhandled`: Unhandled error (caught by error handler)\n  - `async`: Async error\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Example:**\n```http\nGET /dev/v1/health/test-sentry?type=exception HTTP/1.1\nHost: api.example.com\nAuthorization: Bearer <token>\n```\n\n**Response (Exception Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test exception sent to Sentry\",\n  \"data\": {\n    \"type\": \"exception\",\n    \"environment\": \"development\",\n    \"message\": \"Check your Sentry dashboard for the error\",\n    \"error\": \"Test Sentry Exception - This is a test error\"\n  }\n}\n```\n\n**Response (Message Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test message sent to Sentry\",\n  \"data\": {\n    \"type\": \"message\",\n    \"environment\": \"development\",\n    \"message\": \"Check your Sentry dashboard for the message\"\n  }\n}\n```\n\n**Response (Async Type):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Test async error scheduled\",\n  \"data\": {\n    \"type\": \"async\",\n    \"environment\": \"development\",\n    \"message\": \"Async error will be sent to Sentry in 100ms\"\n  }\n}\n```\n\n**Workflow (Exception Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"exception\" (default)\n   â”‚\n   â”œâ”€â–º Set Sentry User Context\n   â”‚   â””â”€â–º If user available, set user info\n   â”‚\n   â”œâ”€â–º Add Breadcrumb\n   â”‚   â””â”€â–º Log test initiation\n   â”‚\n   â”œâ”€â–º Create Test Error\n   â”‚   â”œâ”€â–º Error Name: \"SentryTestError\"\n   â”‚   â””â”€â–º Error Message: \"Test Sentry Exception...\"\n   â”‚\n   â”œâ”€â–º Capture Exception in Sentry\n   â”‚   â”œâ”€â–º Add Tags (test_type, environment, endpoint)\n   â”‚   â””â”€â–º Add Extra Data (query, userAgent, IP)\n   â”‚\n   â””â”€â–º Return 200 OK with Success Message\n```\n\n**Workflow (Unhandled Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"unhandled\"\n   â”‚\n   â”œâ”€â–º Throw Error\n   â”‚   â””â”€â–º \"Test Unhandled Error...\"\n   â”‚\n   â”œâ”€â–º Error Handler Catches\n   â”‚   â”œâ”€â–º Log Error\n   â”‚   â”œâ”€â–º Capture in Sentry\n   â”‚   â””â”€â–º Format Error Response\n   â”‚\n   â””â”€â–º Return 500 with Error Details\n```\n\n**Workflow (Async Type):**\n```\n1. Client Request with Authentication\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Extract Query Parameters\n   â”‚   â””â”€â–º type = \"async\"\n   â”‚\n   â”œâ”€â–º Schedule Async Error\n   â”‚   â””â”€â–º setTimeout(() => {\n   â”‚       â””â”€â–º Capture Exception in Sentry\n   â”‚   }, 100)\n   â”‚\n   â””â”€â–º Return 200 OK Immediately\n       â””â”€â–º Error sent to Sentry after 100ms\n```\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Client prepares request\n  â”œâ”€â–º Admin/developer wants to test Sentry integration\n  â”œâ”€â–º Select error type (exception, message, unhandled, async)\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare GET request with query parameter\n\nStep 2: Client sends request\n  GET /{MODE}/health/test-sentry?type=exception\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 3: Client receives response\n  â”œâ”€â–º Success (200): Check Sentry dashboard for error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Error was captured (for unhandled type)\n\nStep 4: Client processes response\n  â”œâ”€â–º Display success message\n  â”œâ”€â–º Show link to Sentry dashboard\n  â””â”€â–º Verify error appears in Sentry\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract query parameter (type)\n  â””â”€â–º Validate type parameter (exception, message, unhandled, async)\n\nStep 2: Permission check\n  â”œâ”€â–º Check if user has \"test_sentry\" permission\n  â””â”€â–º If no permission: Return 403 Forbidden\n\nStep 3: Set Sentry context\n  â”œâ”€â–º Set user context (user_id, email)\n  â”œâ”€â–º Add breadcrumb with test initiation info\n  â””â”€â–º Set environment from API_MODE\n\nStep 4: Execute test based on type\n  â”œâ”€â–º If type = \"exception\":\n  â”‚   â”œâ”€â–º Create test exception\n  â”‚   â”œâ”€â–º Capture exception in Sentry with tags and extra data\n  â”‚   â””â”€â–º Return success response\n  â”‚\n  â”œâ”€â–º If type = \"message\":\n  â”‚   â”œâ”€â–º Capture warning message in Sentry\n  â”‚   â””â”€â–º Return success response\n  â”‚\n  â”œâ”€â–º If type = \"unhandled\":\n  â”‚   â”œâ”€â–º Throw exception (will be caught by error handler)\n  â”‚   â””â”€â–º Error handler captures in Sentry and returns 500\n  â”‚\n  â””â”€â–º If type = \"async\":\n      â”œâ”€â–º Schedule async task to capture error after 100ms\n      â””â”€â–º Return success response immediately\n\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include test type and environment\n  â”œâ”€â–º Include message to check Sentry dashboard\n  â””â”€â–º Return response\n\nStep 6: Error handling\n  â”œâ”€â–º Invalid type: Return 400\n  â”œâ”€â–º Permission denied: Return 403\n  â”œâ”€â–º Token invalid: Return 401\n  â””â”€â–º Other errors: Log and return 500\n```\n\n**Error Types:**\n\n1. **Exception**: Manually captures an exception with context\n2. **Message**: Sends a warning message to Sentry\n3. **Unhandled**: Throws an error that gets caught by the global error handler\n4. **Async**: Schedules an async error to test async error tracking\n\n**Use Cases:**\n- Testing Sentry integration\n- Validating error tracking setup\n- Debugging error monitoring\n- Verifying error context capture\n\n---\n\n### Database Health Check\n\n**Endpoint:** `GET /{MODE}/health/database`\n\n**Description:** Checks database connectivity and response time. Returns database status and connection metrics.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_system_health`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Database is healthy\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"message\": \"Database connection is working\",\n    \"response_time\": 2.45,\n    \"database_type\": \"PostgreSQL\"\n  }\n}\n```\n\n**Error Response (503 Service Unavailable):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Database is unhealthy\",\n  \"error\": {\n    \"code\": \"DATABASE_UNHEALTHY\",\n    \"details\": {\n      \"status\": \"error\",\n      \"message\": \"Database check failed: Connection refused\",\n      \"error\": \"Connection refused\"\n    }\n  }\n}\n```\n\n---\n\n### Storage Health Check\n\n**Endpoint:** `GET /{MODE}/health/storage`\n\n**Description:** Checks Google Cloud Storage connectivity and status. Returns storage service metrics.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `view_system_health`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"Storage is healthy\",\n  \"data\": {\n    \"status\": \"healthy\",\n    \"message\": \"Google Cloud Storage is working\",\n    \"response_time\": 150.23,\n    \"bucket_name\": \"my-bucket\",\n    \"blob_count\": 1,\n    \"storage_class\": \"ProfessionalMediaStorage\"\n  }\n}\n```\n\n**Error Response (503 Service Unavailable):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Storage is unhealthy\",\n  \"error\": {\n    \"code\": \"STORAGE_UNHEALTHY\",\n    \"details\": {\n      \"status\": \"error\",\n      \"message\": \"GCS connection failed\",\n      \"error\": \"Bucket not found\"\n    }\n  }\n}\n```\n\n---\n\n## Workflows\n\n### Complete Health Check Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Health Check Request                     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Determine Endpoint Type                        â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚\nâ”‚  â”‚ Basic Health â”‚  â”‚ System Info  â”‚  â”‚ Test Sentry  â”‚       â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â”‚                  â”‚                  â”‚\n          â–¼                  â–¼                  â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Gather Env Vars â”‚ â”‚ Gather Sys Info â”‚ â”‚ Validate Auth   â”‚\nâ”‚ Return Status   â”‚ â”‚ Calculate Memoryâ”‚ â”‚ Test Error Type â”‚\nâ”‚                 â”‚ â”‚ Return Metrics  â”‚ â”‚ Capture Sentry  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n          â”‚                  â”‚                  â”‚\n          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    Return Response                          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Error Handling\n\n### Health Check Errors\n\n**500 Internal Server Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Health check failed\",\n  \"error\": \"Error details\",\n  \"statusCode\": 500\n}\n```\n\n**Common Error Scenarios:**\n- Environment variables not accessible\n- System information gathering fails\n- Sentry configuration issues (for test-sentry endpoint)\n\n### Error Handling Workflow\n\n```\n1. Error Occurs\n   â”‚\n   â”œâ”€â–º Log Error\n   â”‚   â””â”€â–º Winston Logger\n   â”‚\n   â”œâ”€â–º Capture in Sentry (if applicable)\n   â”‚   â””â”€â–º captureException()\n   â”‚\n   â”œâ”€â–º Format Error Response\n   â”‚   â””â”€â–º ERROR.fromMap()\n   â”‚\n   â””â”€â–º Return Error Response\n       â””â”€â–º Appropriate Status Code\n```\n\n---\n\n## Best Practices\n\n1. **Use Basic Health Check for Load Balancers**: The `/health` endpoint is lightweight and perfect for frequent health checks\n2. **Use System Health for Monitoring**: The `/health/system` endpoint provides detailed metrics for monitoring dashboards\n3. **Test Sentry Regularly**: Use `/test-sentry` to validate error tracking is working correctly\n4. **Monitor Response Times**: Health checks should respond quickly (< 100ms)\n5. **Cache System Info**: Consider caching system information if called frequently\n6. **Secure Test Endpoint**: The test-sentry endpoint requires authentication to prevent abuse\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for health endpoints\nasync function healthRequest(url, options = {}) {\n  const headers = {\n    'Content-Type': 'application/json',\n    ...options.headers\n  };\n  \n  // Add token if endpoint requires authentication\n  const token = getAuthToken();\n  if (token && url.includes('/test-sentry') || url.includes('/database') || url.includes('/storage')) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to access this endpoint');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success && response.status >= 400) {\n    throw new Error(data.error?.message || 'Health check failed');\n  }\n  \n  return data;\n}\n```\n\n### Basic Health Check\n\n```javascript\n// Check basic API health (no authentication required)\nasync function checkHealth() {\n  try {\n    const response = await fetch('/health', {\n      method: 'GET'\n    });\n    \n    const data = await response.json();\n    \n    if (data.success && data.data.status === 'ok') {\n      console.log('Service is healthy');\n      return {\n        healthy: true,\n        status: data.data.status,\n        environment: data.meta.env\n      };\n    } else {\n      console.error('Service is unhealthy');\n      return {\n        healthy: false,\n        status: 'error'\n      };\n    }\n  } catch (error) {\n    console.error('Health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Use in load balancer or monitoring\nsetInterval(async () => {\n  const health = await checkHealth();\n  if (!health.healthy) {\n    console.error('Service is down!');\n    // Alert monitoring system\n  }\n}, 30000); // Check every 30 seconds\n```\n\n### System Health Check\n\n```javascript\n// Get detailed system information\nasync function getSystemHealth() {\n  try {\n    const response = await fetch('/api/v1/health/system', {\n      method: 'GET'\n    });\n    \n    const data = await response.json();\n    \n    if (data.success && data.data) {\n      const systemInfo = data.data.system_info;\n      \n      // Format memory values\n      const formatBytes = (bytes) => {\n        if (bytes === 0) return '0 Bytes';\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n      };\n      \n      return {\n        healthy: true,\n        platform: systemInfo.platform,\n        pythonVersion: systemInfo.python_version,\n        cpuCount: systemInfo.cpu_count,\n        memory: {\n          total: formatBytes(systemInfo.memory_total),\n          available: formatBytes(systemInfo.memory_available),\n          percent: systemInfo.memory_percent\n        },\n        diskUsage: systemInfo.disk_usage,\n        environment: data.data.environment\n      };\n    }\n  } catch (error) {\n    console.error('System health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Display system health in dashboard\nasync function displaySystemHealth() {\n  const health = await getSystemHealth();\n  \n  if (health.healthy) {\n    document.getElementById('cpu-count').textContent = health.cpuCount;\n    document.getElementById('memory-total').textContent = health.memory.total;\n    document.getElementById('memory-available').textContent = health.memory.available;\n    document.getElementById('memory-percent').textContent = `${health.memory.percent}%`;\n    document.getElementById('disk-usage').textContent = `${health.diskUsage}%`;\n    \n    // Alert if memory or disk usage is high\n    if (health.memory.percent > 80) {\n      showWarning('Memory usage is high: ' + health.memory.percent + '%');\n    }\n    if (health.diskUsage > 80) {\n      showWarning('Disk usage is high: ' + health.diskUsage + '%');\n    }\n  }\n}\n```\n\n### Database Health Check\n\n```javascript\n// Check database connectivity\nasync function checkDatabaseHealth() {\n  try {\n    const response = await healthRequest('/api/v1/health/database', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const dbHealth = response.data;\n      \n      return {\n        healthy: dbHealth.status === 'healthy',\n        status: dbHealth.status,\n        message: dbHealth.message,\n        responseTime: dbHealth.response_time,\n        databaseType: dbHealth.database_type\n      };\n    }\n  } catch (error) {\n    console.error('Database health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n\n// Display database health status\nasync function displayDatabaseHealth() {\n  const health = await checkDatabaseHealth();\n  \n  const statusElement = document.getElementById('db-status');\n  if (statusElement) {\n    statusElement.textContent = health.healthy ? 'Healthy' : 'Unhealthy';\n    statusElement.className = health.healthy ? 'status-healthy' : 'status-unhealthy';\n    \n    if (health.responseTime) {\n      document.getElementById('db-response-time').textContent = \n        `${health.responseTime}ms`;\n    }\n  }\n}\n```\n\n### Storage Health Check\n\n```javascript\n// Check storage connectivity\nasync function checkStorageHealth() {\n  try {\n    const response = await healthRequest('/api/v1/health/storage', {\n      method: 'GET'\n    });\n    \n    if (response && response.data) {\n      const storageHealth = response.data;\n      \n      return {\n        healthy: storageHealth.status === 'healthy',\n        status: storageHealth.status,\n        message: storageHealth.message,\n        responseTime: storageHealth.response_time,\n        bucketName: storageHealth.bucket_name,\n        blobCount: storageHealth.blob_count\n      };\n    }\n  } catch (error) {\n    console.error('Storage health check failed:', error);\n    return {\n      healthy: false,\n      error: error.message\n    };\n  }\n}\n```\n\n### Test Sentry\n\n```javascript\n// Test Sentry error tracking\nasync function testSentry(type = 'exception') {\n  try {\n    const response = await healthRequest(\n      `/api/v1/health/test-sentry?type=${type}`,\n      {\n        method: 'GET'\n      }\n    );\n    \n    if (response && response.data) {\n      const testResult = response.data;\n      \n      showNotification(\n        `Test ${testResult.type} sent to Sentry. Check your Sentry dashboard.`\n      );\n      \n      // Open Sentry dashboard in new tab\n      const sentryUrl = 'https://sentry.io/organizations/your-org/issues/';\n      window.open(sentryUrl, '_blank');\n      \n      return testResult;\n    }\n  } catch (error) {\n    console.error('Sentry test failed:', error);\n    showError('Failed to test Sentry: ' + error.message);\n    throw error;\n  }\n}\n\n// Test different error types\nasync function testAllSentryTypes() {\n  const types = ['exception', 'message', 'unhandled', 'async'];\n  \n  for (const type of types) {\n    console.log(`Testing Sentry type: ${type}`);\n    try {\n      await testSentry(type);\n      await new Promise(resolve => setTimeout(resolve, 1000)); // Wait 1 second\n    } catch (error) {\n      console.error(`Failed to test ${type}:`, error);\n    }\n  }\n}\n```\n\n### Complete Health Monitor Component\n\n```javascript\n// Complete Health Monitor Class\nclass HealthMonitor {\n  constructor() {\n    this.healthStatus = {\n      api: null,\n      system: null,\n      database: null,\n      storage: null\n    };\n    this.monitoringInterval = null;\n  }\n  \n  async init() {\n    try {\n      // Initial health check\n      await this.checkAll();\n      \n      // Set up auto-refresh (every 60 seconds)\n      this.startMonitoring(60 * 1000);\n    } catch (error) {\n      console.error('Failed to initialize health monitor:', error);\n    }\n  }\n  \n  async checkAll() {\n    try {\n      showLoading('Checking system health...');\n      \n      // Check all health endpoints in parallel\n      const [apiHealth, systemHealth, dbHealth, storageHealth] = await Promise.allSettled([\n        checkHealth(),\n        getSystemHealth(),\n        checkDatabaseHealth(),\n        checkStorageHealth()\n      ]);\n      \n      this.healthStatus.api = apiHealth.status === 'fulfilled' ? apiHealth.value : null;\n      this.healthStatus.system = systemHealth.status === 'fulfilled' ? systemHealth.value : null;\n      this.healthStatus.database = dbHealth.status === 'fulfilled' ? dbHealth.value : null;\n      this.healthStatus.storage = storageHealth.status === 'fulfilled' ? storageHealth.value : null;\n      \n      this.renderHealthStatus();\n      hideLoading();\n    } catch (error) {\n      hideLoading();\n      console.error('Health check failed:', error);\n      showError('Failed to check system health');\n    }\n  }\n  \n  renderHealthStatus() {\n    // Render API health\n    this.renderStatus('api-status', this.healthStatus.api);\n    \n    // Render system health\n    if (this.healthStatus.system) {\n      this.renderSystemMetrics(this.healthStatus.system);\n    }\n    \n    // Render database health\n    this.renderStatus('db-status', this.healthStatus.database);\n    \n    // Render storage health\n    this.renderStatus('storage-status', this.healthStatus.storage);\n  }\n  \n  renderStatus(elementId, health) {\n    const element = document.getElementById(elementId);\n    if (element && health) {\n      element.textContent = health.healthy ? 'Healthy' : 'Unhealthy';\n      element.className = health.healthy ? 'status-healthy' : 'status-unhealthy';\n    }\n  }\n  \n  renderSystemMetrics(system) {\n    if (system.healthy) {\n      document.getElementById('cpu-count').textContent = system.cpuCount;\n      document.getElementById('memory-percent').textContent = `${system.memory.percent}%`;\n      document.getElementById('disk-usage').textContent = `${system.diskUsage}%`;\n      \n      // Update progress bars\n      this.updateProgressBar('memory-bar', system.memory.percent);\n      this.updateProgressBar('disk-bar', system.diskUsage);\n    }\n  }\n  \n  updateProgressBar(elementId, percent) {\n    const bar = document.getElementById(elementId);\n    if (bar) {\n      bar.style.width = `${percent}%`;\n      bar.className = percent > 80 ? 'progress-bar-danger' : \n                     percent > 60 ? 'progress-bar-warning' : \n                     'progress-bar-success';\n    }\n  }\n  \n  startMonitoring(interval) {\n    this.monitoringInterval = setInterval(() => {\n      this.checkAll();\n    }, interval);\n  }\n  \n  stopMonitoring() {\n    if (this.monitoringInterval) {\n      clearInterval(this.monitoringInterval);\n      this.monitoringInterval = null;\n    }\n  }\n}\n\n// Initialize health monitor\ndocument.addEventListener('DOMContentLoaded', () => {\n  const healthMonitor = new HealthMonitor();\n  healthMonitor.init();\n});\n```\n\n### Error Handling\n\n```javascript\n// Enhanced error handling for health checks\nasync function healthCheckWithRetry(url, maxRetries = 3) {\n  let lastError;\n  \n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await healthRequest(url, { method: 'GET' });\n    } catch (error) {\n      lastError = error;\n      \n      // Don't retry on 401 or 403 errors\n      if (error.message.includes('401') || error.message.includes('403')) {\n        throw error;\n      }\n      \n      // Wait before retry (exponential backoff)\n      await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));\n    }\n  }\n  \n  throw lastError;\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all health and monitoring endpoints:\n\n### Endpoints Covered:\n1. âœ… **Health Check** - Basic API health status (public)\n2. âœ… **System Health Check** - Detailed system information (public)\n3. âœ… **Database Health Check** - Database connectivity check (authenticated)\n4. âœ… **Storage Health Check** - Google Cloud Storage check (authenticated)\n5. âœ… **Test Sentry** - Sentry error tracking test (authenticated)\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices\n- âœ… Complete client-side implementation examples\n- âœ… Health monitoring component examples\n\n### Key Features:\n- **Public endpoints** - Basic and system health checks don't require authentication\n- **Authenticated endpoints** - Database, storage, and Sentry test require permissions\n- **Comprehensive monitoring** - System metrics, database status, storage connectivity\n- **Error tracking** - Sentry integration testing\n- **Client-side examples** - Ready-to-use JavaScript code for health monitoring\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "Upload Media",
			"item": [
				{
					"name": "upload-media",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": "/home/mrdas/Downloads/Rameshkumardas.jpg"
								},
								{
									"key": "url",
									"value": "",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/upload-media",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"upload-media"
							]
						}
					},
					"response": []
				},
				{
					"name": "delete-media",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": []
						},
						"url": {
							"raw": "{{domain.com}}/{{mode}}/delete-media?url=https://storage.googleapis.com/klikyai-v3-bucket/UserProfile/mrdasdeveloper-d7232df3-cffd-4f9c-b8a8-6f5a3de5d304-%7C-d56522e9-5596-431f-876d-3d34f1e8293d.jpeg",
							"host": [
								"{{domain.com}}"
							],
							"path": [
								"{{mode}}",
								"delete-media"
							],
							"query": [
								{
									"key": "url",
									"value": "https://storage.googleapis.com/klikyai-v3-bucket/UserProfile/mrdasdeveloper-d7232df3-cffd-4f9c-b8a8-6f5a3de5d304-%7C-d56522e9-5596-431f-876d-3d34f1e8293d.jpeg"
								}
							]
						}
					},
					"response": []
				}
			],
			"description": "# File Upload Router\n\n> **Complete Documentation for Media File Upload and Management Endpoints**\n\nThis router handles file upload operations including uploading files from URLs or direct file uploads to Google Cloud Storage, and deleting uploaded files.\n\n## ğŸ“‹ Table of Contents\n\n- [Overview](#overview)\n- [Endpoints](#endpoints)\n  - [Upload Media](#upload-media)\n  - [Delete Media](#delete-media)\n- [Workflows](#workflows)\n- [Error Handling](#error-handling)\n- [Client-Side Implementation](#client-side-implementation)\n- [Summary](#summary)\n\n## Overview\n\nThe File Upload router provides comprehensive media file management functionality including:\n- **File Upload**: Upload files directly or from URLs to Google Cloud Storage\n- **File Deletion**: Delete files from Google Cloud Storage\n- **Multiple Formats**: Support for images, documents, videos, and other file types\n- **Size Limits**: 15MB maximum file size\n- **Automatic Processing**: Automatic file type detection and content type handling\n\n**Base Path:** `/{MODE}/upload-media`, `/{MODE}/delete-media`\n\n**Authentication:** All endpoints require authentication\n\n**Permissions:** \n- Upload: `add_upload` permission\n- Delete: `delete_upload` permission\n\n## Endpoints\n\n### Upload Media\n\n**Endpoint:** `POST /{MODE}/upload-media`\n\n**Description:** Upload a media file either from URL or direct file upload to Google Cloud Storage.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `add_upload`\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\nContent-Type: multipart/form-data (for file upload)\n# OR\nContent-Type: application/x-www-form-urlencoded (for URL upload)\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Options:**\n\n**Option 1: Direct File Upload (Multipart Form Data)**\n```http\nPOST /dev/v1/upload-media HTTP/1.1\nAuthorization: Bearer <token>\nContent-Type: multipart/form-data\n\nfile: [binary file data]\n```\n\n**Option 2: Upload from URL (Form Data)**\n```http\nPOST /dev/v1/upload-media HTTP/1.1\nAuthorization: Bearer <token>\nContent-Type: application/x-www-form-urlencoded\n\nurl: https://example.com/image.jpg\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"File uploaded successfully\",\n  \"data\": {\n    \"url\": \"https://storage.googleapis.com/bucket-name/media/users/user-uuid-file.jpg\"\n  }\n}\n```\n\n**Workflow (Direct File Upload):**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check file or url exists\n   â”‚\n   â”œâ”€â–º Process File Upload\n   â”‚   â”œâ”€â–º Extract file buffer\n   â”‚   â”œâ”€â–º Get file extension from filename\n   â”‚   â””â”€â–º Get content type from mimetype\n   â”‚\n   â”œâ”€â–º Generate Object Key\n   â”‚   â””â”€â–º {userId}-|-{uuid}.{extension}\n   â”‚\n   â”œâ”€â–º Upload to Google Cloud Storage\n   â”‚   â”œâ”€â–º Folder: media/users\n   â”‚   â”œâ”€â–º Object Key: generated key\n   â”‚   â””â”€â–º uploadToGoogleStorageFromString()\n   â”‚\n   â””â”€â–º Return Public URL\n```\n\n**Workflow (Upload from URL):**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (add_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check url exists\n   â”‚\n   â”œâ”€â–º Download File from URL\n   â”‚   â”œâ”€â–º axios.get(url, { responseType: 'arraybuffer' })\n   â”‚   â”œâ”€â–º Max size: 15MB\n   â”‚   â””â”€â–º Convert to Buffer\n   â”‚\n   â”œâ”€â–º Extract File Information\n   â”‚   â”œâ”€â–º Extension from URL or Content-Type header\n   â”‚   â””â”€â–º Content type from response headers\n   â”‚\n   â”œâ”€â–º Generate Object Key\n   â”‚   â””â”€â–º {userId}-|-{uuid}.{extension}\n   â”‚\n   â”œâ”€â–º Upload to Google Cloud Storage\n   â”‚   â””â”€â–º uploadToGoogleStorageFromString()\n   â”‚\n   â””â”€â–º Return Public URL\n```\n\n**Supported File Types:**\n- Images: jpg, jpeg, png, gif, webp, svg\n- Documents: pdf, doc, docx, txt\n- Videos: mp4, avi, mov, webm\n- Other: Based on content type\n\n**File Size Limit:** 15MB maximum\n\n**Storage Location:**\n- Folder: `media/users`\n- Object Key Format: `{userId}-|-{uuid}.{extension}`\n- Public URL: `https://storage.googleapis.com/{bucket-name}/media/users/{object-key}`\n\n**Client-Server Communication Flow (Direct File Upload):**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User selects file\n  â”œâ”€â–º User clicks \"Choose File\" button\n  â”œâ”€â–º File picker opens\n  â””â”€â–º User selects file (image, document, video, etc.)\n\nStep 2: Client validates file\n  â”œâ”€â–º Check file size (must be < 15MB)\n  â”œâ”€â–º Check file type (optional validation)\n  â”œâ”€â–º Optionally: Preview file before upload\n  â””â”€â–º Show upload progress indicator\n\nStep 3: Client prepares request\n  â”œâ”€â–º Create FormData object\n  â”œâ”€â–º Append file to FormData with key \"file\"\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare POST request with multipart/form-data\n\nStep 4: Client sends request\n  POST /{MODE}/upload-media\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: multipart/form-data\n  Body:\n    file: <File object>\n\nStep 5: Client receives response\n  â”œâ”€â–º Success (200): Display uploaded file URL, show success message\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â”œâ”€â–º Payload Too Large (413): Show file size error\n  â””â”€â–º Error (500): Show error message\n\nStep 6: Client processes response\n  â”œâ”€â–º Extract public URL from response.data.url\n  â”œâ”€â–º Store URL for later use\n  â”œâ”€â–º Display uploaded file (if image, show preview)\n  â””â”€â–º Update UI with uploaded file information\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Check permission: \"add_upload\"\n  â””â”€â–º Validate request has either file or url\n\nStep 2: File processing (if file provided)\n  â”œâ”€â–º Read file data from request\n  â”œâ”€â–º Extract file extension from filename\n  â”œâ”€â–º Get content type from file.content_type\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\n\nStep 3: URL processing (if url provided)\n  â”œâ”€â–º Download file from URL using httpx\n  â”œâ”€â–º Check response status (raise_for_status)\n  â”œâ”€â–º Get file data from response.content\n  â”œâ”€â–º Extract extension from URL or Content-Type header\n  â”œâ”€â–º Get content type from response headers\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\n\nStep 4: Upload to Google Cloud Storage\n  â”œâ”€â–º Set folder: \"media/users\"\n  â”œâ”€â–º Upload file using upload_to_google_storage_from_string()\n  â”œâ”€â–º Set content type\n  â”œâ”€â–º Make file publicly accessible\n  â””â”€â–º Get public URL\n\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include public URL in data.url\n  â””â”€â–º Return response with user's language preference\n\nStep 6: Error handling\n  â”œâ”€â–º No file or URL: Return 400\n  â”œâ”€â–º File too large: Return 413\n  â”œâ”€â–º Download error: Return 500\n  â”œâ”€â–º Upload error: Return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Client-Server Communication Flow (Upload from URL):**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User enters URL\n  â”œâ”€â–º User enters file URL in input field\n  â”œâ”€â–º User clicks \"Upload from URL\" button\n  â””â”€â–º Client validates URL format\n\nStep 2: Client validates URL\n  â”œâ”€â–º Check URL format (http:// or https://)\n  â”œâ”€â–º Optionally: Preview file from URL\n  â””â”€â–º Show loading indicator\n\nStep 3: Client sends request\n  POST /{MODE}/upload-media\n  Headers:\n    Authorization: Bearer <token>\n    Content-Type: application/x-www-form-urlencoded\n  Body:\n    url: https://example.com/image.jpg\n\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Display uploaded file URL\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission error\n  â””â”€â–º Error (500): Show error message\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Check permission: \"add_upload\"\n  â””â”€â–º Validate url parameter exists\n\nStep 2: Download file from URL\n  â”œâ”€â–º Create httpx AsyncClient\n  â”œâ”€â–º GET request to URL with responseType: 'arraybuffer'\n  â”œâ”€â–º Check response status\n  â”œâ”€â–º Get file data from response.content\n  â””â”€â–º Handle download errors\n\nStep 3: Extract file information\n  â”œâ”€â–º Get extension from URL (split by '.')\n  â”œâ”€â–º If no extension, get from Content-Type header\n  â”œâ”€â–º Get content type from response headers\n  â””â”€â–º Generate unique object key: {userId}-|-{uuid}.{extension}\n\nStep 4: Upload to Google Cloud Storage\n  â”œâ”€â–º Set folder: \"media/users\"\n  â”œâ”€â–º Upload file using upload_to_google_storage_from_string()\n  â””â”€â–º Get public URL\n\nStep 5: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include public URL in data.url\n  â””â”€â–º Return response\n\nStep 6: Error handling\n  â”œâ”€â–º Invalid URL: Return 400\n  â”œâ”€â–º Download failed: Return 500\n  â”œâ”€â–º Upload error: Return 500\n  â””â”€â–º Permission denied: Return 403\n```\n\n**Error Responses:**\n\n```json\n// 400 - No File or URL\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"File or URL required\",\n  \"error\": {\n    \"code\": \"MEDIA_FILE_OR_URL\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"message\": \"Either file or url must be provided\"\n    }\n  }\n}\n\n// 403 - Permission Denied\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Permission denied\",\n  \"error\": {\n    \"code\": \"PERMISSION_DENIED\",\n    \"details\": {\n      \"required_permission\": \"add_upload\"\n    }\n  }\n}\n\n// 500 - Upload Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Upload processing error\",\n  \"error\": {\n    \"code\": \"MEDIA_UPLOADING_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n### Delete Media\n\n**Endpoint:** `DELETE /{MODE}/delete-media`\n\n**Description:** Delete a media file from Google Cloud Storage.\n\n**Authentication:** Required (access_token or session_token)\n\n**Required Permission:** `delete_upload`\n\n**Query Parameters:**\n- `url` (required): GCS URL of the file to delete\n\n**Request Headers:**\n```\nAuthorization: Bearer <access_token>\n# OR\nX-Session-Token: <session_token>\n```\n\n**Request Example:**\n```http\nDELETE /dev/v1/delete-media?url=https://storage.googleapis.com/bucket-name/media/users/user-uuid-file.jpg HTTP/1.1\nAuthorization: Bearer <token>\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"message\": \"File deleted successfully from bucket 'bucket-name'\",\n  \"data\": {\n    \"bucket\": \"bucket-name\"\n  }\n}\n```\n\n**Workflow:**\n```\n1. Authenticated Request\n   â”‚\n   â”œâ”€â–º Validate JWT Token\n   â”‚\n   â”œâ”€â–º Check Permission (delete_upload)\n   â”‚\n   â”œâ”€â–º Validate Request\n   â”‚   â””â”€â–º Check url parameter exists\n   â”‚\n   â”œâ”€â–º Validate Bucket Configuration\n   â”‚   â””â”€â–º Check GOOGLE_STORAGE_BUCKET_NAME exists\n   â”‚\n   â”œâ”€â–º Parse GCS URL\n   â”‚   â”œâ”€â–º Decode URL\n   â”‚   â”œâ”€â–º Validate domain (storage.googleapis.com)\n   â”‚   â””â”€â–º Extract bucket and object path\n   â”‚\n   â”œâ”€â–º Validate Bucket Match\n   â”‚   â””â”€â–º Ensure URL bucket matches configured bucket\n   â”‚\n   â”œâ”€â–º Extract Object Path\n   â”‚   â”œâ”€â–º Folder: media/users (or other)\n   â”‚   â””â”€â–º Object Key: file name\n   â”‚\n   â”œâ”€â–º Delete from Google Cloud Storage\n   â”‚   â””â”€â–º deleteFromGoogleStorage(folder, objectKey)\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n**URL Format:**\n```\nhttps://storage.googleapis.com/{bucket-name}/{folder}/{object-key}\n```\n\n**Example:**\n```\nhttps://storage.googleapis.com/my-bucket/media/users/user-123-file.jpg\n```\n\n**Validation:**\n- URL must be from `storage.googleapis.com`\n- Bucket in URL must match configured bucket\n- URL must have valid path structure\n\n**Client-Server Communication Flow:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    CLIENT SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: User initiates deletion\n  â”œâ”€â–º User clicks \"Delete\" button on file\n  â”œâ”€â–º Client shows confirmation dialog\n  â””â”€â–º User confirms deletion\n\nStep 2: Client prepares request\n  â”œâ”€â–º Get GCS URL of file to delete\n  â”œâ”€â–º URL encode the URL parameter\n  â”œâ”€â–º Retrieve stored access_token or session_token\n  â””â”€â–º Prepare DELETE request with query parameter\n\nStep 3: Client sends request\n  DELETE /{MODE}/delete-media?url={encoded_url}\n  Headers:\n    Authorization: Bearer <token>\n    # OR\n    X-Session-Token: <session_token>\n\nStep 4: Client receives response\n  â”œâ”€â–º Success (200): Remove file from UI, show success message\n  â”œâ”€â–º Bad Request (400): Show validation error\n  â”œâ”€â–º Unauthorized (401): Redirect to login\n  â”œâ”€â–º Forbidden (403): Show permission/bucket error\n  â”œâ”€â–º Not Found (404): Show file not found error\n  â””â”€â–º Error (500): Show error message\n\nStep 5: Client processes response\n  â”œâ”€â–º Remove file from display\n  â”œâ”€â–º Update file list\n  â””â”€â–º Clear file URL from storage\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    SERVER SIDE                                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nStep 1: Request validation\n  â”œâ”€â–º Extract token from headers\n  â”œâ”€â–º Validate token (JWT verification)\n  â”œâ”€â–º Check token blacklist\n  â”œâ”€â–º Extract user from token\n  â”œâ”€â–º Extract url query parameter\n  â”œâ”€â–º Check permission: \"delete_upload\"\n  â””â”€â–º Validate url parameter exists\n\nStep 2: Validate bucket configuration\n  â”œâ”€â–º Get GOOGLE_STORAGE_BUCKET_NAME from environment\n  â””â”€â–º If not configured: Return 500\n\nStep 3: Parse and validate GCS URL\n  â”œâ”€â–º Decode URL (unquote)\n  â”œâ”€â–º Parse URL using urlparse\n  â”œâ”€â–º Validate domain contains \"storage.googleapis.com\"\n  â”œâ”€â–º Extract bucket and object path from URL\n  â”œâ”€â–º Validate URL format (bucket/path structure)\n  â””â”€â–º Check if URL bucket matches configured bucket\n\nStep 4: Validate bucket match\n  â”œâ”€â–º Compare URL bucket with configured bucket\n  â””â”€â–º If mismatch: Return 403 Forbidden\n\nStep 5: Check file existence\n  â”œâ”€â–º Get blob from Google Cloud Storage\n  â”œâ”€â–º Check if blob.exists()\n  â””â”€â–º If not exists: Return 404 Not Found\n\nStep 6: Delete file\n  â”œâ”€â–º Delete blob from Google Cloud Storage\n  â””â”€â–º Verify deletion succeeded\n\nStep 7: Response preparation\n  â”œâ”€â–º Build SUCCESS response\n  â”œâ”€â–º Include bucket name in data.bucket\n  â””â”€â–º Return response with user's language preference\n\nStep 8: Error handling\n  â”œâ”€â–º No URL: Return 400\n  â”œâ”€â–º Invalid URL format: Return 400\n  â”œâ”€â–º Bucket mismatch: Return 403\n  â”œâ”€â–º File not found: Return 404\n  â”œâ”€â–º Delete error: Return 500\n  â”œâ”€â–º Permission denied: Return 403\n  â””â”€â–º Token invalid: Return 401\n```\n\n**Error Responses:**\n\n```json\n// 400 - No URL Provided\n{\n  \"success\": false,\n  \"message\": \"No URL provided\",\n  \"statusCode\": 400\n}\n\n// 400 - Invalid GCS URL\n{\n  \"success\": false,\n  \"message\": \"Invalid GCS URL\",\n  \"statusCode\": 400\n}\n\n// 403 - Bucket Mismatch\n{\n  \"success\": false,\n  \"message\": \"URL bucket does not match configured bucket\",\n  \"statusCode\": 403\n}\n\n// 404 - File Not Found\n{\n  \"success\": false,\n  \"message\": \"File not found in GCS\",\n  \"statusCode\": 404\n}\n\n// 500 - Delete Error\n{\n  \"success\": false,\n  \"id\": null,\n  \"message\": \"Delete processing error\",\n  \"error\": {\n    \"code\": \"MEDIA_DELETING_PROCESSING_ERROR\",\n    \"details\": {\n      \"user_id\": \"uuid\",\n      \"exception\": \"Error details\"\n    }\n  }\n}\n```\n\n---\n\n## Workflows\n\n### Complete File Upload Flow\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              File Upload Flow                               â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  Direct Upload â”‚         â”‚  Upload from â”‚\n        â”‚   (Multipart)  â”‚         â”‚     URL      â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â–¼                           â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Extract File  â”‚         â”‚ Download File â”‚\n        â”‚   Buffer      â”‚         â”‚   from URL    â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                           â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                              â”‚\n                              â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Get File Info   â”‚\n                    â”‚ (ext, type)     â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Generate Key    â”‚\n                    â”‚ {userId}-uuid.extâ”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Upload to GCS   â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Return Public   â”‚\n                    â”‚      URL        â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### File Deletion Flow\n\n```\n1. User Requests File Deletion\n   â”‚\n   â”œâ”€â–º Validate Authentication\n   â”‚   â””â”€â–º Check JWT token\n   â”‚\n   â”œâ”€â–º Check Permission\n   â”‚   â””â”€â–º delete_upload permission\n   â”‚\n   â”œâ”€â–º Validate URL Parameter\n   â”‚   â””â”€â–º URL must be provided\n   â”‚\n   â”œâ”€â–º Parse GCS URL\n   â”‚   â”œâ”€â–º Decode URL\n   â”‚   â”œâ”€â–º Validate domain\n   â”‚   â””â”€â–º Extract bucket and path\n   â”‚\n   â”œâ”€â–º Validate Bucket\n   â”‚   â””â”€â–º URL bucket must match config\n   â”‚\n   â”œâ”€â–º Extract Object Path\n   â”‚   â”œâ”€â–º Folder name\n   â”‚   â””â”€â–º Object key\n   â”‚\n   â”œâ”€â–º Delete from GCS\n   â”‚   â””â”€â–º deleteFromGoogleStorage()\n   â”‚\n   â””â”€â–º Return Success Response\n```\n\n## Error Handling\n\n### Common Error Responses\n\n**400 Bad Request - No File or URL:**\n```json\n{\n  \"success\": false,\n  \"message\": \"File or URL required\",\n  \"error\": \"Either file or url must be provided\",\n  \"statusCode\": 400\n}\n```\n\n**400 Bad Request - Invalid URL:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid URL\",\n  \"error\": \"URL must be from storage.googleapis.com\",\n  \"statusCode\": 400\n}\n```\n\n**401 Unauthorized:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Authentication required\",\n  \"error\": \"Invalid or missing token\",\n  \"statusCode\": 401\n}\n```\n\n**403 Forbidden:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Permission denied\",\n  \"error\": \"Insufficient permissions. Requires add_upload permission\",\n  \"statusCode\": 403\n}\n```\n\n**404 Not Found - File Not Found:**\n```json\n{\n  \"success\": false,\n  \"message\": \"File not found\",\n  \"error\": \"File not found in Google Cloud Storage\",\n  \"statusCode\": 404\n}\n```\n\n**413 Payload Too Large:**\n```json\n{\n  \"success\": false,\n  \"message\": \"File too large\",\n  \"error\": \"File size exceeds 15MB limit\",\n  \"statusCode\": 413\n}\n```\n\n**500 Internal Server Error - Download Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Download error\",\n  \"error\": \"Failed to download file from URL\",\n  \"statusCode\": 500\n}\n```\n\n**500 Internal Server Error - Upload Error:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Upload processing error\",\n  \"error\": \"Failed to upload file to Google Cloud Storage\",\n  \"statusCode\": 500\n}\n```\n\n---\n\n## Best Practices\n\n1. **File Size**: Always validate file size before upload (max 15MB)\n2. **File Types**: Validate file types based on your application requirements\n3. **Content Type**: Set appropriate content type for proper file handling\n4. **URL Validation**: Validate URLs before downloading\n5. **Error Handling**: Handle download and upload errors gracefully\n6. **Security**: Only allow deletion of files from your configured bucket\n7. **Object Keys**: Use unique object keys to prevent overwrites\n8. **Cleanup**: Implement cleanup for failed uploads\n9. **CORS**: Configure CORS on GCS bucket for web uploads\n10. **Permissions**: Use IAM roles for GCS access, not service account keys in code\n\n---\n\n## Google Cloud Storage Configuration\n\n**Required Environment Variables:**\n- `GOOGLE_STORAGE_BUCKET_NAME`: Name of the GCS bucket\n\n**Required Credentials:**\n- Google Cloud Service Account JSON file\n- Proper IAM permissions for bucket access\n\n**Storage Structure:**\n```\nbucket-name/\n  â””â”€â”€ media/\n      â””â”€â”€ users/\n          â”œâ”€â”€ user-123-uuid1.jpg\n          â”œâ”€â”€ user-123-uuid2.png\n          â””â”€â”€ user-456-uuid3.pdf\n```\n\n**Public URL Format:**\n```\nhttps://storage.googleapis.com/{bucket-name}/media/users/{object-key}\n```\n\n---\n\n## Security Considerations\n\n1. **Authentication**: All endpoints require authentication\n2. **Authorization**: Check permissions before allowing upload/delete\n3. **Bucket Validation**: Ensure files are only deleted from your bucket\n4. **URL Validation**: Validate URLs to prevent SSRF attacks\n5. **File Type Validation**: Validate file types to prevent malicious uploads\n6. **Size Limits**: Enforce size limits to prevent DoS attacks\n7. **Content Scanning**: Consider scanning uploaded files for malware\n8. **Access Control**: Use GCS IAM for fine-grained access control\n\n---\n\n## Performance Considerations\n\n1. **File Size**: Large files may take time to upload/download\n2. **Concurrent Uploads**: Handle multiple concurrent uploads efficiently\n3. **Streaming**: For large files, consider streaming uploads\n4. **Caching**: Cache public URLs if files don't change\n5. **CDN**: Consider using CDN for frequently accessed files\n6. **Compression**: Compress images before upload for better performance\n\n---\n\n## Client-Side Implementation\n\n### Token Management\n\n```javascript\n// Get authentication token (prefer session_token)\nfunction getAuthToken() {\n  return localStorage.getItem('session_token') || \n         localStorage.getItem('access_token');\n}\n\n// API request helper for upload endpoints\nasync function uploadRequest(url, options = {}) {\n  const token = getAuthToken();\n  \n  const headers = {\n    ...options.headers\n  };\n  \n  // Prefer X-Session-Token header\n  if (token) {\n    headers['X-Session-Token'] = token;\n    // Or use Authorization header\n    // headers['Authorization'] = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(url, {\n    ...options,\n    headers\n  });\n  \n  if (response.status === 401) {\n    // Token expired, redirect to login\n    window.location.href = '/login';\n    return null;\n  }\n  \n  if (response.status === 403) {\n    // Permission denied\n    throw new Error('You do not have permission to upload files');\n  }\n  \n  const data = await response.json();\n  \n  if (!data.success) {\n    throw new Error(data.error?.message || 'Upload failed');\n  }\n  \n  return data;\n}\n```\n\n### Direct File Upload\n\n```javascript\n// Upload file directly\nasync function uploadFile(file) {\n  try {\n    // Validate file size (15MB limit)\n    const maxSize = 15 * 1024 * 1024; // 15MB in bytes\n    if (file.size > maxSize) {\n      throw new Error('File size exceeds 15MB limit');\n    }\n    \n    // Validate file type (optional)\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];\n    if (!allowedTypes.includes(file.type)) {\n      throw new Error('File type not allowed');\n    }\n    \n    // Create FormData\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    // Show upload progress\n    showUploadProgress(0);\n    \n    // Upload file\n    const response = await uploadRequest('/api/v1/upload-media', {\n      method: 'POST',\n      body: formData\n    });\n    \n    if (response && response.data) {\n      showUploadProgress(100);\n      showNotification('File uploaded successfully');\n      return response.data.url;\n    }\n  } catch (error) {\n    console.error('Error uploading file:', error);\n    showError(error.message || 'Failed to upload file');\n    throw error;\n  }\n}\n\n// Upload with progress tracking\nasync function uploadFileWithProgress(file, onProgress) {\n  try {\n    const formData = new FormData();\n    formData.append('file', file);\n    \n    const token = getAuthToken();\n    \n    const xhr = new XMLHttpRequest();\n    \n    // Track upload progress\n    xhr.upload.addEventListener('progress', (e) => {\n      if (e.lengthComputable) {\n        const percentComplete = (e.loaded / e.total) * 100;\n        if (onProgress) {\n          onProgress(percentComplete);\n        }\n      }\n    });\n    \n    return new Promise((resolve, reject) => {\n      xhr.addEventListener('load', () => {\n        if (xhr.status === 200) {\n          const response = JSON.parse(xhr.responseText);\n          if (response.success) {\n            resolve(response.data.url);\n          } else {\n            reject(new Error(response.error?.message || 'Upload failed'));\n          }\n        } else {\n          reject(new Error(`Upload failed with status ${xhr.status}`));\n        }\n      });\n      \n      xhr.addEventListener('error', () => {\n        reject(new Error('Upload failed'));\n      });\n      \n      xhr.open('POST', '/api/v1/upload-media');\n      xhr.setRequestHeader('X-Session-Token', token);\n      xhr.send(formData);\n    });\n  } catch (error) {\n    console.error('Error uploading file:', error);\n    throw error;\n  }\n}\n```\n\n### Upload from URL\n\n```javascript\n// Upload file from URL\nasync function uploadFromURL(fileUrl) {\n  try {\n    // Validate URL format\n    if (!fileUrl || !fileUrl.startsWith('http://') && !fileUrl.startsWith('https://')) {\n      throw new Error('Invalid URL');\n    }\n    \n    // Create form data\n    const formData = new FormData();\n    formData.append('url', fileUrl);\n    \n    // Show loading\n    showLoading('Downloading file from URL...');\n    \n    // Upload from URL\n    const response = await uploadRequest('/api/v1/upload-media', {\n      method: 'POST',\n      body: formData\n    });\n    \n    hideLoading();\n    \n    if (response && response.data) {\n      showNotification('File uploaded successfully from URL');\n      return response.data.url;\n    }\n  } catch (error) {\n    hideLoading();\n    console.error('Error uploading from URL:', error);\n    showError(error.message || 'Failed to upload from URL');\n    throw error;\n  }\n}\n```\n\n### Delete File\n\n```javascript\n// Delete file from Google Cloud Storage\nasync function deleteFile(gcsUrl) {\n  try {\n    if (!gcsUrl) {\n      throw new Error('File URL is required');\n    }\n    \n    // Confirm deletion\n    const confirmed = confirm('Are you sure you want to delete this file?');\n    if (!confirmed) {\n      return;\n    }\n    \n    // Encode URL for query parameter\n    const encodedUrl = encodeURIComponent(gcsUrl);\n    \n    const token = getAuthToken();\n    \n    const response = await fetch(\n      `/api/v1/delete-media?url=${encodedUrl}`,\n      {\n        method: 'DELETE',\n        headers: {\n          'X-Session-Token': token\n        }\n      }\n    );\n    \n    const data = await response.json();\n    \n    if (response.status === 200 && data.success) {\n      showNotification('File deleted successfully');\n      return true;\n    } else {\n      throw new Error(data.error?.message || 'Failed to delete file');\n    }\n  } catch (error) {\n    console.error('Error deleting file:', error);\n    showError(error.message || 'Failed to delete file');\n    throw error;\n  }\n}\n```\n\n### Complete File Upload Component\n\n```javascript\n// Complete File Upload Manager Class\nclass FileUploadManager {\n  constructor() {\n    this.uploadedFiles = [];\n    this.maxFileSize = 15 * 1024 * 1024; // 15MB\n    this.allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'application/pdf'];\n  }\n  \n  async init() {\n    // Set up file input listeners\n    const fileInput = document.getElementById('file-input');\n    if (fileInput) {\n      fileInput.addEventListener('change', (e) => {\n        this.handleFileSelect(e.target.files[0]);\n      });\n    }\n    \n    // Set up URL upload form\n    const urlForm = document.getElementById('url-upload-form');\n    if (urlForm) {\n      urlForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const url = document.getElementById('file-url').value;\n        this.uploadFromURL(url);\n      });\n    }\n  }\n  \n  async handleFileSelect(file) {\n    try {\n      // Validate file\n      if (!this.validateFile(file)) {\n        return;\n      }\n      \n      // Show preview if image\n      if (file.type.startsWith('image/')) {\n        this.showImagePreview(file);\n      }\n      \n      // Upload file\n      const url = await this.uploadFile(file);\n      \n      // Add to uploaded files list\n      this.uploadedFiles.push({\n        name: file.name,\n        url: url,\n        size: file.size,\n        type: file.type\n      });\n      \n      // Update UI\n      this.renderUploadedFiles();\n      \n    } catch (error) {\n      console.error('Error handling file:', error);\n      showError(error.message);\n    }\n  }\n  \n  validateFile(file) {\n    // Check file size\n    if (file.size > this.maxFileSize) {\n      showError(`File size exceeds ${this.maxFileSize / 1024 / 1024}MB limit`);\n      return false;\n    }\n    \n    // Check file type\n    if (this.allowedTypes.length > 0 && !this.allowedTypes.includes(file.type)) {\n      showError('File type not allowed');\n      return false;\n    }\n    \n    return true;\n  }\n  \n  showImagePreview(file) {\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      const preview = document.getElementById('image-preview');\n      if (preview) {\n        preview.src = e.target.result;\n        preview.style.display = 'block';\n      }\n    };\n    reader.readAsDataURL(file);\n  }\n  \n  async uploadFile(file) {\n    try {\n      showLoading('Uploading file...');\n      \n      const url = await uploadFileWithProgress(file, (progress) => {\n        this.updateUploadProgress(progress);\n      });\n      \n      hideLoading();\n      showNotification('File uploaded successfully');\n      \n      return url;\n    } catch (error) {\n      hideLoading();\n      throw error;\n    }\n  }\n  \n  async uploadFromURL(fileUrl) {\n    try {\n      showLoading('Uploading from URL...');\n      \n      const url = await uploadFromURL(fileUrl);\n      \n      hideLoading();\n      showNotification('File uploaded successfully from URL');\n      \n      // Add to uploaded files\n      this.uploadedFiles.push({\n        name: fileUrl.split('/').pop(),\n        url: url,\n        type: 'url'\n      });\n      \n      this.renderUploadedFiles();\n      \n      return url;\n    } catch (error) {\n      hideLoading();\n      throw error;\n    }\n  }\n  \n  async deleteFile(gcsUrl) {\n    try {\n      await deleteFile(gcsUrl);\n      \n      // Remove from uploaded files list\n      this.uploadedFiles = this.uploadedFiles.filter(f => f.url !== gcsUrl);\n      \n      // Update UI\n      this.renderUploadedFiles();\n      \n    } catch (error) {\n      console.error('Error deleting file:', error);\n      throw error;\n    }\n  }\n  \n  updateUploadProgress(percent) {\n    const progressBar = document.getElementById('upload-progress');\n    if (progressBar) {\n      progressBar.style.width = `${percent}%`;\n      progressBar.textContent = `${Math.round(percent)}%`;\n    }\n  }\n  \n  renderUploadedFiles() {\n    const container = document.getElementById('uploaded-files');\n    if (!container) return;\n    \n    if (this.uploadedFiles.length === 0) {\n      container.innerHTML = '<p>No files uploaded yet</p>';\n      return;\n    }\n    \n    container.innerHTML = this.uploadedFiles.map((file, index) => `\n      <div class=\"uploaded-file-item\">\n        <div class=\"file-info\">\n          <h4>${file.name}</h4>\n          <p>${file.type}</p>\n          <p>${(file.size / 1024).toFixed(2)} KB</p>\n        </div>\n        <div class=\"file-actions\">\n          <a href=\"${file.url}\" target=\"_blank\" class=\"btn-view\">View</a>\n          <button onclick=\"fileUploadManager.deleteFile('${file.url}')\" class=\"btn-delete\">Delete</button>\n        </div>\n      </div>\n    `).join('');\n  }\n}\n\n// Initialize file upload manager\ndocument.addEventListener('DOMContentLoaded', () => {\n  window.fileUploadManager = new FileUploadManager();\n  fileUploadManager.init();\n});\n```\n\n### Drag and Drop Upload\n\n```javascript\n// Drag and drop file upload\nfunction setupDragAndDrop() {\n  const dropZone = document.getElementById('drop-zone');\n  \n  if (!dropZone) return;\n  \n  // Prevent default drag behaviors\n  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {\n    dropZone.addEventListener(eventName, preventDefaults, false);\n    document.body.addEventListener(eventName, preventDefaults, false);\n  });\n  \n  function preventDefaults(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n  \n  // Highlight drop zone when item is dragged over it\n  ['dragenter', 'dragover'].forEach(eventName => {\n    dropZone.addEventListener(eventName, highlight, false);\n  });\n  \n  ['dragleave', 'drop'].forEach(eventName => {\n    dropZone.addEventListener(eventName, unhighlight, false);\n  });\n  \n  function highlight(e) {\n    dropZone.classList.add('drag-over');\n  }\n  \n  function unhighlight(e) {\n    dropZone.classList.remove('drag-over');\n  }\n  \n  // Handle dropped files\n  dropZone.addEventListener('drop', handleDrop, false);\n  \n  function handleDrop(e) {\n    const dt = e.dataTransfer;\n    const files = dt.files;\n    \n    if (files.length > 0) {\n      fileUploadManager.handleFileSelect(files[0]);\n    }\n  }\n}\n\n// Initialize drag and drop\nsetupDragAndDrop();\n```\n\n### Image Preview and Cropping\n\n```javascript\n// Image preview with cropping option\nasync function uploadImageWithPreview(file) {\n  try {\n    // Show image preview\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      const preview = document.getElementById('image-preview');\n      if (preview) {\n        preview.src = e.target.result;\n        preview.style.display = 'block';\n        \n        // Optionally integrate with image cropping library\n        // Example: Cropper.js\n        const cropper = new Cropper(preview, {\n          aspectRatio: 1,\n          viewMode: 1\n        });\n        \n        // Get cropped image on upload\n        document.getElementById('upload-btn').addEventListener('click', () => {\n          cropper.getCroppedCanvas().toBlob((blob) => {\n            uploadFile(blob);\n          });\n        });\n      }\n    };\n    reader.readAsDataURL(file);\n  } catch (error) {\n    console.error('Error previewing image:', error);\n    showError('Failed to preview image');\n  }\n}\n```\n\n---\n\n## Summary\n\nThis documentation provides comprehensive coverage of all file upload and management endpoints:\n\n### Endpoints Covered:\n1. âœ… **Upload Media** - Upload files directly or from URL\n2. âœ… **Delete Media** - Delete files from Google Cloud Storage\n\n### Documentation Sections:\n- âœ… Overview and system architecture\n- âœ… Detailed endpoint documentation with examples\n- âœ… Client-server communication flows\n- âœ… Complete workflows and diagrams\n- âœ… Error handling guide\n- âœ… Best practices and security considerations\n- âœ… Complete client-side implementation examples\n- âœ… File Upload Manager component\n- âœ… Drag and drop upload examples\n- âœ… Image preview and cropping examples\n\n### Key Features:\n- **Multiple Upload Methods** - Direct file upload or upload from URL\n- **File Validation** - Size limits (15MB) and type validation\n- **Progress Tracking** - Upload progress indicators\n- **Google Cloud Storage** - Integration with GCS for file storage\n- **Security** - Authentication, permissions, and bucket validation\n- **Client-side examples** - Ready-to-use JavaScript code\n\nAll endpoints are fully documented with request/response examples, client-server communication flows, and implementation guidance.\n\n---\n\n**Last Updated**: January 2025\n\n"
		},
		{
			"name": "health-checkup",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{access_token}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{domain.com}}/{{mode}}/health",
					"host": [
						"{{domain.com}}"
					],
					"path": [
						"{{mode}}",
						"health"
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"requests": {},
				"exec": [
					"const response = pm.response.json();",
					"",
					"// Check if the response succeeded",
					"if (response.success && response.data) {",
					"    if (response.data.access_token) {",
					"        pm.environment.set(\"access_token\", response.data.access_token);",
					"        console.log(\"Access token updated:\", response.data.access_token);",
					"    }",
					"",
					"    if (response.data.refresh_token) {",
					"        pm.environment.set(\"refresh_token\", response.data.refresh_token);",
					"        console.log(\"Refresh token updated:\", response.data.refresh_token);",
					"    }",
					"} else {",
					"    console.log(\"No token found in response:\", response);",
					"}",
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "domain.com",
			"value": ""
		},
		{
			"key": "mode",
			"value": ""
		},
		{
			"key": "access_token",
			"value": ""
		},
		{
			"key": "refresh_token",
			"value": ""
		},
		{
			"key": "refresh_token",
			"value": ""
		},
		{
			"key": "session_token",
			"value": ""
		},
		{
			"key": "session_id",
			"value": ""
		},
		{
			"key": "token_type",
			"value": ""
		}
	]
}